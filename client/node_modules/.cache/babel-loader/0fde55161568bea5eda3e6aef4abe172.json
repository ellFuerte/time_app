{"ast":null,"code":"import _defineProperty from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from'react';import Pagination from\"../Pagination/Pagination\";import ModalVacancies from\"../Templates/ModalVacancies/ModalVacancies\";import axios from\"axios\";import'./VacanciesView.css';import VacanciesItem from\"../VacanciesItem/VacanciesItem\";import Topbar from\"../Topbar/Topbar\";import Sidebar from\"../Sidebar/Sidebar\";import VacanciesAdd from\"../VacanciesAdd/VacanciesAdd\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function VacanciesView(departId){var modalDep=useRef();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),selectedValue=_useState2[0],setSelectedValue=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),options=_useState4[0],setOptions=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),filterSelect=_useState6[0],setFilterSelect=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),pressedInnotech=_useState8[0],setPressedInnotech=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),pressedCompany=_useState10[0],setPressedCompany=_useState10[1];var _useState11=useState(true),_useState12=_slicedToArray(_useState11,2),isOpen=_useState12[0],setIsOpen=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),vacancies=_useState14[0],setVacancies=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),isAddingVacancies=_useState16[0],setIsAddingVacancies=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),startDate=_useState18[0],setStartDate=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),endDate=_useState20[0],setEndDate=_useState20[1];var _useState21=useState([]),_useState22=_slicedToArray(_useState21,2),filteredData=_useState22[0],setFilteredData=_useState22[1];var _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),vacanciesName=_useState24[0],setVacanciesName=_useState24[1];var _useState25=useState([]),_useState26=_slicedToArray(_useState25,2),status=_useState26[0],setStatus=_useState26[1];var _useState27=useState([]),_useState28=_slicedToArray(_useState27,2),company=_useState28[0],setCompany=_useState28[1];var localUser=JSON.parse(localStorage.getItem('user'));useEffect(function(){var VacanciesView=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var statuses,companies,vacancies_function,getVacancies;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/Vacations/?status=status');case 2:statuses=_context.sent;_context.next=5;return axios.get('/api/Vacations/?company=company');case 5:companies=_context.sent;setCompany(companies.data);setStatus(statuses.data);vacancies_function={departId:localUser.departmentId,user_id:localUser._id};_context.next=11;return axios.post('/api/Vacations_function/',vacancies_function);case 11:getVacancies=_context.sent;if(isOpen){// Фильтрация вакансий по departId\nsetVacancies(getVacancies.data[0].get_vacancies);// Установка нового массива вакансий\n}case 13:case\"end\":return _context.stop();}}},_callee);}));return function VacanciesView(){return _ref.apply(this,arguments);};}();VacanciesView();},[isOpen,departId]);var reset=function reset(){setStartDate('');setEndDate('');};var handleStartDateChange=function handleStartDateChange(e){setStartDate(e.target.value);};var handleEndDateChange=function handleEndDateChange(e){setEndDate(e.target.value);};var handleCombinedFilter=function handleCombinedFilter(){function filterVacanciesByDate(startDate,endDate){return vacancies.map(function(department){return _objectSpread(_objectSpread({},department),{},{vacancies:department.vacancies.filter(function(vacancy){var vacancyDate=new Date(vacancy.create_date);var start=startDate?new Date(startDate):null;var end=endDate?new Date(endDate):null;return(!start||vacancyDate>=start)&&(!end||vacancyDate<=end);})});});}var filteredData=filterVacanciesByDate(startDate,endDate);setIsOpen(false);setFilteredData(filteredData);setFilterSelect([]);setVacanciesName([]);};var clickAdd=function clickAdd(){setIsAddingVacancies(true);};var clickBackButton=function clickBackButton(){setIsAddingVacancies(false);};var handleClickCompanyName=function handleClickCompanyName(id,name){console.log('id&Name=',id,name);setPressedCompany(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},id,!prevState[id]));});var filterVacanciesByCompanyName=function filterVacanciesByCompanyName(vacancies,companyName){return vacancies.map(function(department){return _objectSpread(_objectSpread({},department),{},{vacancies:department.vacancies.filter(function(vacancy){return vacancy.company_name===companyName;})});}).filter(function(department){return department.vacancies.length>0;});};var filteredVacancies=filterVacanciesByCompanyName(vacancies,id);console.log(filteredVacancies);setVacanciesName(filteredVacancies);setIsOpen(false);};var handleSelectChange=function handleSelectChange(e){var selectedDepartmentId=parseInt(e.target.value);var filter=vacancies.filter(function(elm){return elm.department_id===selectedDepartmentId;});setFilterSelect(filter);setIsOpen(false);setFilteredData([]);};var getColorByStatusId=function getColorByStatusId(statusId){switch(Number(statusId)){case 1:return'Reserve';// Установите зеленый цвет для статуса 1\ncase 2:return'Selection';// Установите желтый цвет для статуса 2\ncase 3:return'Securely';// Установите зелёный цвет для статуса 3\ncase 4:return'Finalist';// Установите красный цвет для статуса 4\ncase 5:return'Liquidated';// Установите белый прозрачный цвет для статуса 4\n}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Topbar,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"mainContainer\",children:[/*#__PURE__*/_jsx(Sidebar,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"Vacations\",children:[isAddingVacancies?/*#__PURE__*/_jsx(\"button\",{className:\"btnStaff\",onClick:clickBackButton,children:\"\\u041D\\u0430\\u0437\\u0430\\u0434\"}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{className:\"btnStaff\",onClick:function onClick(){return window.location.href=\"/department/\".concat(localUser.departmentId);},children:\"\\u041D\\u0430\\u0437\\u0430\\u0434\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btnStaff\",onClick:clickAdd,children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0432\\u0430\\u043A\\u0430\\u043D\\u0441\\u0438\\u0438\"})]}),isAddingVacancies?/*#__PURE__*/_jsx(VacanciesAdd,{}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"VacationsContainerTop\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0412\\u0430\\u043A\\u0430\\u043D\\u0441\\u0438\\u0438\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"date\",placeholder:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0434\\u0430\\u0442\\u0443\",className:\"ModalInput\",style:{'marginRight':'10px'},value:startDate,onChange:handleStartDateChange}),\"\\u2014   \",/*#__PURE__*/_jsx(\"input\",{type:\"date\",placeholder:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0434\\u0430\\u0442\\u0443\",className:\"ModalInput\",style:{'marginRight':'10px'},value:endDate,onChange:handleEndDateChange}),/*#__PURE__*/_jsx(\"button\",{className:\"filterButton\",onClick:handleCombinedFilter,children:\"\\u041F\\u043E\\u0438\\u0441\\u043A\"}),/*#__PURE__*/_jsx(\"button\",{className:\"filterButton\",onClick:reset,children:\"\\u0421\\u0431\\u0440\\u043E\\u0441\\u0438\\u0442\\u044C\"})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"select\",{ref:modalDep,className:\"ModalInputUpdateSelect\",onChange:handleSelectChange,children:vacancies.map(function(dep,index){return/*#__PURE__*/_jsx(\"option\",{value:dep.department_id,children:dep.department},index);})}),/*#__PURE__*/_jsx(\"div\",{children:company.map(function(company,id){return/*#__PURE__*/_jsx(\"button\",{className:\"filtersButton\",onClick:function onClick(){return handleClickCompanyName(company.name,company.id);},style:{boxShadow:pressedCompany[company.name]?\"0 0 1px rgba(0,0,0,.5) inset, 0 2px 3px rgba(0,0,0,.5) inset, 0 1px 1px rgba(255,255,255,.1)\":\"\",background:pressedCompany[company.name]?'gray':'#1775ee'},children:company.name},id);})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{children:status.map(function(status,id){return/*#__PURE__*/_jsx(\"button\",{className:'filtersButton'+getColorByStatusId(status.id),onClick:function onClick(){return handleClickCompanyName(status.name,status.id);},style:{boxShadow:pressedCompany[status.name]?\"0 0 1px rgba(0,0,0,.5) inset, 0 2px 3px rgba(0,0,0,.5) inset, 0 1px 1px rgba(255,255,255,.1)\":\"\",background:pressedCompany[status.name]?'gray':'',opacity:pressedCompany[status.name]?'1':''},children:status.name},id);})})]})]}),isOpen?vacancies.map(function(vac,id){return/*#__PURE__*/_jsx(\"div\",{className:\"VacationsContainer\",children:/*#__PURE__*/_jsx(VacanciesItem,{vac:vac,status:status,department:vac.department,vacancies:vac.vacancies},vac.department)},id);}):'',!isOpen?filterSelect.map(function(vac,id){return/*#__PURE__*/_jsx(\"div\",{className:\"VacationsContainer\",children:/*#__PURE__*/_jsx(VacanciesItem,{vac:vac,status:status,department:vac.department,vacancies:vac.vacancies},vac.department)},id);}):'',vacanciesName.map(function(vac){return/*#__PURE__*/_jsx(\"div\",{className:\"VacationsContainer\",children:/*#__PURE__*/_jsx(VacanciesItem,{vac:vac,status:status,department:vac.department,vacancies:vac.vacancies},vac.department)},vac.id);}),filteredData.map(function(vac){return/*#__PURE__*/_jsx(\"div\",{className:\"VacationsContainer\",children:/*#__PURE__*/_jsx(VacanciesItem,{vac:vac,status:status,department:vac.department,vacancies:vac.vacancies},vac.department)},vac.id);})]})]})]})]});}export default VacanciesView;","map":{"version":3,"sources":["D:/time_app/client/src/components/VacanciesView/VacanciesView.jsx"],"names":["React","useEffect","useRef","useState","Pagination","ModalVacancies","axios","VacanciesItem","Topbar","Sidebar","VacanciesAdd","VacanciesView","departId","modalDep","selectedValue","setSelectedValue","options","setOptions","filterSelect","setFilterSelect","pressedInnotech","setPressedInnotech","pressedCompany","setPressedCompany","isOpen","setIsOpen","vacancies","setVacancies","isAddingVacancies","setIsAddingVacancies","startDate","setStartDate","endDate","setEndDate","filteredData","setFilteredData","vacanciesName","setVacanciesName","status","setStatus","company","setCompany","localUser","JSON","parse","localStorage","getItem","get","statuses","companies","data","vacancies_function","departmentId","user_id","_id","post","getVacancies","get_vacancies","reset","handleStartDateChange","e","target","value","handleEndDateChange","handleCombinedFilter","filterVacanciesByDate","map","department","filter","vacancy","vacancyDate","Date","create_date","start","end","clickAdd","clickBackButton","handleClickCompanyName","id","name","console","log","prevState","filterVacanciesByCompanyName","companyName","company_name","length","filteredVacancies","handleSelectChange","selectedDepartmentId","parseInt","elm","department_id","getColorByStatusId","statusId","Number","window","location","href","dep","index","boxShadow","background","opacity","vac"],"mappings":"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","sourcesContent":["import React, {useEffect, useRef, useState} from 'react'\r\nimport Pagination from \"../Pagination/Pagination\";\r\nimport ModalVacancies from \"../Templates/ModalVacancies/ModalVacancies\"\r\nimport axios from \"axios\";\r\nimport './VacanciesView.css'\r\nimport VacanciesItem from \"../VacanciesItem/VacanciesItem\";\r\nimport Topbar from \"../Topbar/Topbar\";\r\nimport Sidebar from \"../Sidebar/Sidebar\";\r\nimport VacanciesAdd from \"../VacanciesAdd/VacanciesAdd\";\r\n\r\n\r\n\r\nfunction VacanciesView(departId) {\r\n\r\n    const modalDep = useRef()\r\n    const [selectedValue, setSelectedValue] = useState('');\r\n    const [options, setOptions] = useState([]);\r\n    const [filterSelect, setFilterSelect] = useState([])\r\n    const [pressedInnotech, setPressedInnotech] = useState(false);\r\n    const [pressedCompany, setPressedCompany] = useState(false);\r\n\r\n    const [isOpen, setIsOpen] = useState(true)\r\n\r\n\r\n    const [vacancies, setVacancies] = useState([])\r\n    const [isAddingVacancies, setIsAddingVacancies] = useState(false)\r\n    const [startDate, setStartDate] = useState('');\r\n    const [endDate, setEndDate] = useState('');\r\n    const [filteredData, setFilteredData] = useState([]);\r\n    const [vacanciesName, setVacanciesName] = useState([]);\r\n    const [status, setStatus] = useState([])\r\n    const [company, setCompany] = useState([])\r\n    const localUser = JSON.parse(localStorage.getItem('user'))\r\n\r\n    useEffect(() => {\r\n\r\n\r\n\r\n\r\n        const VacanciesView = async () => {\r\n\r\n            const statuses = await axios.get('/api/Vacations/?status=status')\r\n            const companies = await axios.get('/api/Vacations/?company=company')\r\n\r\n            setCompany(companies.data)\r\n            setStatus(statuses.data)\r\n\r\n            const vacancies_function={\r\n                departId: localUser.departmentId,\r\n                user_id: localUser._id\r\n            }\r\n\r\n            const getVacancies = await axios.post('/api/Vacations_function/',vacancies_function)\r\n\r\n            if (isOpen) {\r\n                // Фильтрация вакансий по departId\r\n                setVacancies(getVacancies.data[0].get_vacancies); // Установка нового массива вакансий\r\n            }\r\n        }\r\n\r\n        VacanciesView()\r\n    }, [isOpen, departId])\r\n\r\n\r\n    const reset = () => {\r\n        setStartDate('')\r\n        setEndDate('')\r\n\r\n    }\r\n\r\n    const handleStartDateChange = (e) => {\r\n        setStartDate(e.target.value)\r\n    };\r\n\r\n    const handleEndDateChange = (e) => {\r\n        setEndDate(e.target.value)\r\n    }\r\n\r\n\r\n    const handleCombinedFilter = () => {\r\n        function filterVacanciesByDate(startDate, endDate) {\r\n            return vacancies.map(department => ({\r\n                ...department,\r\n                vacancies: department.vacancies.filter(vacancy => {\r\n                    const vacancyDate = new Date(vacancy.create_date);\r\n                    const start = startDate ? new Date(startDate) : null;\r\n                    const end = endDate ? new Date(endDate) : null;\r\n                    return (!start || vacancyDate >= start) && (!end || vacancyDate <= end);\r\n                })\r\n            }));\r\n        }\r\n\r\n\r\n        const filteredData = filterVacanciesByDate(startDate, endDate);\r\n        setIsOpen(false)\r\n        setFilteredData(filteredData);\r\n        setFilterSelect([])\r\n        setVacanciesName([])\r\n    }\r\n\r\n    const clickAdd = () => {\r\n        setIsAddingVacancies(true);\r\n    }\r\n\r\n    const clickBackButton = () => {\r\n        setIsAddingVacancies(false);\r\n    }\r\n\r\n\r\n    const handleClickCompanyName = (id,name) => {\r\n\r\n        console.log('id&Name=',id,name)\r\n\r\n\r\n        setPressedCompany(prevState => ({\r\n            ...prevState,\r\n            [id]: !prevState[id],\r\n\r\n        }));\r\n\r\n\r\n    const filterVacanciesByCompanyName = (vacancies, companyName) => {\r\n        return vacancies.map(department => ({\r\n            ...department,\r\n            vacancies: department.vacancies.filter(vacancy => vacancy.company_name === companyName)\r\n        })).filter(department => department.vacancies.length > 0);\r\n    }\r\n\r\n        const filteredVacancies = filterVacanciesByCompanyName(vacancies, id);\r\n        console.log(filteredVacancies);\r\n        setVacanciesName(filteredVacancies)\r\n        setIsOpen(false)\r\n\r\n    };\r\n\r\n    const handleSelectChange = (e) => {\r\n        const selectedDepartmentId = parseInt(e.target.value);\r\n        const filter = vacancies.filter(elm=>elm.department_id===selectedDepartmentId)\r\n        setFilterSelect(filter)\r\n        setIsOpen(false)\r\n        setFilteredData([])\r\n    }\r\n\r\n\r\n    const getColorByStatusId = (statusId) => {\r\n\r\n        switch (Number(statusId)) {\r\n            case 1:\r\n                return 'Reserve'; // Установите зеленый цвет для статуса 1\r\n            case 2:\r\n                return 'Selection'; // Установите желтый цвет для статуса 2\r\n            case 3:\r\n                return 'Securely'; // Установите зелёный цвет для статуса 3\r\n            case 4:\r\n                return 'Finalist'; // Установите красный цвет для статуса 4\r\n            case 5:\r\n                return 'Liquidated'; // Установите белый прозрачный цвет для статуса 4\r\n        }\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Topbar/>\r\n            <div className=\"mainContainer\">\r\n                <Sidebar/>\r\n                <div className='Vacations'>\r\n                    {isAddingVacancies ? (\r\n                        <button className='btnStaff' onClick={clickBackButton}>Назад</button>\r\n                    ) : (\r\n                        <div>\r\n                            <button className='btnStaff' onClick={() => window.location.href = `/department/${localUser.departmentId}`}>Назад</button>\r\n                            <button className='btnStaff' onClick={clickAdd}>Добавить вакансии</button>\r\n                        </div>\r\n                    )}\r\n                        {isAddingVacancies ? (\r\n                            <VacanciesAdd />\r\n                        ) : (\r\n                            <>\r\n                            <div className=\"VacationsContainerTop\">\r\n                                <h2>Вакансии</h2>\r\n                                <div>\r\n                                    <input\r\n                                        type='date'\r\n                                        placeholder=\"Выберите дату\"\r\n                                        className=\"ModalInput\"\r\n                                        style={{'marginRight': '10px'}}\r\n                                        value={startDate}\r\n                                        onChange={handleStartDateChange}\r\n                                    />—   <input\r\n                                    type='date'\r\n                                    placeholder=\"Выберите дату\"\r\n                                    className=\"ModalInput\"\r\n                                    style={{'marginRight': '10px'}}\r\n                                    value={endDate}\r\n                                    onChange={handleEndDateChange}\r\n                                />\r\n                                    <button className=\"filterButton\" onClick={handleCombinedFilter}>Поиск</button>\r\n                                    <button className=\"filterButton\" onClick={reset}>Сбросить</button>\r\n                                </div>\r\n                                <br/>\r\n                                <div>\r\n\r\n                                    <select ref={modalDep} className=\"ModalInputUpdateSelect\" onChange={handleSelectChange}>\r\n                                        {vacancies.map((dep, index) => (\r\n                                            <option\r\n                                                key={index}\r\n                                                value={dep.department_id}\r\n                                            >\r\n                                                {dep.department}\r\n                                            </option>\r\n                                        ))}\r\n                                    </select>\r\n                                    <div>\r\n\r\n\r\n                                    {company.map((company, id) => (\r\n                                        <button\r\n                                            key={id}\r\n                                            className='filtersButton'\r\n                                            onClick={() => handleClickCompanyName(company.name,company.id)}\r\n\r\n                                            style={{\r\n                                                boxShadow: pressedCompany[company.name] ? \"0 0 1px rgba(0,0,0,.5) inset, 0 2px 3px rgba(0,0,0,.5) inset, 0 1px 1px rgba(255,255,255,.1)\" : \"\",\r\n                                                background: pressedCompany[company.name] ? 'gray' : '#1775ee'\r\n                                            }}\r\n\r\n                                        >{company.name}</button>\r\n                                    ))}\r\n                                    </div>\r\n                                    <br/>\r\n                                    <div>\r\n\r\n                                    {status.map((status, id) => (\r\n                                        <button\r\n                                            key={id}\r\n                                            className={'filtersButton'+getColorByStatusId(status.id)}\r\n                                            onClick={() => handleClickCompanyName(status.name,status.id)}\r\n\r\n                                            style={{\r\n                                                boxShadow: pressedCompany[status.name] ? \"0 0 1px rgba(0,0,0,.5) inset, 0 2px 3px rgba(0,0,0,.5) inset, 0 1px 1px rgba(255,255,255,.1)\" : \"\",\r\n                                                background: pressedCompany[status.name] ? 'gray' : '',\r\n                                                opacity: pressedCompany[status.name] ? '1' : ''\r\n                                            }}\r\n\r\n                                        >{status.name}</button>\r\n                                    ))}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                                {\r\n                                    isOpen ?\r\n                                        (vacancies.map((vac, id) => (\r\n                                        <div className='VacationsContainer' key={id}>\r\n                                            <VacanciesItem vac={vac} key={vac.department} status={status} department={vac.department} vacancies={vac.vacancies}/>\r\n                                        </div>\r\n                                    ))) : ''\r\n\r\n                                }\r\n\r\n                                {\r\n                                    !isOpen ?\r\n                                        filterSelect.map((vac, id) => (\r\n                                    <div className='VacationsContainer' key={id}>\r\n                                    <VacanciesItem vac={vac} key={vac.department} status={status} department={vac.department} vacancies={vac.vacancies}/>\r\n                                    </div>\r\n                                    )) : ''\r\n\r\n                                }\r\n\r\n                                {\r\n                                    vacanciesName.map(vac => (\r\n                                    <div className='VacationsContainer' key={vac.id}>\r\n                                        <VacanciesItem vac={vac} key={vac.department} status={status} department={vac.department} vacancies={vac.vacancies}/>\r\n\r\n                                    </div>\r\n                                ))\r\n\r\n                                }\r\n\r\n                                {\r\n                                    filteredData.map(vac => (\r\n                                        <div className='VacationsContainer' key={vac.id}>\r\n                                            <VacanciesItem vac={vac} key={vac.department} status={status} department={vac.department} vacancies={vac.vacancies}/>\r\n\r\n                                        </div>\r\n                                    ))\r\n\r\n                                }\r\n                            </>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default VacanciesView"]},"metadata":{},"sourceType":"module"}