{"ast":null,"code":"import _regeneratorRuntime from\"D:/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState}from'react';import axios from'axios';import Employee from'../Employee/Employee';import'./Staff.css';import{useParams}from'react-router-dom';import Modal from'../Templates/Modal/Modal';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Staff(){var _localUser$checkedDep5;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),checked=_useState2[0],setChecked=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),childs=_useState4[0],setSee_child=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),statisticsWork=_useState6[0],setStatisticsWork=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),users=_useState8[0],setUsers=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),us=_useState10[0],setUs=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),user=_useState12[0],setUser=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),getUser=_useState14[0],setGetUser=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),deps=_useState16[0],setDeps=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isOpen=_useState18[0],setIsOpen=_useState18[1];var _useState19=useState(true),_useState20=_slicedToArray(_useState19,2),isJob=_useState20[0],setIsJob=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isFetching=_useState22[0],setIsFetching=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),modalMain=_useState24[0],setModalMain=_useState24[1];var changedArr=[];var departId=useParams().username;var localUser=JSON.parse(localStorage.getItem('user'));var depsId=useParams().username;for(var i=0;i<((_localUser$checkedDep=localUser.checkedDeps)===null||_localUser$checkedDep===void 0?void 0:_localUser$checkedDep.length);i++){var _localUser$checkedDep;changedArr.push(localUser.checkedDeps[i]);}// ставит галочки в модалке\nfunction addChecked(deps){for(var _i=0;_i<deps.length;_i++){for(var j=0;j<((_localUser$checkedDep2=localUser.checkedDeps)===null||_localUser$checkedDep2===void 0?void 0:_localUser$checkedDep2.length);j++){var _localUser$checkedDep2;if(deps[_i]._id===localUser.checkedDeps[j]){deps[_i].checked=true;}}}}// фильтр нужных департаментов\nvar currentDep=deps.filter(function(dep){return departId?dep._id===departId:dep._id===localUser.departmentId;});var filterDeps=deps.filter(function(dep){return currentDep.find(function(i){return i===dep.dep_id||i===currentDep[0].dep_id;});});filterDeps.push.apply(filterDeps,_toConsumableArray(currentDep));// фильтр нужных людей\nvar usersFilter=users.filter(function(user){return filterDeps.find(function(f){return f._id===user.departmentId;});});var usersFilterDeps=users.filter(function(user){var _localUser$checkedDep3;return(_localUser$checkedDep3=localUser.checkedDeps)===null||_localUser$checkedDep3===void 0?void 0:_localUser$checkedDep3.find(function(f){return f===user.departmentId;});});var depsFilterDeps=deps.filter(function(dep){var _localUser$checkedDep4;return(_localUser$checkedDep4=localUser.checkedDeps)===null||_localUser$checkedDep4===void 0?void 0:_localUser$checkedDep4.find(function(f){return f===dep._id;});});var isLockDeps=localUser.checkedDeps!==null&&((_localUser$checkedDep5=localUser.checkedDeps)===null||_localUser$checkedDep5===void 0?void 0:_localUser$checkedDep5.length)>0;var addChildrenArr=[];useEffect(function(){var get_statistics_all_users=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var getUsers,res,all,yesterday,working_yesterday,all_users;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsFetching(true);if(!(localUser.isAdmin===true)){_context.next=25;break;}getUsers={id:localUser._id};_context.next=5;return axios.post('/api/get_statistics_all_users',getUsers);case 5:res=_context.sent;console.log('RES=',res.data);all=res.data[0].get_statistics_all_users[0]['all_users'].sort(function(a,b){return a.user_name.localeCompare(b.user_name);});yesterday=res.data[0].get_statistics_all_users[0]['not_worked_yesterday'].sort(function(a,b){return a.user_name.localeCompare(b.user_name);});working_yesterday=filterUsersFoo(yesterday);all_users=filterUsersFoo(all);if(res.data[0].get_statistics_all_users[0]['all_users']===null&&!!~document.location.href.indexOf('/all_users/')){alert('Нет не одного пользователя в работе');}if(res.data[0].get_statistics_all_users[0]['not_working_today']===null&&!!~document.location.href.indexOf('/not_working_today/')){alert('Сегодня все в работе');window.location.href=\"/department/\".concat(localUser.departmentId);}if(res.data[0].get_statistics_all_users[0]['not_worked_yesterday']===null&&!!~document.location.href.indexOf('/not_worked_yesterday/')){alert('Вчера все работали');window.location.href=\"/department/\".concat(localUser.departmentId);}if(res.data[0].get_statistics_all_users[0]['sick_today']===null&&!!~document.location.href.indexOf('/sick_leave_today/')){alert('Нет болеющих сегодня');window.location.href=\"/department/\".concat(localUser.departmentId);}if(res.data[0].get_statistics_all_users[0]['sick_yesterday']===null&&!!~document.location.href.indexOf('/sick_leave_yesterday')){alert('Вчера не было сотрудников на больничном');window.location.href=\"/department/\".concat(localUser.main_department);}if(res.data[0].get_statistics_all_users[0]['vacation_today']===null&&!!~document.location.href.indexOf('/vacation_today')){alert('На сегодня нет сотрудников в отпуске');window.location.href=\"/department/\".concat(localUser.main_department);}if(res.data[0].get_statistics_all_users[0]['vacation_yesterday']===null&&!!~document.location.href.indexOf('/vacation_yesterday')){alert('Вчера не было сотрудников в отпуске');window.location.href=\"/department/\".concat(localUser.main_department);}if(!!~document.location.href.indexOf('/all_users/')){setStatisticsWork(all_users);}if(!!~document.location.href.indexOf('/not_working_today/')){setStatisticsWork(res.data[0].get_statistics_all_users[0]['not_working_today']);}if(!!~document.location.href.indexOf('/not_worked_yesterday/')){setStatisticsWork(working_yesterday);}if(!!~document.location.href.indexOf('/sick_leave_today/')){setStatisticsWork(res.data[0].get_statistics_all_users[0]['sick_today']);}if(!!~document.location.href.indexOf('/sick_leave_yesterday/')){setStatisticsWork(res.data[0].get_statistics_all_users[0]['sick_yesterday']);}if(!!~document.location.href.indexOf('/vacation_today/')){setStatisticsWork(res.data[0].get_statistics_all_users[0]['vacation_today']);}if(!!~document.location.href.indexOf('/vacation_yesterday/')){setStatisticsWork(res.data[0].get_statistics_all_users[0]['vacation_yesterday']);}case 25:setIsFetching(false);case 26:case\"end\":return _context.stop();}}},_callee);}));return function get_statistics_all_users(){return _ref.apply(this,arguments);};}();// получение всех пользователей\nvar fetchUsers=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res,filterUsers;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get('/api/user');case 2:res=_context2.sent;res.data.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});filterUsers=filterUsersFoo(res.data);setUsers(filterUsers);setIsFetching(false);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function fetchUsers(){return _ref2.apply(this,arguments);};}();var see=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var user,see_child;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.get('/api/user/'+localUser._id);case 2:user=_context3.sent;see_child=user.data.see_child;setSee_child(see_child);case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function see(){return _ref3.apply(this,arguments);};}();var child=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var info,addchild,dep_users;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:info={depsId:depsId};_context4.next=3;return axios.post('/api/get_users_by_dep/',info);case 3:addchild=_context4.sent;dep_users=addchild.data[0]['get_users_by_dep'];if(dep_users===null){}else{setUs(dep_users);}case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function child(){return _ref4.apply(this,arguments);};}();var get_users_by_users=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var getUsers,res,users_users,filterUsers;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:setIsFetching(true);getUsers={id:localUser._id};_context5.next=4;return axios.post('/api/get_users_by_users',getUsers);case 4:res=_context5.sent;users_users=res.data[0]['get_users_by_users'];users_users.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});filterUsers=filterUsersFoo(users_users);setUsers(filterUsers);setIsFetching(false);case 10:case\"end\":return _context5.stop();}}},_callee5);}));return function get_users_by_users(){return _ref5.apply(this,arguments);};}();fetchUsers();setIsOpen(false);if(user.main_department===departId){setUsers([]);get_users_by_users();}else{setGetUser([]);fetchUsers();}get_statistics_all_users();child();see();},[departId]);// фильтр пользователей по статусу\nfunction filterUsersFoo(users){return users.filter(function(user){return user.status===1;}).concat(users.filter(function(user){return user.status===2;})).concat(users.filter(function(user){return user.status===3;})).concat(users.filter(function(user){return user.status!==1&&user.status!==2&&user.status!==3&&user.status!==4;})).concat(users.filter(function(user){return user.status===4;}));}// добавляем/удаляем департамент в модалке\nvar handlePush=function handlePush(e){if(e.target.checked){changedArr.push(e.target.value);}else{var index=changedArr.indexOf(e.target.value);changedArr.splice(index,1);delete e.target.checked;}};// добавление дочерних\nvar clickcheckbox=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var info,_info,res,dep_users;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:setChecked(!checked);info={userId:localUser._id,ischeked:!checked};_context6.next=4;return axios.post('/api/child/',info);case 4:if(!(!checked===true)){_context6.next=15;break;}console.log('TRUE=',!checked);_info={depsId:depsId};console.log('users=',users);_context6.next=10;return axios.post('/api/get_users_by_dep/',_info);case 10:res=_context6.sent;dep_users=res.data[0]['get_users_by_dep'];setUs(dep_users);_context6.next=17;break;case 15:console.log('FALSE=',!checked);setUs([]);case 17:case\"end\":return _context6.stop();}}},_callee6);}));return function clickcheckbox(){return _ref6.apply(this,arguments);};}();// обновляем данные модального окна\nvar handleModalClick=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var add,res;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:add={id:localUser._id,depsId:depsId};_context7.next=3;return axios.put('/api/user',add);case 3:res=_context7.sent;setModalMain(false);case 5:case\"end\":return _context7.stop();}}},_callee7);}));return function handleModalClick(){return _ref7.apply(this,arguments);};}();// функция get_users_by_dep\nvar get_users_by_dep=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var info,res,dep_users,filterUsers;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(!isJob){_context8.next=7;break;}info={depsId:depsId};_context8.next=4;return axios.post('/api/get_users_by_dep/',info);case 4:res=_context8.sent;dep_users=res.data[0]['get_users_by_dep'];if(dep_users===null){setUsers(dep_users);}else{setUsers(dep_users);console.log(\"GGG=\",dep_users);dep_users.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});filterUsers=filterUsersFoo(dep_users);setUsers(filterUsers);setIsOpen(true);setIsJob(!isJob);}case 7:case\"end\":return _context8.stop();}}},_callee8);}));return function get_users_by_dep(){return _ref8.apply(this,arguments);};}();console.log('setSTAT=',statisticsWork);return/*#__PURE__*/_jsxs(\"div\",{className:\"staff\",children:[departId&&/*#__PURE__*/_jsxs(_Fragment,{children:[isJob?/*#__PURE__*/_jsx(\"button\",{onClick:get_users_by_dep,className:\"btnStaff\",style:{width:'155px'},children:\"\\u041F\\u043E\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C \\u0434\\u043E\\u0447\\u0435\\u0440\\u043D\\u0438\\u0435\"}):/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return window.location.href=\"/department/\".concat(departId);},className:\"btnStaff\",children:\"\\u0421\\u043A\\u0440\\u044B\\u0442\\u044C \\u0434\\u043E\\u0447\\u0435\\u0440\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setModalMain(true);},className:\"btnStaff\",style:{float:'right'},children:\"\\u0421\\u0434\\u0435\\u043B\\u0430\\u0442\\u044C \\u0433\\u043B\\u0430\\u0432\\u043D\\u043E\\u0439\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"employeeWrapper\",children:[isFetching?/*#__PURE__*/_jsx(\"div\",{className:\"isFetching\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"}):users.length===0&&getUser.length!==0?'':!!departId?!isOpen?users.filter(function(user){return user.department_id===departId;}).map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):usersFilter.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):isLockDeps?usersFilterDeps.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):statisticsWork.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}),checked?us.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):'',childs===true?us.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):'',!!isOpen?users.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):\"\",!!getUser?getUser.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):\"\"]}),/*#__PURE__*/_jsxs(Modal,{active:modalMain,setActive:setModalMain,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{checked:checked,type:\"checkbox\",onChange:clickcheckbox}),\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0434\\u043E\\u0447\\u0435\\u0440\\u043D\\u0438\\u0435\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",disabled:isFetching,onClick:handleModalClick,children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"})]})]})]});}","map":{"version":3,"sources":["D:/time_app/client/src/components/Staff/Staff.jsx"],"names":["useEffect","useState","axios","Employee","useParams","Modal","Staff","checked","setChecked","childs","setSee_child","statisticsWork","setStatisticsWork","users","setUsers","us","setUs","user","setUser","getUser","setGetUser","deps","setDeps","isOpen","setIsOpen","isJob","setIsJob","isFetching","setIsFetching","modalMain","setModalMain","changedArr","departId","username","localUser","JSON","parse","localStorage","getItem","depsId","i","checkedDeps","length","push","addChecked","j","_id","currentDep","filter","dep","departmentId","filterDeps","find","dep_id","usersFilter","f","usersFilterDeps","depsFilterDeps","isLockDeps","addChildrenArr","get_statistics_all_users","isAdmin","getUsers","id","post","res","console","log","data","all","sort","a","b","user_name","localeCompare","yesterday","working_yesterday","filterUsersFoo","all_users","document","location","href","indexOf","alert","window","main_department","fetchUsers","get","filterUsers","see","see_child","child","info","addchild","dep_users","get_users_by_users","users_users","status","concat","handlePush","e","target","value","index","splice","clickcheckbox","userId","ischeked","handleModalClick","add","put","get_users_by_dep","width","float","department_id","map"],"mappings":"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","sourcesContent":["import {useEffect, useState} from 'react'\r\nimport axios from 'axios'\r\nimport Employee from '../Employee/Employee'\r\nimport './Staff.css'\r\nimport { useParams } from 'react-router-dom'\r\nimport Modal from '../Templates/Modal/Modal'\r\n\r\nexport default function Staff() {\r\n  const [checked, setChecked] = useState(false)\r\n  const [childs, setSee_child] = useState()\r\n  const [statisticsWork, setStatisticsWork] = useState([])\r\n  const [users, setUsers] = useState([])\r\n  const [us, setUs] = useState([])\r\n  const [user, setUser] = useState([])\r\n  const [getUser, setGetUser] = useState([])\r\n  const [deps, setDeps] = useState([])\r\n  const [isOpen, setIsOpen] = useState(false)\r\n  const [isJob, setIsJob] = useState(true)\r\n  const [isFetching, setIsFetching] = useState(false)\r\n  const [modalMain, setModalMain] = useState(false)\r\n  const changedArr = []\r\n  const departId = useParams().username\r\n  const localUser = JSON.parse(localStorage.getItem('user'))\r\n  const depsId = useParams().username\r\n  for (let i = 0; i < localUser.checkedDeps?.length; i++) {\r\n    changedArr.push(localUser.checkedDeps[i])\r\n\r\n  }\r\n\r\n  // ставит галочки в модалке\r\n  function addChecked(deps) {\r\n    for (let i = 0; i < deps.length; i++) {\r\n      for (let j = 0; j < localUser.checkedDeps?.length; j++) {\r\n        if (deps[i]._id === localUser.checkedDeps[j]) {\r\n          deps[i].checked = true\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // фильтр нужных департаментов\r\n  const currentDep = deps.filter(dep => departId ? dep._id === departId : dep._id === localUser.departmentId)\r\n  let filterDeps = deps.filter(dep => currentDep.find(i => i === dep.dep_id || i === currentDep[0].dep_id))\r\n  filterDeps.push(...currentDep)\r\n\r\n  // фильтр нужных людей\r\n  const usersFilter = users.filter(user => filterDeps.find(f => f._id === user.departmentId))\r\n  const usersFilterDeps = users.filter(user => localUser.checkedDeps ?.find(f => f === user.departmentId))\r\n  const depsFilterDeps = deps.filter(dep => localUser.checkedDeps ?.find(f => f === dep._id))\r\n\r\n  const isLockDeps = localUser.checkedDeps !== null && localUser.checkedDeps?.length > 0\r\n\r\n  let addChildrenArr = []\r\n\r\n  useEffect(() => {\r\n    const get_statistics_all_users = async () => {\r\n      setIsFetching(true)\r\n      if(localUser.isAdmin===true) {\r\n        const getUsers = {\r\n          id: localUser._id\r\n        }\r\n        const res = await axios.post('/api/get_statistics_all_users', getUsers)\r\n        console.log('RES=',res.data)\r\n        const all=res.data[0].get_statistics_all_users[0]['all_users'].sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n        const yesterday = res.data[0].get_statistics_all_users[0]['not_worked_yesterday'].sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n        let working_yesterday = filterUsersFoo(yesterday)\r\n        let all_users = filterUsersFoo(all)\r\n\r\n\r\n        if (res.data[0].get_statistics_all_users[0]['all_users'] === null && !!~document.location.href.indexOf('/all_users/')) {\r\n          alert('Нет не одного пользователя в работе')\r\n\r\n        }\r\n        if (res.data[0].get_statistics_all_users[0]['not_working_today'] === null && !!~document.location.href.indexOf('/not_working_today/')) {\r\n          alert('Сегодня все в работе')\r\n          window.location.href = `/department/${localUser.departmentId}`\r\n        }\r\n        if (res.data[0].get_statistics_all_users[0]['not_worked_yesterday'] === null && !!~document.location.href.indexOf('/not_worked_yesterday/')) {\r\n          alert('Вчера все работали')\r\n          window.location.href = `/department/${localUser.departmentId}`\r\n        }\r\n        if (res.data[0].get_statistics_all_users[0]['sick_today'] === null && !!~document.location.href.indexOf('/sick_leave_today/')) {\r\n          alert('Нет болеющих сегодня')\r\n          window.location.href = `/department/${localUser.departmentId}`\r\n        }\r\n\r\n        if (res.data[0].get_statistics_all_users[0]['sick_yesterday'] === null && !!~document.location.href.indexOf('/sick_leave_yesterday')) {\r\n          alert('Вчера не было сотрудников на больничном')\r\n          window.location.href=`/department/${localUser.main_department}`\r\n        }\r\n        if (res.data[0].get_statistics_all_users[0]['vacation_today'] === null && !!~document.location.href.indexOf('/vacation_today')) {\r\n          alert('На сегодня нет сотрудников в отпуске')\r\n          window.location.href=`/department/${localUser.main_department}`\r\n        }\r\n        if (res.data[0].get_statistics_all_users[0]['vacation_yesterday'] === null && !!~document.location.href.indexOf('/vacation_yesterday')) {\r\n          alert('Вчера не было сотрудников в отпуске')\r\n          window.location.href=`/department/${localUser.main_department}`\r\n        }\r\n\r\n        if (!!~document.location.href.indexOf('/all_users/')) {\r\n          setStatisticsWork(all_users)\r\n        }\r\n\r\n        if (!!~document.location.href.indexOf('/not_working_today/')) {\r\n          setStatisticsWork(res.data[0].get_statistics_all_users[0]['not_working_today'])\r\n        }\r\n\r\n        if (!!~document.location.href.indexOf('/not_worked_yesterday/')) {\r\n          setStatisticsWork(working_yesterday)\r\n        }\r\n        if (!!~document.location.href.indexOf('/sick_leave_today/')) {\r\n          setStatisticsWork(res.data[0].get_statistics_all_users[0]['sick_today'])\r\n        }\r\n        if (!!~document.location.href.indexOf('/sick_leave_yesterday/')) {\r\n          setStatisticsWork(res.data[0].get_statistics_all_users[0]['sick_yesterday'])\r\n        }\r\n        if (!!~document.location.href.indexOf('/vacation_today/')) {\r\n          setStatisticsWork(res.data[0].get_statistics_all_users[0]['vacation_today'])\r\n        }\r\n        if (!!~document.location.href.indexOf('/vacation_yesterday/')) {\r\n          setStatisticsWork(res.data[0].get_statistics_all_users[0]['vacation_yesterday'])\r\n        }\r\n\r\n      }\r\n      setIsFetching(false)\r\n    }\r\n    // получение всех пользователей\r\n    const fetchUsers = async () => {\r\n      const res = await axios.get('/api/user')\r\n      res.data.sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n      let filterUsers = filterUsersFoo(res.data)\r\n      setUsers(filterUsers)\r\n      setIsFetching(false)\r\n\r\n    }\r\n\r\n    const see = async () => {\r\n      const user = await axios.get('/api/user/' + localUser._id)\r\n      const see_child = user.data.see_child\r\n      setSee_child(see_child)\r\n    }\r\n\r\n    const child = async ()=>{\r\n      const info = {\r\n        depsId: depsId\r\n      }\r\n      const addchild = await axios.post('/api/get_users_by_dep/', info)\r\n      const dep_users = addchild.data[0]['get_users_by_dep']\r\n      if(dep_users===null){\r\n\r\n      }else{\r\n        setUs(dep_users)\r\n      }\r\n    }\r\n\r\n\r\n\r\n    const get_users_by_users = async () => {\r\n      setIsFetching(true)\r\n      const getUsers={\r\n        id:localUser._id\r\n      }\r\n      const res = await axios.post('/api/get_users_by_users', getUsers)\r\n      const users_users = res.data[0]['get_users_by_users']\r\n      users_users.sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n      let filterUsers = filterUsersFoo(users_users)\r\n      setUsers(filterUsers)\r\n      setIsFetching(false)\r\n\r\n    }\r\n    fetchUsers()\r\n    setIsOpen(false)\r\n\r\n    if(user.main_department===departId) {\r\n      setUsers([])\r\n      get_users_by_users()\r\n    }   else{\r\n      setGetUser([])\r\n      fetchUsers()\r\n    }\r\n    get_statistics_all_users()\r\n    child()\r\n    see()\r\n  }, [departId])\r\n\r\n\r\n  // фильтр пользователей по статусу\r\n  function filterUsersFoo(users) {\r\n    return users.filter(user => user.status === 1)\r\n        .concat(users.filter(user => user.status === 2))\r\n        .concat(users.filter(user => user.status === 3))\r\n        .concat(users.filter(user => user.status !== 1 && user.status !== 2 && user.status !== 3 && user.status !== 4))\r\n        .concat(users.filter(user => user.status === 4))\r\n  }\r\n\r\n\r\n  // добавляем/удаляем департамент в модалке\r\n  const handlePush = e => {\r\n    if (e.target.checked) {\r\n      changedArr.push(e.target.value)\r\n    } else {\r\n      const index = changedArr.indexOf(e.target.value)\r\n      changedArr.splice(index, 1)\r\n      delete e.target.checked\r\n    }\r\n  }\r\n\r\n  // добавление дочерних\r\n\r\n  const clickcheckbox = async () => {\r\n    setChecked(!checked)\r\n\r\n    const info = {\r\n      userId: localUser._id,\r\n      ischeked: !checked\r\n    }\r\n    await axios.post('/api/child/', info)\r\n\r\n    if (!checked===true) {\r\n      console.log('TRUE=',!checked)\r\n      const info = {\r\n        depsId: depsId\r\n      }\r\n      console.log('users=',users)\r\n\r\n      const res = await axios.post('/api/get_users_by_dep/', info)\r\n      const dep_users = res.data[0]['get_users_by_dep']\r\n      setUs(dep_users)\r\n    }\r\n    else{\r\n      console.log('FALSE=',!checked)\r\n      setUs([])\r\n    }\r\n\r\n\r\n  }\r\n\r\n  // обновляем данные модального окна\r\n  const handleModalClick = async () => {\r\n    const add = {\r\n      id:localUser._id,\r\n      depsId:depsId\r\n    }\r\n    const res = await axios.put('/api/user',add)\r\n    setModalMain(false)\r\n\r\n  }\r\n\r\n  // функция get_users_by_dep\r\n  const get_users_by_dep = async () => {\r\n\r\n    if (isJob) {\r\n      const info = {\r\n        depsId: depsId\r\n      }\r\n      const res = await axios.post('/api/get_users_by_dep/', info)\r\n      const dep_users = res.data[0]['get_users_by_dep']\r\n\r\n      if (dep_users === null) {\r\n        setUsers(dep_users)\r\n      } else {\r\n        setUsers(dep_users)\r\n        console.log(\"GGG=\",dep_users)\r\n        dep_users.sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n        let filterUsers = filterUsersFoo(dep_users)\r\n        setUsers(filterUsers)\r\n        setIsOpen(true)\r\n        setIsJob(!isJob)\r\n      }\r\n\r\n    }\r\n  }\r\nconsole.log('setSTAT=',statisticsWork)\r\n\r\n  return (\r\n      <div className='staff'>\r\n        {departId && <>\r\n          {isJob ? <button onClick={get_users_by_dep} className=\"btnStaff\" style={{width:'155px'}}>Показать дочерние</button> : <button onClick={() => window.location.href = `/department/${departId}`} className=\"btnStaff\" >Скрыть дочерние</button> }\r\n          <button onClick={() => setModalMain(true)} className='btnStaff' style={{float: 'right'}}>Сделать главной</button>\r\n        </>}\r\n\r\n        <div className=\"employeeWrapper\">\r\n\r\n          {isFetching\r\n              ? <div className='isFetching'>Загрузка...</div>\r\n              : users.length === 0 && getUser.length !==0\r\n                  ? ''\r\n                  : !!departId\r\n                      ? !isOpen\r\n                          ? users.filter(user => user.department_id === departId).map((user, id) => <Employee key={id} user={user}/>)\r\n                          : usersFilter.map((user, id) => <Employee key={id} user={user} />)\r\n                      : isLockDeps\r\n                          ? usersFilterDeps.map((user, id) => <Employee key={id} user={user}/>)\r\n                          : statisticsWork.map((user, id) => <Employee key={id} user={user}/>)\r\n          }\r\n\r\n          {checked\r\n              ? us.map((user, id) =>  <Employee key={id} user={user}/>)\r\n              :''\r\n          }\r\n\r\n          {\r\n            childs===true\r\n                ? us.map((user, id) =>  <Employee key={id} user={user}/>)\r\n                :''}\r\n\r\n          {\r\n\r\n            !!isOpen\r\n                ?\r\n                users.map((user, id) =>  <Employee key={id} user={user}/>)\r\n                :\"\"\r\n          }\r\n\r\n          {\r\n            !!getUser\r\n                ?\r\n                getUser.map((user, id) =>  <Employee key={id} user={user}/>)\r\n                :\"\"\r\n          }\r\n\r\n\r\n        </div>\r\n        <Modal active={modalMain} setActive={setModalMain}>\r\n          <h1>Изменение информации:</h1>\r\n          <hr/>\r\n          <form className=\"modalLoginBox\">\r\n            <label>\r\n              <input\r\n                  checked={checked}\r\n                  type='checkbox'\r\n                  onChange={clickcheckbox}\r\n              />Добавить дочерние</label>\r\n            <button className=\"ModalButton\" type=\"submit\" disabled={isFetching} onClick={handleModalClick}>\r\n              Изменить\r\n            </button>\r\n          </form>\r\n        </Modal>\r\n      </div>\r\n  )\r\n}"]},"metadata":{},"sourceType":"module"}