{"ast":null,"code":"import _regeneratorRuntime from\"D:/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from\"react\";import axios from\"axios\";import moment from\"moment\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ModalVacanciesItem=function ModalVacanciesItem(_ref){var allDateUser=_ref.allDateUser;useEffect(function(){if(allDateUser){setInputValueVacanciesName(allDateUser.vacancies_name);setInputValueGrade(allDateUser.grade);setSelectDep(allDateUser.vacancies_department_id);setInputValueDescription(allDateUser.description);setInputValueStatuses(allDateUser.vacancies_status_id);setSelectCompany(allDateUser.company_id);setSelectItc(allDateUser.vacancy_code);setProjectItem(allDateUser.project_id);setVacanciesId(allDateUser.vacancy_id);setOld_user(allDateUser.id);if(allDateUser.planned_release_date!==null){var date=moment(allDateUser.planned_release_date).format('YYYY-MM-DD');setPlannedReleaseDate(date);}console.log('allDateUser.planned_release_date=',plannedReleaseDate);}else{console.log('allDateUser или allDateUser.vacancies_name не определен');}},[allDateUser]);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),status=_useState2[0],setStatus=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),selectDep=_useState4[0],setSelectDep=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),company=_useState6[0],setCompany=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),selectCompany=_useState8[0],setSelectCompany=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),selectItc=_useState10[0],setSelectItc=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),projectItem=_useState12[0],setProjectItem=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),message=_useState14[0],setMessage=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),plannedReleaseDate=_useState16[0],setPlannedReleaseDate=_useState16[1];var _useState17=useState(\"\"),_useState18=_slicedToArray(_useState17,2),vacanciesId=_useState18[0],setVacanciesId=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),inputValueVacanciesName=_useState20[0],setInputValueVacanciesName=_useState20[1];var _useState21=useState(\"\"),_useState22=_slicedToArray(_useState21,2),old_user=_useState22[0],setOld_user=_useState22[1];var _useState23=useState(\"\"),_useState24=_slicedToArray(_useState23,2),inputValueDescription=_useState24[0],setInputValueDescription=_useState24[1];var _useState25=useState(\"\"),_useState26=_slicedToArray(_useState25,2),inputValueStatuses=_useState26[0],setInputValueStatuses=_useState26[1];var _useState27=useState(\"\"),_useState28=_slicedToArray(_useState27,2),inputValueGrade=_useState28[0],setInputValueGrade=_useState28[1];var _useState29=useState(''),_useState30=_slicedToArray(_useState29,2),user_name=_useState30[0],setUser_name=_useState30[1];var _useState31=useState(''),_useState32=_slicedToArray(_useState31,2),searchTerm=_useState32[0],setSearchTerm=_useState32[1];var _useState33=useState([]),_useState34=_slicedToArray(_useState33,2),userId=_useState34[0],setUserId=_useState34[1];var _useState35=useState([]),_useState36=_slicedToArray(_useState35,2),filteredUsers=_useState36[0],setFilteredUsers=_useState36[1];var _useState37=useState([]),_useState38=_slicedToArray(_useState37,2),users=_useState38[0],setUsers=_useState38[1];var statusRef=useRef();var departRef=useRef();var companyRef=useRef();var ITCRef=useRef();var projectRef=useRef();var DateReleaseRef=useRef();useEffect(function(){var Department=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var statuses,departs,company,user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/Vacations/?status=status');case 2:statuses=_context.sent;setStatus(statuses.data);_context.next=6;return axios.get('/api/departments/');case 6:departs=_context.sent;setDeps(departs.data);_context.next=10;return axios.get('/api/Vacations/?company=company');case 10:company=_context.sent;setCompany(company.data);_context.next=14;return axios.get('/api/user');case 14:user=_context.sent;setUsers(user.data);case 16:case\"end\":return _context.stop();}}},_callee);}));return function Department(){return _ref2.apply(this,arguments);};}();Department();},[]);var _useState39=useState([]),_useState40=_slicedToArray(_useState39,2),deps=_useState40[0],setDeps=_useState40[1];var handleNameInputChange=function handleNameInputChange(e){setInputValueVacanciesName(e.target.value);};// Обработчик изменения значения для поля ввода с grade\nvar handleDescriptionInputChange=function handleDescriptionInputChange(e){setInputValueDescription(e.target.value);};var handleGradeInputChange=function handleGradeInputChange(e){// Проверяем, является ли введенное значение числом (включая пустое значение)\nif(/^\\d*$/.test(e.target.value)){setInputValueGrade(e.target.value);}};var selectValue=function selectValue(){setInputValueStatuses(statusRef.current.value);};var selectDeps=function selectDeps(){setSelectDep(departRef.current.value);};var companySelect=function companySelect(){setSelectCompany(companyRef.current.value);};var SelectITC=function SelectITC(){setSelectItc(ITCRef.current.value);};var Project=function Project(e){if(/^\\d*$/.test(e.target.value)){setProjectItem(e.target.value);}};var DataCurrent=function DataCurrent(){setPlannedReleaseDate(DateReleaseRef.current.value);console.log('DateReleaseRef.current.valu=',DateReleaseRef.current.value);};var ChangeDataButton=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var ChangeData,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:ChangeData={namevacanciesId:vacanciesId,namevacancies:inputValueVacanciesName,description:inputValueDescription,grade:inputValueGrade,statuses:statusRef.current.value,users:userId.length===0?old_user:userId,search:userId,old_user:old_user,deps:selectDep,company_id:selectCompany,vacancy_code:selectItc,project_id:projectItem,planned_release_date:DateReleaseRef.current.value.length===0?null:DateReleaseRef.current.value};if(!(statusRef.current.value==='3'&&old_user===null&&userId.length<1)){_context2.next=5;break;}setMessage('Сотрудник не назначен');_context2.next=10;break;case 5:_context2.next=7;return axios.put('/api/Vacations/',ChangeData);case 7:res=_context2.sent;setMessage('Сохранено');window.location.reload();case 10:case\"end\":return _context2.stop();}}},_callee2);}));return function ChangeDataButton(){return _ref3.apply(this,arguments);};}();var handleInputChange=function handleInputChange(e){var term=e.target.value;if(term===''){setSearchTerm(null);}else{setSearchTerm(term);}var filtered=users.filter(function(user){return user.user_name&&user.user_name.toLowerCase().includes(term.toLowerCase());});if(term===''){setUser_name('');}else{setFilteredUsers(filtered);// всегда устанавливаем filteredUsers\n}};var handleUserClick=function handleUserClick(userName,userId){setUserId(userId);console.log('old=',userId);setSearchTerm(userName);setFilteredUsers([]);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"MessageItemVacancies\",children:/*#__PURE__*/_jsx(\"span\",{children:message})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"ModalInputVacancies\",value:inputValueVacanciesName,onChange:handleNameInputChange})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"textarea\",{className:\"textDescription\",value:inputValueDescription,onChange:handleDescriptionInputChange})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u041F\\u043E\\u0434\\u0440\\u0430\\u0437\\u0434\\u0435\\u043B\\u0435\\u043D\\u0438\\u0435:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"select\",{ref:departRef,value:selectDep,onChange:selectDeps,className:\"InputVacanciesItemDeps\",children:deps.map(function(dep,name){return/*#__PURE__*/_jsx(\"option\",{value:dep.id,children:dep.department_name},name);})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"select\",{ref:statusRef,value:inputValueStatuses,onChange:selectValue,className:\"InputVacanciesItemSelect\",children:status.map(function(status,name){return/*#__PURE__*/_jsx(\"option\",{value:status.id,children:status.name},name);})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0413\\u0440\\u0435\\u0439\\u0434:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:inputValueGrade,onChange:handleGradeInputChange,placeholder:\"\\u0413\\u0440\\u0435\\u0439\\u0434\",className:\"InputVacanciesItem\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u041A\\u043E\\u043C\\u043F\\u0430\\u043D\\u0438\\u044F:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"select\",{ref:companyRef,value:selectCompany,onChange:companySelect,className:\"InputVacanciesItemSelect\",children:company.map(function(company,name){return/*#__PURE__*/_jsx(\"option\",{value:company.id,children:company.name},name);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0418\\u043C\\u044F \\u0441\\u043E\\u0442\\u0440\\u0443\\u0434\\u043D\\u0438\\u043A\\u0430:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"inputDiv\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0418\\u043C\\u044F \\u0441\\u043E\\u0442\\u0440\\u0443\\u0434\\u043D\\u0438\\u043A\\u0430\",value:searchTerm||allDateUser&&allDateUser.user_name,onChange:handleInputChange,className:\"InputVacanciesItem\"}),filteredUsers.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"userListContainer\",children:filteredUsers.map(function(user,index){return/*#__PURE__*/_jsx(\"div\",{className:\"selectNameDiv\",value:user.id,onClick:function onClick(){return handleUserClick(user.user_name,user.id);},children:user.user_name},index);})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0414\\u0430\\u0442\\u0430 \\u0432\\u044B\\u0445\\u043E\\u0434\\u0430:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",ref:DateReleaseRef,placeholder:\"\\u0418\\u0422\\u0421\",className:\"InputVacanciesItem\",value:plannedReleaseDate,onChange:DataCurrent})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0418\\u0422\\u0421:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",ref:ITCRef,value:selectItc,onChange:SelectITC,placeholder:\"\\u0418\\u0422\\u0421\",className:\"InputVacanciesItem\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u041F\\u0440\\u043E\\u0435\\u043A\\u0442:\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",ref:projectRef,value:projectItem,onChange:Project,placeholder:\"\\u041F\\u0440\\u043E\\u0435\\u043A\\u0442(\\u041D\\u0435\\u0442 \\u043F\\u0440\\u043E\\u0435\\u043A\\u0442\\u0430=0)\",className:\"InputVacanciesItem\"})]})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"divHistory\",children:\"\\u0418\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",onClick:ChangeDataButton,children:\"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"})})]})]});};export default ModalVacanciesItem;","map":{"version":3,"sources":["D:/time_app/client/src/components/VacanciesItem/ModalVacanciesItem/ModalVacanciesItem.jsx"],"names":["React","useEffect","useRef","useState","axios","moment","ModalVacanciesItem","allDateUser","setInputValueVacanciesName","vacancies_name","setInputValueGrade","grade","setSelectDep","vacancies_department_id","setInputValueDescription","description","setInputValueStatuses","vacancies_status_id","setSelectCompany","company_id","setSelectItc","vacancy_code","setProjectItem","project_id","setVacanciesId","vacancy_id","setOld_user","id","planned_release_date","date","format","setPlannedReleaseDate","console","log","plannedReleaseDate","status","setStatus","selectDep","company","setCompany","selectCompany","selectItc","projectItem","message","setMessage","vacanciesId","inputValueVacanciesName","old_user","inputValueDescription","inputValueStatuses","inputValueGrade","user_name","setUser_name","searchTerm","setSearchTerm","userId","setUserId","filteredUsers","setFilteredUsers","users","setUsers","statusRef","departRef","companyRef","ITCRef","projectRef","DateReleaseRef","Department","get","statuses","data","departs","setDeps","user","deps","handleNameInputChange","e","target","value","handleDescriptionInputChange","handleGradeInputChange","test","selectValue","current","selectDeps","companySelect","SelectITC","Project","DataCurrent","ChangeDataButton","ChangeData","namevacanciesId","namevacancies","length","search","put","res","window","location","reload","handleInputChange","term","filtered","filter","toLowerCase","includes","handleUserClick","userName","map","dep","name","department_name","index"],"mappings":"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","sourcesContent":["import React, {useEffect, useRef, useState} from \"react\";\r\nimport axios from \"axios\";\r\nimport moment from \"moment\";\r\n\r\nconst ModalVacanciesItem =({allDateUser})=> {\r\n\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        if (allDateUser) {\r\n            setInputValueVacanciesName(allDateUser.vacancies_name)\r\n            setInputValueGrade(allDateUser.grade)\r\n            setSelectDep(allDateUser.vacancies_department_id)\r\n            setInputValueDescription(allDateUser.description)\r\n            setInputValueStatuses(allDateUser.vacancies_status_id)\r\n            setSelectCompany(allDateUser.company_id)\r\n            setSelectItc(allDateUser.vacancy_code)\r\n            setProjectItem(allDateUser.project_id)\r\n            setVacanciesId(allDateUser.vacancy_id)\r\n            setOld_user(allDateUser.id)\r\n\r\n\r\n            if(allDateUser.planned_release_date!==null)\r\n            {\r\n                const date = moment(allDateUser.planned_release_date).format('YYYY-MM-DD')\r\n                setPlannedReleaseDate(date)\r\n            }\r\n\r\n            console.log('allDateUser.planned_release_date=',plannedReleaseDate)\r\n        } else {\r\n            console.log('allDateUser или allDateUser.vacancies_name не определен');\r\n        }\r\n\r\n\r\n    }, [allDateUser]);\r\n\r\n\r\n\r\n    const [status, setStatus] = useState([])\r\n    const [selectDep, setSelectDep] = useState(\"\")\r\n\r\n    const [company, setCompany] = useState([])\r\n    const [selectCompany, setSelectCompany] = useState([])\r\n\r\n\r\n    const [selectItc, setSelectItc] = useState([])\r\n\r\n    const [projectItem, setProjectItem] = useState([])\r\n\r\n    const [message, setMessage] = useState(\"\")\r\n\r\n\r\n    const [plannedReleaseDate, setPlannedReleaseDate] = useState([])\r\n\r\n    const [vacanciesId, setVacanciesId] = useState(\"\")\r\n\r\n    const [inputValueVacanciesName, setInputValueVacanciesName] = useState('')\r\n\r\n    const [old_user, setOld_user] = useState(\"\")\r\n\r\n    const [inputValueDescription, setInputValueDescription] = useState(\"\")\r\n\r\n    const [inputValueStatuses, setInputValueStatuses] = useState(\"\")\r\n\r\n    const [inputValueGrade, setInputValueGrade] = useState(\"\")\r\n\r\n    const [user_name, setUser_name] = useState('')\r\n\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [userId, setUserId] = useState([])\r\n    const [filteredUsers, setFilteredUsers] = useState([]);\r\n    const [users, setUsers] = useState([])\r\n\r\n\r\n    const statusRef = useRef()\r\n    const departRef = useRef()\r\n    const companyRef = useRef()\r\n    const ITCRef = useRef()\r\n    const projectRef = useRef()\r\n    const DateReleaseRef = useRef()\r\n\r\n    useEffect(() => {\r\n        const Department = async () => {\r\n            const statuses = await axios.get('/api/Vacations/?status=status')\r\n            setStatus(statuses.data)\r\n            const departs = await axios.get('/api/departments/')\r\n            setDeps(departs.data)\r\n            const company = await axios.get('/api/Vacations/?company=company')\r\n            setCompany(company.data)\r\n            const user = await axios.get('/api/user')\r\n            setUsers(user.data)\r\n\r\n        }\r\n\r\n        Department()\r\n    }, [])\r\n    const [deps, setDeps] = useState([])\r\n\r\n    const handleNameInputChange = (e) => {\r\n        setInputValueVacanciesName(e.target.value)\r\n    }\r\n\r\n\r\n    // Обработчик изменения значения для поля ввода с grade\r\n    const handleDescriptionInputChange = (e) => {\r\n        setInputValueDescription(e.target.value);\r\n    }\r\n\r\n    const handleGradeInputChange = (e) => {\r\n        // Проверяем, является ли введенное значение числом (включая пустое значение)\r\n        if (/^\\d*$/.test(e.target.value)) {\r\n            setInputValueGrade(e.target.value);\r\n        }\r\n    };\r\n\r\n\r\n    const selectValue = () => {\r\n        setInputValueStatuses(statusRef.current.value)\r\n    }\r\n\r\n    const selectDeps = () => {\r\n        setSelectDep(departRef.current.value)\r\n    }\r\n\r\n    const companySelect = () => {\r\n        setSelectCompany(companyRef.current.value)\r\n    }\r\n\r\n    const SelectITC = () => {\r\n        setSelectItc(ITCRef.current.value)\r\n    }\r\n\r\n    const Project = (e) => {\r\n        if (/^\\d*$/.test(e.target.value)) {\r\n            setProjectItem(e.target.value);\r\n        }\r\n    }\r\n\r\n    const DataCurrent = () => {\r\n        setPlannedReleaseDate(DateReleaseRef.current.value)\r\n        console.log('DateReleaseRef.current.valu=',DateReleaseRef.current.value)\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    const ChangeDataButton = async () => {\r\n\r\n        const ChangeData = {\r\n            namevacanciesId: vacanciesId,\r\n            namevacancies: inputValueVacanciesName,\r\n            description: inputValueDescription,\r\n            grade: inputValueGrade,\r\n            statuses: statusRef.current.value,\r\n            users: (userId.length===0 ? old_user : userId),\r\n            search: userId,\r\n            old_user: old_user,\r\n            deps: selectDep,\r\n            company_id: selectCompany,\r\n            vacancy_code: selectItc,\r\n            project_id: projectItem,\r\n            planned_release_date:DateReleaseRef.current.value.length===0 ? null :DateReleaseRef.current.value\r\n        }\r\n\r\n        if (statusRef.current.value === '3' && old_user===null && userId.length<1) {\r\n            setMessage('Сотрудник не назначен')\r\n        }\r\n\r\n\r\n        else {\r\n            const res = await axios.put('/api/Vacations/', ChangeData)\r\n            setMessage('Сохранено')\r\n            window.location.reload()\r\n        }\r\n\r\n    }\r\n    const handleInputChange = (e) => {\r\n        const term = e.target.value;\r\n        if(term==='') {\r\n            setSearchTerm(null)\r\n        }\r\n        else {\r\n            setSearchTerm(term);\r\n        }\r\n        const filtered = users.filter(user =>\r\n            user.user_name && user.user_name.toLowerCase().includes(term.toLowerCase())\r\n        )\r\n\r\n        if (term === '') {\r\n            setUser_name('')\r\n        } else {\r\n            setFilteredUsers(filtered); // всегда устанавливаем filteredUsers\r\n        }\r\n    }\r\n\r\n\r\n\r\n    const handleUserClick = (userName,userId) => {\r\n\r\n        setUserId(userId)\r\n        console.log('old=',userId)\r\n        setSearchTerm(userName)\r\n        setFilteredUsers([])\r\n\r\n    }\r\n\r\n\r\n\r\n        return (\r\n            <div>\r\n                <div className='MessageItemVacancies'>\r\n                    <span >{message}</span>\r\n                </div>\r\n                <div>\r\n                    <input type='text' className=\"ModalInputVacancies\"\r\n                           value={inputValueVacanciesName}\r\n                           onChange={handleNameInputChange}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <textarea className='textDescription'\r\n                              value={inputValueDescription}\r\n                              onChange={handleDescriptionInputChange}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <span>Подразделение:</span><br/>\r\n                    <select ref={departRef}\r\n                            value={selectDep}\r\n                            onChange={selectDeps}\r\n                            className='InputVacanciesItemDeps'>\r\n                        {deps.map((dep, name) => <option key={name}\r\n                                                         value={dep.id}>{dep.department_name}</option>)}\r\n                    </select>\r\n                </div>\r\n\r\n                <div>\r\n                    <span>Статус:</span><br/>\r\n                    <select ref={statusRef}\r\n                            value={inputValueStatuses}\r\n                            onChange={selectValue}\r\n                            className='InputVacanciesItemSelect'>\r\n                        {status.map((status, name) => <option key={name}\r\n                                                              value={status.id}>{status.name}</option>)}\r\n                    </select>\r\n                </div>\r\n\r\n                <div>\r\n                    <span>Грейд:</span><br/>\r\n                    <input type='text'\r\n                           value={inputValueGrade}\r\n                           onChange={handleGradeInputChange}\r\n                           placeholder='Грейд'\r\n                           className='InputVacanciesItem'\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <span>Компания:</span><br/>\r\n                    <select ref={companyRef}\r\n                            value={selectCompany}\r\n                            onChange={companySelect}\r\n                            className='InputVacanciesItemSelect'>\r\n                        {company.map((company, name) => <option key={name} value={company.id}>{company.name}</option>)}\r\n                    </select>\r\n                </div>\r\n\r\n                <div className=\"container\">\r\n                    <div>\r\n\r\n                        <span>Имя сотрудника:</span><br/>\r\n                        <div className='inputDiv'>\r\n                            <input\r\n                                type='text'\r\n                                placeholder='Имя сотрудника'\r\n                                value={searchTerm || (allDateUser && allDateUser.user_name)}\r\n                                onChange={handleInputChange}\r\n                                className='InputVacanciesItem'\r\n                            />\r\n\r\n                            {filteredUsers.length > 0 && (\r\n                                <div className=\"userListContainer\">\r\n                                    {filteredUsers.map((user, index) => (\r\n                                        <div className='selectNameDiv' key={index} value={user.id}\r\n                                             onClick={() => handleUserClick(user.user_name, user.id)}>\r\n                                            {user.user_name}\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <div>\r\n                            <span>Дата выхода:</span><br/>\r\n                            <input type='date'\r\n                                   ref={DateReleaseRef}\r\n                                   placeholder='ИТС'\r\n                                   className='InputVacanciesItem'\r\n                                   value={plannedReleaseDate}\r\n                                   onChange={DataCurrent}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <span>ИТС:</span><br/>\r\n                            <input type='text'\r\n                                   ref={ITCRef}\r\n                                   value={selectItc}\r\n                                   onChange={SelectITC}\r\n                                   placeholder='ИТС'\r\n                                   className='InputVacanciesItem'\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <span>Проект:</span><br/>\r\n                            <input type='text'\r\n                                   ref={projectRef}\r\n                                   value={projectItem}\r\n                                   onChange={Project}\r\n                                   placeholder='Проект(Нет проекта=0)'\r\n                                   className='InputVacanciesItem'\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <br/>\r\n                    <div className='divHistory'>\r\n                        История\r\n                    </div>\r\n                    <br/>\r\n                    <div>\r\n                        <button className=\"ModalButton\" type=\"submit\" onClick={ChangeDataButton}>\r\n                            Сохранить\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n\r\n}\r\n\r\nexport default ModalVacanciesItem;"]},"metadata":{},"sourceType":"module"}