{"ast":null,"code":"import _regeneratorRuntime from\"D:/Download/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{ExitToApp}from'@material-ui/icons';import axios from'axios';import React,{useEffect,useState}from'react';import SearchBlock from'../SearchBlock/SearchBlock';import{Link,useParams}from'react-router-dom';import logo from'./VTB.png';import'./Topbar.css';import Status from'../Status/Status';import Modal from\"../Templates/Modal/Modal\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function Topbar(){var _useState=useState(0),_useState2=_slicedToArray(_useState,2),countWork=_useState2[0],setCountWork=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),countNotatWork=_useState4[0],setCountNotatWork=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),countVacation=_useState6[0],setCountVacation=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),countSickLeave=_useState8[0],setCountSickLeave=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),countTimeOff=_useState10[0],setCountTimeOff=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),countOther=_useState12[0],setCountOther=_useState12[1];var departId=useParams().username;useEffect(function(){var fetchUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,filterUsers;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/user/');case 2:res=_context.sent;res.data.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});filterUsers=filterUser(res.data);setAllUsers(filterUsers);case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetchUser(){return _ref.apply(this,arguments);};}();var fetchUserName=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get('/api/user/'+localUser._id);case 2:res=_context2.sent;setUser(res.data);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function fetchUserName(){return _ref2.apply(this,arguments);};}();var count=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.get('/api/count');case 2:res=_context3.sent;setCountWork(res.data[0].count);setCountNotatWork(res.data[1].count);setCountVacation(res.data[2].count);setCountSickLeave(res.data[3].count);setCountTimeOff(res.data[4].count);setCountOther(res.data[5].count);case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function count(){return _ref3.apply(this,arguments);};}();count();fetchUserName();fetchUser();},[]);function filterUser(users){return users.filter(function(user){return user.status===1;}).concat(users.filter(function(user){return user.status===2;})).concat(users.filter(function(user){return user.status===3;})).concat(users.filter(function(user){return user.status!==1&&user.status!==2&&user.status!==3&&user.status!==4;})).concat(users.filter(function(user){return user.status===4;}));}var localUser=JSON.parse(localStorage.getItem('user'));var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),user=_useState14[0],setUser=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),searchValue=_useState16[0],setSearchValue=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),allUsers=_useState18[0],setAllUsers=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),findUsers=_useState20[0],setFindUsers=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isBlock=_useState22[0],setIsBlock=_useState22[1];// выход\nvar logOut=function logOut(){localStorage.clear();window.location.reload();window.location.href='/';};// получение всех пользователей\n//Поиск пользователя\nvar handleKeyPress=function handleKeyPress(e){if(e.key==='Enter'&&e.target.value!==''){setFindUsers(allUsers.filter(function(user){return user.user_name.toLowerCase().includes(searchValue.toLowerCase());}));setIsBlock(true);}};//Поиск пользователя\nvar handleClick=function handleClick(e){if(e.target.value!==''){setFindUsers(allUsers.filter(function(user){return user.user_name.toLowerCase().includes(searchValue.toLowerCase());}));setIsBlock(true);}};if(user.main_department===departId){}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"topbarContainer\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"topbarLeft\",children:/*#__PURE__*/_jsx(Status,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"topbarCenter\",children:/*#__PURE__*/_jsxs(\"div\",{style:{paddingLeft:'100px'},children:[/*#__PURE__*/_jsx(Link,{to:\"/department/\".concat(user.id),className:\"depsUser\",style:{fontWeight:\"bold\"},children:/*#__PURE__*/_jsx(\"p\",{title:\"\\u041F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0435\\u0439 \\u0432 \\u0440\\u0430\\u0431\\u043E\\u0442\\u0435\",children:/*#__PURE__*/_jsx(\"span\",{className:\"node\",children:user.id})})}),\"/\",countNotatWork,\"/\",countVacation,\"/\",countSickLeave,\"/\",countTimeOff,\"/\",countOther]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"topbarRight\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"topbarLinks\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Link,{to:\"/department/\".concat(localUser.main_department),className:\"topbarLink\",children:/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"VTB\",width:\"150\",height:\"50\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"vr\"}),/*#__PURE__*/_jsx(\"div\",{className:\"topPage\",children:/*#__PURE__*/_jsx(Link,{to:\"/profile/\".concat(user.id),onClick:function onClick(){return window.location.href=\"/profile/\".concat(user.id);},className:\"topbarLink\",children:user.user_name})}),/*#__PURE__*/_jsx(\"div\",{className:\"vr\"}),localUser.isAdmin?/*#__PURE__*/_jsxs(\"div\",{className:\"topPage\",children:[/*#__PURE__*/_jsx(Link,{to:\"/Reports\",className:\"topbarLink\",children:/*#__PURE__*/_jsx(\"span\",{className:\"link\",children:\"\\u041E\\u0442\\u0447\\u0435\\u0442\\u044B\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"vr\"})]}):'',/*#__PURE__*/_jsx(\"div\",{className:\"topPage\",children:/*#__PURE__*/_jsx(Link,{to:\"/information\",className:\"topbarLink\",children:/*#__PURE__*/_jsx(\"span\",{className:\"link\",children:\"?\"})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"search\",children:[/*#__PURE__*/_jsx(\"input\",{onKeyPress:handleKeyPress,value:searchValue,onChange:function onChange(e){return setSearchValue(e.target.value);},type:\"search\",name:\"\",placeholder:\"\\u043F\\u043E\\u0438\\u0441\\u043A\",className:\"input\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleClick,value:searchValue,onChange:function onChange(e){return setSearchValue(e.target.value);},type:\"submit\",className:\"submit\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{paddingLeft:'50px'},children:/*#__PURE__*/_jsx(ExitToApp,{className:\"exit\",onClick:logOut})})]})]}),isBlock?/*#__PURE__*/_jsxs(Modal,{active:handleClick,setActive:setIsBlock,children:[/*#__PURE__*/_jsx(\"h1\",{children:/*#__PURE__*/_jsx(\"p\",{align:\"center\",children:\"\\u041F\\u043E\\u0438\\u0441\\u043A\"})}),/*#__PURE__*/_jsxs(\"h4\",{children:[\"\\u041D\\u0430\\u0439\\u0434\\u0435\\u043D\\u043E: \",findUsers.length]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",children:[/*#__PURE__*/_jsx(\"div\",{children:findUsers.map(function(user){return/*#__PURE__*/_jsx(SearchBlock,{user:user});})}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",onClick:function onClick(){return setIsBlock(false);},children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"})]})]}):/*#__PURE__*/_jsx(_Fragment,{})]});}","map":{"version":3,"sources":["D:/Download/time_app/client/src/components/Topbar/Topbar.jsx"],"names":["ExitToApp","axios","React","useEffect","useState","SearchBlock","Link","useParams","logo","Status","Modal","Topbar","countWork","setCountWork","countNotatWork","setCountNotatWork","countVacation","setCountVacation","countSickLeave","setCountSickLeave","countTimeOff","setCountTimeOff","countOther","setCountOther","departId","username","fetchUser","get","res","data","sort","a","b","user_name","localeCompare","filterUsers","filterUser","setAllUsers","fetchUserName","localUser","_id","setUser","count","users","filter","user","status","concat","JSON","parse","localStorage","getItem","searchValue","setSearchValue","allUsers","findUsers","setFindUsers","isBlock","setIsBlock","logOut","clear","window","location","reload","href","handleKeyPress","e","key","target","value","toLowerCase","includes","handleClick","main_department","paddingLeft","id","fontWeight","isAdmin","length","map"],"mappings":"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","sourcesContent":["import { ExitToApp } from '@material-ui/icons'\r\nimport axios from 'axios'\r\nimport React, {useEffect, useState} from 'react'\r\nimport SearchBlock from '../SearchBlock/SearchBlock'\r\nimport {Link, useParams} from 'react-router-dom'\r\nimport logo from './VTB.png'\r\n\r\nimport './Topbar.css'\r\nimport Status from '../Status/Status'\r\nimport Modal from \"../Templates/Modal/Modal\";\r\n\r\nexport default function Topbar() {\r\n  const [countWork,setCountWork] = useState(0)\r\n  const [countNotatWork,setCountNotatWork] = useState(0)\r\n  const [countVacation,setCountVacation] = useState(0)\r\n  const [countSickLeave,setCountSickLeave] = useState(0)\r\n  const [countTimeOff,setCountTimeOff] = useState(0)\r\n  const [countOther,setCountOther] = useState(0)\r\n  const departId = useParams().username\r\n\r\n\r\n  useEffect(() => {\r\n\r\n    const fetchUser = async () => {\r\n      const res = await axios.get('/api/user/')\r\n      res.data.sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n      let filterUsers = filterUser(res.data)\r\n      setAllUsers(filterUsers)\r\n    }\r\n\r\n    const fetchUserName = async () => {\r\n      const res = await axios.get('/api/user/' + localUser._id)\r\n      setUser(res.data)\r\n    }\r\n\r\n    const count = async () => {\r\n      const res = await axios.get('/api/count')\r\n     setCountWork(res.data[0].count)\r\n     setCountNotatWork(res.data[1].count)\r\n      setCountVacation(res.data[2].count)\r\n      setCountSickLeave(res.data[3].count)\r\n      setCountTimeOff(res.data[4].count)\r\n      setCountOther(res.data[5].count)\r\n\r\n\r\n    }\r\n\r\n    count()\r\n    fetchUserName()\r\n    fetchUser()\r\n\r\n  }, [])\r\n\r\n\r\n  function filterUser(users) {\r\n    return users.filter(user => user.status === 1)\r\n        .concat(users.filter(user => user.status === 2))\r\n        .concat(users.filter(user => user.status === 3))\r\n        .concat(users.filter(user => user.status !== 1 && user.status !== 2 && user.status !== 3 && user.status !== 4))\r\n        .concat(users.filter(user => user.status === 4))\r\n  }\r\n\r\n  const localUser = JSON.parse(localStorage.getItem('user'))\r\n  const [user, setUser] = useState([])\r\n  const [searchValue, setSearchValue] = useState(\"\")\r\n  const [allUsers, setAllUsers] = useState([])\r\n  const [findUsers, setFindUsers] = useState([])\r\n  const [isBlock, setIsBlock] = useState(false)\r\n\r\n  // выход\r\n  const logOut = () => {\r\n    localStorage.clear()\r\n    window.location.reload()\r\n    window.location.href = '/'\r\n  }\r\n\r\n  // получение всех пользователей\r\n\r\n\r\n      //Поиск пользователя\r\n  const handleKeyPress = (e) => {\r\n    if(e.key === 'Enter' && e.target.value!=='' ){\r\n      setFindUsers(allUsers.filter(user => {return user.user_name.toLowerCase().includes(searchValue.toLowerCase())}))\r\n      setIsBlock(true)\r\n    }\r\n  }\r\n     //Поиск пользователя\r\n  const handleClick =(e)=>{\r\n    if(e.target.value!==''){\r\n      setFindUsers(allUsers.filter(user => {return user.user_name.toLowerCase().includes(searchValue.toLowerCase())}))\r\n      setIsBlock(true)\r\n    }}\r\n  if(user.main_department===departId) {\r\n  }\r\n\r\n\r\n\r\n  return (\r\n    <div>\r\n      <div className='topbarContainer'>\r\n        <div className=\"topbarLeft\">\r\n          <Status/>\r\n        </div>\r\n        <div className=\"topbarCenter\">\r\n\r\n          <div style={{paddingLeft:'100px'}}>\r\n\r\n            <Link to={`/department/${user.id}`} className='depsUser' style={{fontWeight: `bold`}}><p title=\"Пользователей в работе\"><span className=\"node\">{user.id}</span></p></Link>/{countNotatWork}/{countVacation}/{countSickLeave}/{countTimeOff}/{countOther}\r\n\r\n          </div>\r\n\r\n{/*          { <div className=\"searchbar\">\r\n            <Search/>\r\n            <input value={searchValue} onChange={(e) => setSearchValue(e.target.value)} onKeyPress={handleKeyPress} placeholder='Найти...' className=\"searchInput\" />\r\n          </div> }*/}\r\n        </div>\r\n        <div className=\"topbarRight\">\r\n          <div className=\"topbarLinks\">\r\n            <div>\r\n              <Link to={`/department/${localUser.main_department}`} className=\"topbarLink\"><img src={logo} alt='VTB' width='150' height='50'/></Link>\r\n            </div>\r\n            {/*<div className='topPage'><Link to={`/department/${user.main_department}`} className=\"topbarLink\"><span className='topPage'>Главная cтраница</span></Link></div>*/}\r\n            <div className='vr'></div>\r\n            {/*<a href=\"/#\"  className=\"icon\"><h1>&#9776;</h1></a>*/}\r\n            <div className='topPage'><Link to={`/profile/${user.id}`} onClick={() => window.location.href = `/profile/${user.id}`}className=\"topbarLink\">{user.user_name}</Link></div><div className='vr'></div>\r\n            {localUser.isAdmin\r\n                ?\r\n            <div className='topPage'>\r\n              <Link to='/Reports' className=\"topbarLink\"><span className='link'>Отчеты</span></Link>\r\n              <div className='vr'></div></div> :''}\r\n            <div className='topPage'>\r\n              <Link to='/information' className=\"topbarLink\"><span className='link'>?</span></Link></div>\r\n          </div>\r\n              <div className=\"search\">\r\n            <input onKeyPress={handleKeyPress} value={searchValue} onChange={(e) => setSearchValue(e.target.value)}  type=\"search\" name=\"\" placeholder=\"поиск\" className=\"input\"/>\r\n                 <button onClick={handleClick} value={searchValue} onChange={(e) => setSearchValue(e.target.value)} type=\"submit\"  className=\"submit\"/>\r\n                </div>\r\n          <div style={{paddingLeft:'50px'}}>\r\n          <ExitToApp  className=\"exit\" onClick={logOut}/>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {isBlock\r\n        ?  <Modal active={handleClick} setActive={setIsBlock}>\r\n            <h1><p align=\"center\">Поиск</p></h1>\r\n            <h4>Найдено: {findUsers.length}</h4>\r\n            <hr/>\r\n            <form className=\"modalLoginBox\" >\r\n              <div>\r\n              {findUsers.map((user) => <SearchBlock user={user}/>)}\r\n              </div>\r\n              <button className=\"ModalButton\" type=\"submit\" onClick={() => setIsBlock(false)}>\r\n                Закрыть\r\n              </button>\r\n            </form>\r\n          </Modal>\r\n        : <></>\r\n      }\r\n    </div>\r\n  )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}