{"ast":null,"code":"var _jsxFileName = \"D:\\\\time_app\\\\client\\\\src\\\\components\\\\ProfileInfo\\\\Editing\\\\Editing.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport Modal from \"../../Templates/Modal/Modal\";\nimport axios from \"axios\";\nimport { useParams } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Editing({\n  modalActive,\n  setModalActive\n}) {\n  _s();\n\n  const username = useParams();\n  const [error, setError] = useState('');\n  const [selectedValue, setSelectedValue] = useState('');\n  const [cityName, setCityName] = useState([]);\n  const [user, setUser] = useState([]);\n  const [nameValue, setNameValue] = useState(\"\");\n  const [email, setEmail] = useState([]);\n  const [emailChange, setEmailChange] = useState([]);\n  const [phone, setPhone] = useState([]);\n  const [phoneChange, setPhoneChange] = useState([]);\n  const [additional_contact, setAdditional_Contact] = useState([]);\n  const [additional_contact_change, setAdditional_Contact_Change] = useState([]);\n  const [distribution_group, setDistribution_Group] = useState([]);\n  const [distribution_group_change, setDistribution_Group_Change] = useState([]);\n  const [activity_profile, setActivity_Profile] = useState([]);\n  const [activity_profile_change, setActivity_Profile_Change] = useState([]);\n  const [CityPlace, setCityPlace] = useState([]);\n  const [CityPlace_Change, setCityPlace_Change] = useState([]);\n  const [surnameValue, setSurnameValue] = useState([]);\n  const [options, setOptions] = useState([]);\n  const localUse = JSON.parse(localStorage.getItem('user'));\n  const modalDep = useRef();\n  const phoneNumber = useRef();\n  const additionalContact = useRef();\n  const distributionGroup = useRef();\n  const activityProfile = useRef();\n  const modalCity = useRef();\n  const modalCityPlace = useRef();\n  const [citiesId, setCitiesId] = useState([]);\n  const [searchTermCities, setSearchTermCities] = useState('');\n  const [filteredCities, setFilteredCities] = useState([]);\n  const [cities, setCities] = useState([]);\n\n  const handleUserClickCities = (city_name, id) => {\n    setCitiesId(id);\n    setSearchTermCities(city_name);\n    setFilteredCities([]);\n  };\n\n  const handleInputChangeCities = e => {\n    const termCities = e.target.value;\n    setSearchTermCities(termCities);\n\n    if (termCities === '') {\n      setCitiesId('');\n      setFilteredCities([]);\n      setCityName('');\n      return;\n    }\n\n    const filtered = cities.filter(city => city.city_name && city.city_name.toLowerCase().includes(termCities.toLowerCase()));\n    setFilteredCities(filtered);\n  };\n\n  useEffect(() => {\n    const getNameAndSurname = () => {\n      if (user.user_name) {\n        const [name, surname] = user.user_name.split(\" \");\n        setSurnameValue(surname || \"\");\n        setNameValue(name);\n      }\n    };\n\n    const getDeps = async () => {\n      const res = await axios.get('/api/department_tree_to_json/');\n      const data = res.data[0]['department_tree_to_json'];\n      const extractedOptions = extractOptions(data);\n      setOptions(extractedOptions);\n      setSelectedValue(user.department_id);\n    };\n\n    const extractOptions = node => {\n      let optionsList = [{\n        id: node.id,\n        name: node.Name\n      }];\n\n      if (node.Subclasses && node.Subclasses.length > 0) {\n        node.Subclasses.forEach(subclass => {\n          optionsList = optionsList.concat(extractOptions(subclass));\n        });\n      }\n\n      return optionsList;\n    };\n\n    const getNameDeps = async () => {\n      const deps = {\n        user: username.username\n      };\n      const res = await axios.post('/api/departments/', deps);\n      setCityName(res.data[0]['city_name']);\n    };\n\n    const fetchUser = async () => {\n      const res = await axios.get('/api/user/' + username.username);\n      setUser(res.data);\n      const city = await axios.get('/api/Cities/');\n      setCities(city.data);\n    }; // Номинации\n\n\n    if (user && user.email && email) {\n      setEmail(user.email);\n    }\n\n    if (user && user.phone_number && phone) {\n      setPhone(user.phone_number);\n    }\n\n    if (user && user.additional_contact && additional_contact) {\n      setAdditional_Contact(user.additional_contact);\n    }\n\n    if (user && user.distribution_group && distribution_group) {\n      setDistribution_Group(user.distribution_group);\n    }\n\n    if (user && user.activity_profile && activity_profile) {\n      setActivity_Profile(user.activity_profile);\n    }\n\n    if (user && user.place_of_residence && CityPlace) {\n      setCityPlace(user.place_of_residence);\n    }\n\n    getNameAndSurname();\n    fetchUser();\n    getDeps();\n    getNameDeps();\n  }, [user.user_name, user.email, user.phone_number, user.additional_contact, user.distribution_group, user.activity_profile, user.place_of_residence, username.username]);\n\n  const handleEmailChange = e => {\n    if (e.target.value) {\n      setEmail('');\n      setEmailChange(e.target.value);\n    }\n\n    if (e.target.value === '') {\n      setEmail('');\n      setEmailChange('');\n    }\n  };\n\n  const formatPhoneNumber = value => {\n    // Убираем все символы, кроме цифр\n    let cleaned = value.replace(/\\D/g, '');\n\n    if (cleaned.startsWith('7')) {\n      cleaned = cleaned.slice(1); // Удаляем ведущую 7, если она уже присутствует после +\n    } // Ограничиваем длину очищенного значения до 10 цифр (XXX-XXX-XX-XX без кода страны)\n\n\n    cleaned = cleaned.slice(0, 10); // Разделяем на части, добавляя дефисы\n\n    const match = cleaned.match(/^(\\d{0,3})(\\d{0,3})(\\d{0,2})(\\d{0,2})$/);\n\n    if (match) {\n      return '+7 ' + [match[1], match[2], match[3], match[4]].filter(Boolean).join('-');\n    }\n\n    return '+7 ' + cleaned;\n  };\n\n  const handlePhoneChange = e => {\n    if (e.target.value) {\n      setPhone('');\n      setPhoneChange(e.target.value);\n    }\n\n    if (e.target.value === '') {\n      setPhone('');\n      setPhoneChange('');\n    }\n\n    const value = e.target.value;\n\n    if (value.length < 1) {\n      setPhoneChange('');\n    } else {\n      const formattedValue = formatPhoneNumber(value);\n      setPhoneChange(formattedValue);\n    }\n  };\n\n  const additional_Contact = e => {\n    if (e.target.value) {\n      setAdditional_Contact('');\n      setAdditional_Contact_Change(e.target.value);\n    }\n\n    if (e.target.value === '') {\n      setAdditional_Contact('');\n      setAdditional_Contact_Change('');\n    }\n  };\n\n  const distribution_Group = e => {\n    if (e.target.value) {\n      setDistribution_Group('');\n      setDistribution_Group_Change(e.target.value);\n    }\n\n    if (e.target.value === '') {\n      setDistribution_Group('');\n      setDistribution_Group_Change('');\n    }\n  };\n\n  const activity_Profile = e => {\n    if (e.target.value) {\n      setActivity_Profile('');\n      setActivity_Profile_Change(e.target.value);\n    }\n\n    if (e.target.value === '') {\n      setActivity_Profile('');\n      setActivity_Profile_Change('');\n    }\n  };\n\n  const cityPlace = e => {\n    if (e.target.value) {\n      setCityPlace('');\n      setCityPlace_Change(e.target.value);\n    }\n\n    if (e.target.value === '') {\n      setCityPlace('');\n      setCityPlace_Change('');\n    }\n  };\n\n  const handleNameChange = e => {\n    setNameValue(e.target.value);\n  };\n\n  const handleSurnameChange = e => {\n    setSurnameValue(e.target.value);\n  }; // изменение данных пользователя\n\n\n  const handleClick = async e => {\n    const name = user.user_name;\n    const part = name.split(' ');\n    e.preventDefault();\n    const newInfo = {\n      departmentId: modalDep.current.value || user.department_id,\n      email: email ? email : emailChange.toUpperCase(),\n      username: nameValue + ' ' + surnameValue,\n      _id: user.id,\n      isAdmin: user.isadmin,\n      see_child: user.see_child,\n      status: user.status,\n      main_department: user.main_department,\n      phone_number: phoneNumber.current.value === '' ? '' : phoneNumber.current.value,\n      additional_contact: additionalContact.current.value,\n      distribution_group: distributionGroup.current.value,\n      activity_profile: activityProfile.current.value,\n      city_id: citiesId,\n      cityPlaceChange: modalCityPlace.current.value\n    };\n\n    if (localUse._id !== username.username) {\n      const newInfo2 = {\n        departmentId: modalDep.current.value || user.department_id,\n        email: email ? email : emailChange.toUpperCase(),\n        username: nameValue + ' ' + surnameValue,\n        phone_number: phoneNumber.current.value === '' ? '' : phoneNumber.current.value,\n        additional_contact: additionalContact.current.value,\n        distribution_group: distributionGroup.current.value,\n        activity_profile: activityProfile.current.value,\n        city_id: citiesId,\n        _id: user.id,\n        cityPlaceChange: modalCityPlace.current.value\n      };\n      await axios.put('/api/user/', newInfo2);\n      window.location.reload();\n    } else {\n      await axios.put('/api/user/', newInfo);\n      delete newInfo.phone_number;\n      delete newInfo.additional_contact;\n      delete newInfo.distribution_group;\n      delete newInfo.activity_profile;\n      delete newInfo.city_id;\n      delete newInfo.cityPlaceChange;\n      localStorage.setItem('user', JSON.stringify({ ...newInfo\n      }));\n      setModalActive(false);\n      window.location.reload();\n    }\n  };\n\n  const handleChange = e => {\n    setSelectedValue(e.target.value);\n  };\n\n  return /*#__PURE__*/_jsxDEV(Modal, {\n    active: modalActive,\n    setActive: setModalActive,\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 21\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 21\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modalError\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 31\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"modalLoginBox\",\n      onSubmit: handleClick,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          placeholder: \"\\u0424\\u0430\\u043C\\u0438\\u043B\\u0438\\u044F\",\n          className: \"ModalInputUpdate\",\n          onChange: handleNameChange,\n          value: nameValue\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          placeholder: \"\\u0418\\u043C\\u044F\",\n          className: \"ModalInputUpdate\",\n          onChange: handleSurnameChange,\n          value: surnameValue\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          placeholder: \"Email\",\n          type: \"email\",\n          className: \"ModalInputUpdate\",\n          onChange: handleEmailChange,\n          value: email || emailChange,\n          minLength: 6\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          placeholder: \"\\u0422\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D\",\n          type: \"text\",\n          className: \"ModalInputUpdate\",\n          ref: phoneNumber,\n          onChange: handlePhoneChange,\n          value: phone || phoneChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 366,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          placeholder: \"\\u0414\\u043E\\u043F \\u043A\\u043E\\u043D\\u0442\\u0430\\u043A\\u0442(\\u041D\\u043E\\u043C\\u0435\\u0440 \\u0442\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D\\u0430,\\u0424\\u0418\\u041E,\\u0441\\u0442\\u0430\\u0442\\u0443\\u0441 \\u0447\\u0435\\u043B\\u043E\\u0432\\u0435\\u043A\\u0430)\",\n          type: \"text\",\n          className: \"ModalInputUpdate\",\n          ref: additionalContact,\n          onChange: additional_Contact,\n          value: additional_contact || additional_contact_change\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 376,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 375,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          placeholder: \"\\u0413\\u0440\\u0443\\u043F\\u043F\\u0430 \\u0440\\u0430\\u0441\\u0441\\u044B\\u043B\\u043A\\u0438\",\n          type: \"text\",\n          className: \"ModalInputUpdate\",\n          ref: distributionGroup,\n          onChange: distribution_Group,\n          value: distribution_group || distribution_group_change\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 386,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 385,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          placeholder: \"\\u041F\\u0440\\u043E\\u0444\\u0438\\u043B\\u044C \\u0434\\u0435\\u044F\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u0438\",\n          type: \"text\",\n          className: \"ModalInputUpdate\",\n          ref: activityProfile,\n          onChange: activity_Profile,\n          value: activity_profile || activity_profile_change\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          placeholder: \"\\u0413\\u043E\\u0440\\u043E\\u0434\",\n          type: \"text\",\n          className: \"ModalInputUpdate\",\n          ref: modalCity,\n          value: searchTermCities || cityName,\n          onChange: handleInputChangeCities\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 406,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [filteredCities.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"divSelectRegister\",\n            children: filteredCities.map((city, id) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"selectNameDiv\",\n              value: city.id,\n              onClick: () => handleUserClickCities(city.city_name, city.id),\n              children: city.city_name\n            }, id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 418,\n              columnNumber: 45\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 37\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            placeholder: \"\\u0410\\u0434\\u0440\\u0435\\u0441 \\u0444\\u0430\\u043A\\u0442\\u0438\\u0447\\u0435\\u0441\\u043A\\u043E\\u0433\\u043E \\u043F\\u0440\\u043E\\u0436\\u0438\\u0432\\u0430\\u043D\\u0438\\u044F\",\n            type: \"text\",\n            className: \"ModalInputUpdate\",\n            ref: modalCityPlace,\n            onChange: cityPlace,\n            value: CityPlace || CityPlace_Change\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 425,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 405,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"select\", {\n          value: selectedValue // Привязываем значение к selectedValue\n          ,\n          onChange: handleChange,\n          ref: modalDep,\n          className: \"ModalInputUpdateSelect\",\n          children: options.map(option => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: option.id,\n            children: option.name\n          }, option.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 443,\n            columnNumber: 37\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 436,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 435,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ModalButton\",\n        type: \"submit\",\n        children: \"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 449,\n        columnNumber: 25\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 21\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 334,\n    columnNumber: 17\n  }, this);\n}\n\n_s(Editing, \"gMRoAu/aJ7uZcrSMeIQQ4LbO6fo=\", false, function () {\n  return [useParams];\n});\n\n_c = Editing;\nexport default Editing;\n\nvar _c;\n\n$RefreshReg$(_c, \"Editing\");","map":{"version":3,"sources":["D:/time_app/client/src/components/ProfileInfo/Editing/Editing.jsx"],"names":["React","useEffect","useRef","useState","Modal","axios","useParams","Editing","modalActive","setModalActive","username","error","setError","selectedValue","setSelectedValue","cityName","setCityName","user","setUser","nameValue","setNameValue","email","setEmail","emailChange","setEmailChange","phone","setPhone","phoneChange","setPhoneChange","additional_contact","setAdditional_Contact","additional_contact_change","setAdditional_Contact_Change","distribution_group","setDistribution_Group","distribution_group_change","setDistribution_Group_Change","activity_profile","setActivity_Profile","activity_profile_change","setActivity_Profile_Change","CityPlace","setCityPlace","CityPlace_Change","setCityPlace_Change","surnameValue","setSurnameValue","options","setOptions","localUse","JSON","parse","localStorage","getItem","modalDep","phoneNumber","additionalContact","distributionGroup","activityProfile","modalCity","modalCityPlace","citiesId","setCitiesId","searchTermCities","setSearchTermCities","filteredCities","setFilteredCities","cities","setCities","handleUserClickCities","city_name","id","handleInputChangeCities","e","termCities","target","value","filtered","filter","city","toLowerCase","includes","getNameAndSurname","user_name","name","surname","split","getDeps","res","get","data","extractedOptions","extractOptions","department_id","node","optionsList","Name","Subclasses","length","forEach","subclass","concat","getNameDeps","deps","post","fetchUser","phone_number","place_of_residence","handleEmailChange","formatPhoneNumber","cleaned","replace","startsWith","slice","match","Boolean","join","handlePhoneChange","formattedValue","additional_Contact","distribution_Group","activity_Profile","cityPlace","handleNameChange","handleSurnameChange","handleClick","part","preventDefault","newInfo","departmentId","current","toUpperCase","_id","isAdmin","isadmin","see_child","status","main_department","city_id","cityPlaceChange","newInfo2","put","window","location","reload","setItem","stringify","handleChange","map","option"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport Modal from \"../../Templates/Modal/Modal\";\r\nimport axios from \"axios\";\r\nimport { useParams } from \"react-router-dom\";\r\n\r\nfunction Editing({modalActive,setModalActive}) {\r\n    const username = useParams()\r\n\r\n    const [error, setError] = useState('')\r\n\r\n    const [selectedValue, setSelectedValue] = useState('');\r\n\r\n    const [cityName, setCityName] = useState([])\r\n\r\n    const [user, setUser] = useState([])\r\n\r\n    const [nameValue, setNameValue] = useState(\"\");\r\n\r\n\r\n    const [email, setEmail] = useState([])\r\n    const [emailChange, setEmailChange] = useState([])\r\n\r\n\r\n    const [phone, setPhone] = useState([])\r\n    const [phoneChange, setPhoneChange] = useState([])\r\n\r\n\r\n    const [additional_contact, setAdditional_Contact] = useState([])\r\n    const [additional_contact_change, setAdditional_Contact_Change] = useState([])\r\n\r\n\r\n    const [distribution_group, setDistribution_Group] = useState([])\r\n    const [distribution_group_change, setDistribution_Group_Change] = useState([])\r\n\r\n\r\n    const [activity_profile, setActivity_Profile] = useState([])\r\n    const [activity_profile_change, setActivity_Profile_Change] = useState([])\r\n\r\n    const [CityPlace, setCityPlace] = useState([])\r\n    const [CityPlace_Change, setCityPlace_Change] = useState([])\r\n\r\n\r\n    const [surnameValue, setSurnameValue] = useState([])\r\n\r\n\r\n    const [options, setOptions] = useState([]);\r\n\r\n\r\n    const localUse = JSON.parse(localStorage.getItem('user'))\r\n\r\n    const modalDep = useRef()\r\n    const phoneNumber = useRef()\r\n    const additionalContact = useRef()\r\n    const distributionGroup = useRef()\r\n    const activityProfile = useRef()\r\n    const modalCity = useRef()\r\n    const modalCityPlace = useRef()\r\n\r\n\r\n    const [citiesId, setCitiesId] = useState([])\r\n    const [searchTermCities, setSearchTermCities] = useState('');\r\n    const [filteredCities, setFilteredCities] = useState([]);\r\n    const [cities, setCities] = useState([])\r\n\r\n\r\n    const handleUserClickCities = (city_name, id) => {\r\n        setCitiesId(id)\r\n        setSearchTermCities(city_name)\r\n        setFilteredCities([])\r\n    }\r\n\r\n\r\n    const handleInputChangeCities = (e) => {\r\n        const termCities = e.target.value;\r\n        setSearchTermCities(termCities);\r\n\r\n        if (termCities === '') {\r\n            setCitiesId('');\r\n            setFilteredCities([]);\r\n            setCityName('');\r\n            return;\r\n        }\r\n\r\n        const filtered = cities.filter(city =>\r\n            city.city_name && city.city_name.toLowerCase().includes(termCities.toLowerCase())\r\n        );\r\n        setFilteredCities(filtered);\r\n    }\r\n\r\n\r\n\r\n    useEffect(() => {\r\n\r\n        const getNameAndSurname = () => {\r\n            if (user.user_name) {\r\n                const [name, surname] = user.user_name.split(\" \");\r\n                setSurnameValue(surname || \"\");\r\n                setNameValue(name);\r\n            }\r\n        }\r\n\r\n        const getDeps = async () => {\r\n\r\n            const res = await axios.get('/api/department_tree_to_json/');\r\n            const data = res.data[0]['department_tree_to_json'];\r\n            const extractedOptions = extractOptions(data);\r\n            setOptions(extractedOptions);\r\n            setSelectedValue(user.department_id);\r\n        }\r\n        const extractOptions = (node) => {\r\n            let optionsList = [{ id: node.id, name: node.Name }];\r\n            if (node.Subclasses && node.Subclasses.length > 0) {\r\n                node.Subclasses.forEach(subclass => {\r\n                    optionsList = optionsList.concat(extractOptions(subclass));\r\n                });\r\n            }\r\n            return optionsList;\r\n\r\n        };\r\n\r\n        const getNameDeps = async () => {\r\n            const deps = {\r\n                user: username.username\r\n            }\r\n            const res = await axios.post('/api/departments/', deps)\r\n            setCityName(res.data[0]['city_name'])\r\n        }\r\n\r\n        const fetchUser = async () => {\r\n            const res = await axios.get('/api/user/' + username.username)\r\n            setUser(res.data)\r\n\r\n\r\n            const city = await axios.get('/api/Cities/')\r\n            setCities(city.data)\r\n        }\r\n        // Номинации\r\n\r\n        if (user && user.email && email) {\r\n            setEmail(user.email);\r\n        }\r\n        if (user && user.phone_number && phone) {\r\n            setPhone(user.phone_number);\r\n        }\r\n\r\n        if (user && user.additional_contact && additional_contact) {\r\n            setAdditional_Contact(user.additional_contact);\r\n        }\r\n\r\n        if (user && user.distribution_group && distribution_group) {\r\n            setDistribution_Group(user.distribution_group);\r\n        }\r\n        if (user && user.activity_profile && activity_profile) {\r\n            setActivity_Profile(user.activity_profile);\r\n        }\r\n        if (user && user.place_of_residence && CityPlace) {\r\n            setCityPlace(user.place_of_residence);\r\n        }\r\n\r\n        getNameAndSurname();\r\n        fetchUser()\r\n        getDeps()\r\n        getNameDeps()\r\n    }, [\r\n        user.user_name,\r\n        user.email,\r\n        user.phone_number,\r\n        user.additional_contact,\r\n        user.distribution_group,\r\n        user.activity_profile,\r\n        user.place_of_residence,\r\n        username.username\r\n    ])\r\n\r\n    const handleEmailChange = (e) => {\r\n\r\n        if (e.target.value) {\r\n            setEmail('')\r\n            setEmailChange(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setEmail('')\r\n            setEmailChange('')\r\n        }\r\n\r\n    }\r\n    const formatPhoneNumber = (value) => {\r\n        // Убираем все символы, кроме цифр\r\n        let cleaned = value.replace(/\\D/g, '');\r\n        if (cleaned.startsWith('7')) {\r\n            cleaned = cleaned.slice(1); // Удаляем ведущую 7, если она уже присутствует после +\r\n        }\r\n        // Ограничиваем длину очищенного значения до 10 цифр (XXX-XXX-XX-XX без кода страны)\r\n        cleaned = cleaned.slice(0, 10);\r\n        // Разделяем на части, добавляя дефисы\r\n        const match = cleaned.match(/^(\\d{0,3})(\\d{0,3})(\\d{0,2})(\\d{0,2})$/);\r\n        if (match) {\r\n            return '+7 ' + [match[1], match[2], match[3], match[4]].filter(Boolean).join('-');\r\n        }\r\n        return '+7 ' + cleaned;\r\n    };\r\n    const handlePhoneChange = (e) => {\r\n        if (e.target.value) {\r\n            setPhone('')\r\n            setPhoneChange(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setPhone('')\r\n            setPhoneChange('')\r\n        }\r\n        const value = e.target.value;\r\n        if (value.length < 1) {\r\n            setPhoneChange('')\r\n        } else {\r\n            const formattedValue = formatPhoneNumber(value);\r\n            setPhoneChange(formattedValue);\r\n        }\r\n    }\r\n\r\n    const additional_Contact = (e) => {\r\n        if (e.target.value) {\r\n            setAdditional_Contact('')\r\n            setAdditional_Contact_Change(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setAdditional_Contact('')\r\n            setAdditional_Contact_Change('')\r\n        }\r\n    }\r\n\r\n    const distribution_Group = (e) => {\r\n        if (e.target.value) {\r\n            setDistribution_Group('')\r\n            setDistribution_Group_Change(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setDistribution_Group('')\r\n            setDistribution_Group_Change('')\r\n        }\r\n    }\r\n\r\n    const activity_Profile = (e) => {\r\n        if (e.target.value) {\r\n            setActivity_Profile('')\r\n            setActivity_Profile_Change(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setActivity_Profile('')\r\n            setActivity_Profile_Change('')\r\n        }\r\n    }\r\n\r\n    const cityPlace = (e) => {\r\n        if (e.target.value) {\r\n            setCityPlace('')\r\n            setCityPlace_Change(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setCityPlace('')\r\n            setCityPlace_Change('')\r\n        }\r\n    }\r\n\r\n    const handleNameChange = (e) => {\r\n        setNameValue(e.target.value);\r\n    }\r\n\r\n    const handleSurnameChange = (e) => {\r\n        setSurnameValue(e.target.value)\r\n    }\r\n\r\n\r\n    // изменение данных пользователя\r\n    const handleClick = async (e) => {\r\n\r\n        const name = user.user_name\r\n        const part = name.split(' ')\r\n        e.preventDefault()\r\n        const newInfo = {\r\n            departmentId: modalDep.current.value || user.department_id,\r\n            email: (email ? email : emailChange.toUpperCase()),\r\n            username: nameValue + ' ' + surnameValue,\r\n            _id: user.id,\r\n            isAdmin: user.isadmin,\r\n            see_child: user.see_child,\r\n            status: user.status,\r\n            main_department: user.main_department,\r\n            phone_number: (phoneNumber.current.value === '' ? '' : phoneNumber.current.value),\r\n            additional_contact: additionalContact.current.value,\r\n            distribution_group: distributionGroup.current.value,\r\n            activity_profile: activityProfile.current.value,\r\n            city_id: citiesId,\r\n            cityPlaceChange:modalCityPlace.current.value\r\n        }\r\n\r\n        if (localUse._id !== username.username) {\r\n            const newInfo2 = {\r\n                departmentId: modalDep.current.value || user.department_id,\r\n                email: (email ? email : emailChange.toUpperCase()),\r\n                username: nameValue + ' ' + surnameValue,\r\n                phone_number: (phoneNumber.current.value === '' ? '' : phoneNumber.current.value),\r\n                additional_contact: additionalContact.current.value,\r\n                distribution_group: distributionGroup.current.value,\r\n                activity_profile: activityProfile.current.value,\r\n                city_id: citiesId,\r\n                _id: user.id,\r\n                cityPlaceChange:modalCityPlace.current.value\r\n            }\r\n\r\n            await axios.put('/api/user/', newInfo2)\r\n            window.location.reload()\r\n        } else {\r\n            await axios.put('/api/user/', newInfo)\r\n            delete newInfo.phone_number\r\n            delete newInfo.additional_contact\r\n            delete newInfo.distribution_group\r\n            delete newInfo.activity_profile\r\n            delete newInfo.city_id\r\n            delete newInfo.cityPlaceChange\r\n            localStorage.setItem('user', JSON.stringify({...newInfo}))\r\n            setModalActive(false)\r\n            window.location.reload()\r\n        }\r\n    }\r\n\r\n    const handleChange = (e) => {\r\n        setSelectedValue(e.target.value);\r\n    };\r\n\r\n\r\n    return (\r\n\r\n\r\n                <Modal active={modalActive} setActive={setModalActive}>\r\n                    <h1>Изменение информации:</h1>\r\n                    <hr/>\r\n                    {error && <div className='modalError'>{error}</div>}\r\n                    <form className=\"modalLoginBox\" onSubmit={handleClick}>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Фамилия\"\r\n                                className=\"ModalInputUpdate\"\r\n                                onChange={handleNameChange}\r\n                                value={nameValue}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Имя\"\r\n                                className=\"ModalInputUpdate\"\r\n                                onChange={handleSurnameChange}\r\n                                value={surnameValue}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Email\"\r\n                                type=\"email\"\r\n                                className=\"ModalInputUpdate\"\r\n                                onChange={handleEmailChange}\r\n                                value={email || emailChange}\r\n                                minLength={6}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Телефон\"\r\n                                type='text'\r\n                                className=\"ModalInputUpdate\"\r\n                                ref={phoneNumber}\r\n                                onChange={handlePhoneChange}\r\n                                value={phone || phoneChange}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Доп контакт(Номер телефона,ФИО,статус человека)\"\r\n                                type='text'\r\n                                className=\"ModalInputUpdate\"\r\n                                ref={additionalContact}\r\n                                onChange={additional_Contact}\r\n                                value={additional_contact || additional_contact_change}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Группа рассылки\"\r\n                                type='text'\r\n                                className=\"ModalInputUpdate\"\r\n                                ref={distributionGroup}\r\n                                onChange={distribution_Group}\r\n                                value={distribution_group || distribution_group_change}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Профиль деятельности\"\r\n                                type='text'\r\n                                className=\"ModalInputUpdate\"\r\n                                ref={activityProfile}\r\n                                onChange={activity_Profile}\r\n                                value={activity_profile || activity_profile_change}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Город\"\r\n                                type='text'\r\n                                className=\"ModalInputUpdate\"\r\n                                ref={modalCity}\r\n                                value={searchTermCities || cityName}\r\n                                onChange={handleInputChangeCities}\r\n                            />\r\n                            <div>\r\n                                {filteredCities.length > 0 && (\r\n                                    <div className='divSelectRegister'>\r\n                                        {filteredCities.map((city, id) => (\r\n                                            <div className='selectNameDiv' key={id} value={city.id}\r\n                                                 onClick={() => handleUserClickCities(city.city_name, city.id)}>\r\n                                                {city.city_name}\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                                <input\r\n                                    placeholder=\"Адрес фактического проживания\"\r\n                                    type='text'\r\n                                    className=\"ModalInputUpdate\"\r\n                                    ref={modalCityPlace}\r\n                                    onChange={cityPlace}\r\n                                    value={CityPlace || CityPlace_Change}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <select\r\n                                value={selectedValue} // Привязываем значение к selectedValue\r\n                                onChange={handleChange}\r\n                                ref={modalDep}\r\n                                className=\"ModalInputUpdateSelect\"\r\n                            >\r\n                                {options.map((option) => (\r\n                                    <option key={option.id} value={option.id}>\r\n                                        {option.name}\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                        <button className=\"ModalButton\" type=\"submit\">\r\n                            Изменить\r\n                        </button>\r\n                    </form>\r\n                </Modal>\r\n\r\n        )\r\n}\r\n\r\nexport default Editing;"]},"metadata":{},"sourceType":"module"}