{"ast":null,"code":"var _jsxFileName = \"D:\\\\Download\\\\time_app\\\\client\\\\src\\\\components\\\\HistoryInfo\\\\HistoryInfo.jsx\",\n    _s2 = $RefreshSig$();\n\nimport axios from 'axios';\nimport { useRef } from 'react';\nimport { useEffect, useState } from 'react';\nimport { format } from 'date-fns';\nimport { Add } from '@material-ui/icons';\nimport InfoPost from '../InfoPost/InfoPost';\nimport Pagination from '../Pagination/Pagination';\nimport VacationPost from '../VacationPost/VacationPost';\nimport './HistoryInfo.css';\nimport Modal from '../Templates/Modal/Modal';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function HistoryInfo({\n  username\n}) {\n  _s2();\n\n  var _s = $RefreshSig$();\n\n  const [posts, setPosts] = useState([]);\n  const [isFetching, setIsFetching] = useState(false);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [postsPerPage] = useState(30);\n  const lastPostIndex = currentPage * postsPerPage;\n  const firstPostIndex = lastPostIndex - postsPerPage;\n  const currentlyPosts = posts.slice(firstPostIndex, lastPostIndex);\n  const historyStartWork = useRef(null);\n  const historyEndWork = useRef(null);\n  const [isFilter, setIsFilter] = useState(false);\n  const [newPosts, setNewPosts] = useState([]);\n  const [error, setError] = useState('');\n  const [modalError, setModalError] = useState('');\n  const localUser = JSON.parse(localStorage.getItem('user'));\n  const [vacationPosts, setVacationPosts] = useState([]);\n  const [isJob, setIsJob] = useState(true);\n  const [modalActive, setModalActive] = useState(false);\n  const [modalName, setModalName] = useState(null);\n  const modalComment = useRef();\n  const vacationStart = useRef();\n  const vacationEnd = useRef(); // получение всех постов работы от послелнего к первому\n\n  useEffect(() => {\n    setIsFetching(true);\n\n    const fetchUser = async () => {\n      const res = await axios.get('/api/post?id=' + localUser._id);\n      /*console.log(post)*/\n\n      console.log(res);\n      setPosts(res.data.sort((p1, p2) => {\n        return new Date(p2.workstart) - new Date(p1.workstart);\n      }));\n      setIsFetching(false);\n    };\n\n    fetchUser();\n    handleClickCancel();\n  }, [username]);\n\n  const paginate = pageNumber => setCurrentPage(pageNumber); // фильтер постов по дате\n\n\n  const handleClick = async () => {\n    _s();\n\n    const start = historyStartWork.current.value;\n    const end = historyEndWork.current.value;\n    console.log(start, end);\n\n    if (start === \"\" && end === \"\") {\n      setError('Введите дату');\n    } else {\n      if (start !== '' && end !== '') {} else {\n        const filter = {\n          start: historyStartWork.current.value,\n          end: historyEndWork.current.value,\n          userId: localUser._id,\n          setDate: format(new Date(), 'yyyy-mm-dd')\n        };\n        const res = await axios.post('/api/post/filter', filter);\n        setError('');\n        console.log(res);\n\n        if (start > end && end !== '') {\n          setError('Конечная дата меньше начальной');\n        }\n\n        setIsFilter(true);\n      }\n      /*    let filterPosts = isJob\r\n            ?  posts.filter(post => post.workdate.split('T')[0] >= start)\r\n            : vacationPosts.filter(post => post.start.split('T')[0] >= start)\r\n          if(end){\r\n            filterPosts = isJob \r\n              ? filterPosts.filter(post => post.workdate.split('T')[0] <= end)\r\n              : filterPosts.filter(post => post.end.split('T')[0] <= end)\r\n          }\r\n          setNewPosts(filterPosts)*/\n\n    } // сброс фильтра\n\n\n    const handleClickCancel = () => {\n      setError('');\n      setIsFilter(false);\n      historyStartWork.current.value = '';\n      historyEndWork.current.value = '';\n    }; // получение всех постов об отпуске/больничном от послелнего к первому\n\n\n    useEffect(() => {\n      setIsFetching(true);\n\n      const fetchUser = async () => {\n        const res = await axios.get('/api/vacation/profile/' + username);\n        setVacationPosts(res.data.sort((p1, p2) => {\n          return new Date(p2.start) - new Date(p1.start);\n        }));\n        setIsFetching(false);\n      };\n\n      fetchUser();\n    }, [username]); // добавление больничного\n\n    const handleClickAdd = async e => {\n      e.preventDefault();\n      const currentDay = new Date();\n\n      if (vacationStart.current.value === '' || vacationEnd.current.value === '' || modalName === null || modalComment.current.value === '') {\n        setModalError('Вcе поля должны быть заполнены');\n        return;\n      }\n\n      if (new Date(vacationStart.current.value) > new Date(vacationEnd.current.value) && vacationEnd.current.value !== '') {\n        setModalError('Вторая дата меньше первой');\n        return;\n      }\n\n      const vacation = {\n        userId: username,\n        name: modalName,\n        comment: modalComment.current.value,\n        start: new Date(vacationStart.current.value),\n        end: new Date(vacationEnd.current.value)\n      };\n      const newPost = {\n        userId: username,\n        healthEnd: 1,\n        workEnd: new Date(Date.now()),\n        workTime: new Date(Date.now()) - new Date(posts[0].workStart)\n      };\n      const isTrue = new Date(vacationStart.current.value) <= currentDay && currentDay.getDate() <= vacation.end.getDate() + 1;\n\n      try {\n        await axios.post('/api/vacation/', vacation);\n\n        if (isTrue) {\n          await axios.put(\"/api/post/\" + posts[0]._id, newPost);\n          await axios.put('/api/user/' + username, {\n            status: 3,\n            userId: username\n          });\n\n          if (localUser._id === username) {\n            localStorage.setItem('user', JSON.stringify({ ...localUser,\n              status: 3\n            }));\n          }\n        }\n\n        window.location.reload();\n      } catch (error) {\n        console.log(error);\n      }\n    }; // переход на страницу с больничным и обратно\n\n\n    const handleWorkVacation = () => {\n      setIsJob(!isJob);\n      setError('');\n      setIsFilter(false);\n      historyStartWork.current.value = '';\n      historyEndWork.current.value = '';\n    };\n\n    const handleName = e => {\n      setModalName(e.target.value);\n    };\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"historyInfo\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"historyInfoTop\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"historyInfoTitle\",\n          children: \"\\u0418\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"workVacation\",\n          onClick: handleWorkVacation,\n          children: isJob ? /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"filterButton\",\n            style: {\n              width: '155px'\n            },\n            children: \"\\u041E\\u0442\\u043F\\u0443\\u0441\\u043A/\\u0411\\u043E\\u043B\\u044C\\u043D\\u0438\\u0447\\u043D\\u044B\\u0439\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 13\n          }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"filterButton\",\n            children: \"\\u0420\\u0430\\u0431\\u043E\\u0442\\u0430\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 9\n        }, this), !isJob && (localUser.isAdmin || username === localUser._id) && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"addVacation\",\n          onClick: () => setModalActive(true),\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"+\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 139\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 73\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 7\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"errorHistoryInfo\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"historyFilter\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"date\",\n          placeholder: \"\\u041D\\u0430\\u0447\\u0430\\u043B\\u043E \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B\",\n          className: \"ModalInput\",\n          ref: historyStartWork,\n          style: {\n            'marginRight': '10px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"date\",\n          placeholder: \"\\u041A\\u043E\\u043D\\u0435\\u0446 \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B\",\n          className: \"ModalInput\",\n          ref: historyEndWork,\n          style: {\n            'marginRight': '10px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"filterButton\",\n          onClick: handleClick,\n          children: \"\\u043E\\u043A\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"filterButton\",\n          onClick: handleClickCancel,\n          children: \"\\u0441\\u0431\\u0440\\u043E\\u0441\\u0438\\u0442\\u044C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 7\n      }, this), isJob ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"historyInfoTable\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"historyInfoTableBlock Data\",\n          children: \"\\u0414\\u0430\\u0442\\u0430\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"historyInfoTableBlock Start\",\n          children: \"\\u0412\\u0440\\u0435\\u043C\\u044F \\u043D\\u0430\\u0447\\u0430\\u043B\\u0430\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"historyInfoTableBlock End\",\n          children: \"\\u0412\\u0440\\u0435\\u043C\\u044F \\u043E\\u043A\\u043E\\u043D\\u0447\\u0430\\u043D\\u0438\\u044F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"historyInfoTableBlock Time\",\n          children: \"\\u0414\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u044C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"historyInfoTableBlock Health\",\n          children: \"\\u0421\\u043E\\u0441\\u0442\\u043E\\u044F\\u043D\\u0438\\u0435 \\u0437\\u0434\\u043E\\u0440\\u043E\\u0432\\u044C\\u044F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"historyInfoTableBlock Health\",\n          children: \"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0439\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 12\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"historyInfoTable\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"historyInfoTableBlock Data\",\n          children: \"\\u041F\\u0440\\u0438\\u0447\\u0438\\u043D\\u0430\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"historyInfoTableBlock Start\",\n          children: \"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0439\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"historyInfoTableBlock Start\",\n          children: \"\\u041D\\u0430\\u0447\\u0430\\u043B\\u043E\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"historyInfoTableBlock End\",\n          children: \"\\u041A\\u043E\\u043D\\u0435\\u0446\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"historyInfoTableBlock Time\",\n          children: \"\\u0414\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u044C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 12\n      }, this), isJob ? isFetching ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"isFatching\",\n        children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 13\n      }, this) : isFilter ? newPosts.map((post, id) => /*#__PURE__*/_jsxDEV(InfoPost, {\n        post: post,\n        username: username\n      }, id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 42\n      }, this)) : currentlyPosts.map((post, id) => /*#__PURE__*/_jsxDEV(InfoPost, {\n        post: post,\n        username: username\n      }, id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 48\n      }, this)) : isFetching ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"isFatching\",\n        children: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 13\n      }, this) : isFilter ? newPosts.map((post, id) => /*#__PURE__*/_jsxDEV(VacationPost, {\n        post: post,\n        username: username\n      }, id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 42\n      }, this)) : vacationPosts.map((post, id) => /*#__PURE__*/_jsxDEV(VacationPost, {\n        post: post\n      }, id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 47\n      }, this)), /*#__PURE__*/_jsxDEV(Pagination, {\n        postsPerPage: postsPerPage,\n        totalPosts: posts.length,\n        paginate: paginate,\n        currentPage: currentPage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(Modal, {\n        active: modalActive,\n        setActive: setModalActive,\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 9\n        }, this), modalError && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"errorHistoryInfo\",\n          children: modalError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 24\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          className: \"modalLoginBox\",\n          onSubmit: handleClickAdd,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: 'flex',\n              justifyContent: 'space-between',\n              fontSize: '20px',\n              width: '60%',\n              marginLeft: '20%'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"sickLeave\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"radio\",\n                value: 'Больничный',\n                id: \"sickLeave\",\n                name: \"sickLeave\",\n                onChange: handleName,\n                checked: modalName === 'Больничный'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 277,\n                columnNumber: 13\n              }, this), \"\\u0411\\u043E\\u043B\\u044C\\u043D\\u0438\\u0447\\u043D\\u044B\\u0439\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 276,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"vacation\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"radio\",\n                value: 'Отпуск',\n                id: \"vacation\",\n                name: \"vacation\",\n                onChange: handleName,\n                checked: modalName === 'Отпуск'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 286,\n                columnNumber: 13\n              }, this), \"\\u041E\\u0442\\u043F\\u0443\\u0441\\u043A\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 285,\n              columnNumber: 13\n            }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n              htmlFor: \"anotherReason\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"radio\",\n                value: 'Другая причина',\n                id: \"anotherReason\",\n                name: \"anotherReason\",\n                onChange: handleName,\n                checked: modalName === 'Другая причина'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 295,\n                columnNumber: 13\n              }, this), \"\\u0414\\u0440\\u0443\\u0433\\u0430\\u044F \\u043F\\u0440\\u0438\\u0447\\u0438\\u043D\\u0430\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 294,\n              columnNumber: 13\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            placeholder: \"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0439\",\n            className: \"ModalInput\",\n            ref: modalComment\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"date\",\n            placeholder: \"\\u041D\\u0430\\u0447\\u0430\\u043B\\u043E \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B\",\n            className: \"ModalInput\",\n            ref: vacationStart,\n            style: {\n              'marginRight': '10px'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 309,\n            columnNumber: 11\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"date\",\n            placeholder: \"\\u041A\\u043E\\u043D\\u0435\\u0446 \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B\",\n            className: \"ModalInput\",\n            ref: vacationEnd,\n            style: {\n              'marginRight': '10px'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 316,\n            columnNumber: 9\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"ModalButton\",\n            type: \"submit\",\n            disabled: isFetching,\n            children: \"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 323,\n            columnNumber: 11\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 5\n    }, this);\n  };\n\n  _s(handleClick, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n}\n\n_s2(HistoryInfo, \"fGjX9KO9b9WhfkGaBEw5AMLfvos=\");\n\n_c = HistoryInfo;\n\nvar _c;\n\n$RefreshReg$(_c, \"HistoryInfo\");","map":{"version":3,"sources":["D:/Download/time_app/client/src/components/HistoryInfo/HistoryInfo.jsx"],"names":["axios","useRef","useEffect","useState","format","Add","InfoPost","Pagination","VacationPost","Modal","HistoryInfo","username","posts","setPosts","isFetching","setIsFetching","currentPage","setCurrentPage","postsPerPage","lastPostIndex","firstPostIndex","currentlyPosts","slice","historyStartWork","historyEndWork","isFilter","setIsFilter","newPosts","setNewPosts","error","setError","modalError","setModalError","localUser","JSON","parse","localStorage","getItem","vacationPosts","setVacationPosts","isJob","setIsJob","modalActive","setModalActive","modalName","setModalName","modalComment","vacationStart","vacationEnd","fetchUser","res","get","_id","console","log","data","sort","p1","p2","Date","workstart","handleClickCancel","paginate","pageNumber","handleClick","start","current","value","end","filter","userId","setDate","post","handleClickAdd","e","preventDefault","currentDay","vacation","name","comment","newPost","healthEnd","workEnd","now","workTime","workStart","isTrue","getDate","put","status","setItem","stringify","window","location","reload","handleWorkVacation","handleName","target","width","isAdmin","map","id","length","display","justifyContent","fontSize","marginLeft"],"mappings":"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","sourcesContent":["import axios from 'axios'\r\nimport { useRef } from 'react'\r\nimport { useEffect, useState } from 'react'\r\nimport { format } from 'date-fns'\r\nimport { Add } from '@material-ui/icons'\r\n\r\nimport InfoPost from '../InfoPost/InfoPost'\r\nimport Pagination from '../Pagination/Pagination'\r\nimport VacationPost from '../VacationPost/VacationPost'\r\nimport './HistoryInfo.css'\r\nimport Modal from '../Templates/Modal/Modal'\r\n\r\nexport default function HistoryInfo({username}) {\r\n  const [posts, setPosts] = useState([])\r\n  const [isFetching, setIsFetching] = useState(false)\r\n  const [currentPage, setCurrentPage] = useState(1)\r\n  const [postsPerPage] = useState(30)\r\n\r\n  const lastPostIndex = currentPage * postsPerPage\r\n  const firstPostIndex = lastPostIndex - postsPerPage\r\n  const currentlyPosts = posts.slice(firstPostIndex, lastPostIndex)\r\n\r\n  const historyStartWork = useRef(null)\r\n  const historyEndWork = useRef(null)\r\n  const [isFilter, setIsFilter] = useState(false)\r\n  const [newPosts, setNewPosts] = useState([])\r\n  const [error, setError] = useState('')\r\n  const [modalError, setModalError] = useState('')\r\n\r\n  const localUser = JSON.parse(localStorage.getItem('user'))\r\n\r\n  const [vacationPosts, setVacationPosts] = useState([])\r\n  const [isJob, setIsJob] = useState(true)\r\n\r\n  const [modalActive, setModalActive] = useState(false)\r\n  const [modalName, setModalName] = useState(null)\r\n  const modalComment = useRef()\r\n  const vacationStart = useRef()\r\n  const vacationEnd = useRef()\r\n\r\n  // получение всех постов работы от послелнего к первому\r\n\r\n  useEffect(() => {\r\n\r\n    setIsFetching(true)\r\n      const fetchUser = async () => {\r\n      const res = await axios.get('/api/post?id='+localUser._id)\r\n        /*console.log(post)*/\r\n        console.log(res)\r\n      setPosts(res.data.sort((p1, p2) => {\r\n       return new Date(p2.workstart) - new Date(p1.workstart)\r\n      }))\r\n      setIsFetching(false)\r\n    }\r\n    fetchUser()\r\n    handleClickCancel()\r\n  }, [username])\r\n\r\n  const paginate = pageNumber => setCurrentPage(pageNumber)\r\n\r\n  // фильтер постов по дате\r\n  const handleClick = async () => {\r\n    const start = historyStartWork.current.value\r\n    const end = historyEndWork.current.value\r\n    console.log(start,end)\r\n    if (start ===\"\" && end ===\"\" ) {\r\n      setError('Введите дату')\r\n    }else{\r\n      if(start !=='' && end !==''){\r\n\r\n    } else{\r\n      const filter = {\r\n        start: historyStartWork.current.value,\r\n        end:historyEndWork.current.value,\r\n        userId:localUser._id,\r\n        setDate: format(new Date(), 'yyyy-mm-dd')\r\n      }\r\n      const res = await axios.post('/api/post/filter',filter)\r\n      setError('')\r\n      console.log(res)\r\n      if(start > end && end !== ''){\r\n        setError('Конечная дата меньше начальной')\r\n      }\r\n      setIsFilter(true)\r\n\r\n    }\r\n\r\n\r\n\r\n/*    let filterPosts = isJob\r\n      ?  posts.filter(post => post.workdate.split('T')[0] >= start)\r\n      : vacationPosts.filter(post => post.start.split('T')[0] >= start)\r\n    if(end){\r\n      filterPosts = isJob \r\n        ? filterPosts.filter(post => post.workdate.split('T')[0] <= end)\r\n        : filterPosts.filter(post => post.end.split('T')[0] <= end)\r\n    }\r\n    setNewPosts(filterPosts)*/\r\n\r\n  }\r\n\r\n\r\n  // сброс фильтра\r\n  const handleClickCancel = () => {\r\n    setError('')\r\n    setIsFilter(false)\r\n    historyStartWork.current.value = ''\r\n    historyEndWork.current.value = ''\r\n  }\r\n\r\n  // получение всех постов об отпуске/больничном от послелнего к первому\r\n  useEffect(() => {\r\n    setIsFetching(true)\r\n    const fetchUser = async () => {\r\n      const res = await axios.get('/api/vacation/profile/'+username)\r\n      setVacationPosts(res.data.sort((p1, p2) => {\r\n        return new Date(p2.start) - new Date(p1.start)\r\n      }))      \r\n      setIsFetching(false)\r\n    }\r\n    fetchUser()\r\n  }, [username])\r\n\r\n  // добавление больничного\r\n  const handleClickAdd = async (e) => {\r\n    e.preventDefault()\r\n\r\n    const currentDay = new Date()\r\n\r\n    if( vacationStart.current.value === '' || vacationEnd.current.value === '' || modalName === null || modalComment.current.value === ''){\r\n      setModalError('Вcе поля должны быть заполнены')\r\n      return\r\n    }\r\n\r\n    if(new Date(vacationStart.current.value) > new Date(vacationEnd.current.value) && vacationEnd.current.value !== ''){\r\n      setModalError('Вторая дата меньше первой')\r\n      return\r\n    }\r\n\r\n    const vacation = {\r\n      userId: username,\r\n      name: modalName,\r\n      comment: modalComment.current.value,\r\n      start: new Date(vacationStart.current.value),\r\n      end: new Date(vacationEnd.current.value)\r\n    }\r\n\r\n    const newPost = {\r\n      userId: username,\r\n      healthEnd: 1,\r\n      workEnd: new Date(Date.now()),\r\n      workTime: new Date(Date.now()) - new Date(posts[0].workStart)\r\n    }\r\n\r\n    const isTrue = new Date(vacationStart.current.value) <= currentDay && currentDay.getDate() <= vacation.end.getDate()+1\r\n\r\n    try {\r\n      await axios.post('/api/vacation/', vacation)\r\n      if (isTrue) {\r\n        await axios.put(\"/api/post/\"+posts[0]._id, newPost)\r\n        await axios.put('/api/user/'+username, {status:3, userId: username})\r\n        if (localUser._id === username) {\r\n          localStorage.setItem('user', JSON.stringify({...localUser, status:3}))\r\n        }\r\n      }\r\n      window.location.reload()\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }\r\n\r\n  // переход на страницу с больничным и обратно\r\n  const handleWorkVacation = () => {\r\n    setIsJob(!isJob)\r\n    setError('')\r\n    setIsFilter(false)\r\n    historyStartWork.current.value = ''\r\n    historyEndWork.current.value = ''\r\n  }\r\n\r\n  const handleName = e => {\r\n    setModalName(e.target.value)\r\n  }\r\n\r\n  return (\r\n    <div className='historyInfo'>\r\n      <div className='historyInfoTop'>\r\n        <span className='historyInfoTitle'>История</span>\r\n        <span className='workVacation' onClick={handleWorkVacation}>{isJob \r\n          ? <button className=\"filterButton\" style={{width:'155px'}}>Отпуск/Больничный</button>\r\n          : <button className=\"filterButton\">Работа</button> }</span>\r\n        {!isJob && (localUser.isAdmin || username === localUser._id) && <div className='addVacation' onClick={() => setModalActive(true)}><span>+</span></div>}\r\n      </div>\r\n      <hr/>\r\n      {error && <div className='errorHistoryInfo'>{error}</div>}\r\n      <div className='historyFilter'>\r\n        <input \r\n          type='date'\r\n          placeholder=\"Начало работы\"\r\n          className=\"ModalInput\"  \r\n          ref={historyStartWork} \r\n          style={{'marginRight': '10px'}}\r\n        />\r\n        <input \r\n          type='date'\r\n          placeholder=\"Конец работы\"\r\n          className=\"ModalInput\"  \r\n          ref={historyEndWork} \r\n          style={{'marginRight': '10px'}}\r\n        />\r\n        <button className=\"filterButton\" onClick={handleClick}>ок</button>\r\n        <button className=\"filterButton\" onClick={handleClickCancel}>сбросить</button>\r\n      </div>\r\n      <hr/>\r\n      {isJob \r\n        ?  <div className='historyInfoTable'>\r\n            <div className='historyInfoTableBlock Data'>\r\n              Дата\r\n            </div>\r\n            <div className='historyInfoTableBlock Start'>\r\n              Время начала\r\n            </div>\r\n            <div className='historyInfoTableBlock End'>\r\n              Время окончания\r\n            </div>\r\n            <div className='historyInfoTableBlock Time'>\r\n              Длительность\r\n            </div>\r\n            <div className='historyInfoTableBlock Health'>\r\n              Состояние здоровья\r\n            </div>\r\n            <div className='historyInfoTableBlock Health'>\r\n              Комментарий\r\n            </div>\r\n          </div>\r\n        :  <div className='historyInfoTable'>\r\n            <div className='historyInfoTableBlock Data'>\r\n              Причина\r\n            </div >\r\n            <div className='historyInfoTableBlock Start'>\r\n              Комментарий\r\n            </div>\r\n            <div className='historyInfoTableBlock Start'>\r\n              Начало\r\n            </div>\r\n            <div className='historyInfoTableBlock End'>\r\n              Конец\r\n            </div>\r\n            <div className='historyInfoTableBlock Time'>\r\n              Длительность\r\n            </div>\r\n          </div>\r\n      }\r\n\r\n      {isJob\r\n        ? isFetching\r\n          ? <div className='isFatching'>Загрузка...</div>\r\n          : isFilter \r\n            ? newPosts.map((post, id) => <InfoPost key={id} post={post} username={username}/>)\r\n            : currentlyPosts.map((post, id) => <InfoPost key={id} post={post} username={username}/>)\r\n        : isFetching \r\n          ? <div className='isFatching'>Загрузка...</div>\r\n          : isFilter \r\n            ? newPosts.map((post, id) => <VacationPost key={id} post={post} username={username}/>)\r\n            : vacationPosts.map((post, id) => <VacationPost key={id} post={post}/>)\r\n      }\r\n\r\n      <Pagination postsPerPage={postsPerPage} totalPosts={posts.length} paginate={paginate} currentPage={currentPage}/>\r\n\r\n      <Modal active={modalActive} setActive={setModalActive}>\r\n        <h1>Изменение информации:</h1>\r\n        <hr/>\r\n        {modalError && <div className='errorHistoryInfo'>{modalError}</div>}\r\n        <form className=\"modalLoginBox\" onSubmit={handleClickAdd}>\r\n          <div style={{display:'flex', justifyContent:'space-between', fontSize: '20px', width:'60%', marginLeft:'20%'}}>\r\n            <label htmlFor='sickLeave'>\r\n            <input\r\n              type='radio'\r\n              value={'Больничный'}\r\n              id='sickLeave'\r\n              name='sickLeave'\r\n              onChange={handleName}\r\n              checked={modalName === 'Больничный'}\r\n            />Больничный</label>\r\n            <label htmlFor='vacation'>\r\n            <input\r\n              type='radio'\r\n              value={'Отпуск'}\r\n              id='vacation'\r\n              name='vacation'\r\n              onChange={handleName}\r\n              checked={modalName === 'Отпуск'}\r\n            />Отпуск</label>\r\n            <label htmlFor='anotherReason'>\r\n            <input\r\n              type='radio'\r\n              value={'Другая причина'}\r\n              id='anotherReason'\r\n              name='anotherReason'\r\n              onChange={handleName}\r\n              checked={modalName === 'Другая причина'}\r\n            />Другая причина</label>\r\n          </div>\r\n          <input \r\n            placeholder=\"Комментарий\"\r\n            className=\"ModalInput\"  \r\n            ref={modalComment} \r\n          />\r\n          <input \r\n          type='date'\r\n          placeholder=\"Начало работы\"\r\n          className=\"ModalInput\"  \r\n          ref={vacationStart} \r\n          style={{'marginRight': '10px'}}\r\n        />\r\n        <input \r\n          type='date'\r\n          placeholder=\"Конец работы\"\r\n          className=\"ModalInput\"  \r\n          ref={vacationEnd} \r\n          style={{'marginRight': '10px'}}\r\n        />\r\n          <button className=\"ModalButton\" type=\"submit\" disabled={isFetching}>\r\n            Изменить\r\n          </button>\r\n        </form>\r\n      </Modal>\r\n    </div>\r\n  )\r\n}}\r\n"]},"metadata":{},"sourceType":"module"}