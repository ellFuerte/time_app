{"ast":null,"code":"import _objectSpread from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/Download/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState}from'react';import axios from'axios';import Employee from'../Employee/Employee';import'./Staff.css';import{useParams}from'react-router-dom';import Modal from'../Templates/Modal/Modal';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Staff(props){var _localUser$checkedDep5;props.func(\"www\");console.log(props.user);console.log(props.dep);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),users=_useState2[0],setUsers=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),getUser=_useState6[0],setGetUser=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),deps=_useState8[0],setDeps=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isOpen=_useState10[0],setIsOpen=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isFetching=_useState12[0],setIsFetching=_useState12[1];var _useState13=useState(true),_useState14=_slicedToArray(_useState13,2),isJob=_useState14[0],setIsJob=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),modalActive=_useState16[0],setModalActive=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),modalMain=_useState18[0],setModalMain=_useState18[1];var changedArr=[];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),isModalFetching=_useState20[0],setIsModalFetching=_useState20[1];var departId=useParams().username;var localUser=JSON.parse(localStorage.getItem('user'));var depsId=useParams().username;for(var i=0;i<((_localUser$checkedDep=localUser.checkedDeps)===null||_localUser$checkedDep===void 0?void 0:_localUser$checkedDep.length);i++){var _localUser$checkedDep;changedArr.push(localUser.checkedDeps[i]);}// ставит галочки в модалке\nfunction addChecked(deps){for(var _i=0;_i<deps.length;_i++){for(var j=0;j<((_localUser$checkedDep2=localUser.checkedDeps)===null||_localUser$checkedDep2===void 0?void 0:_localUser$checkedDep2.length);j++){var _localUser$checkedDep2;if(deps[_i]._id===localUser.checkedDeps[j]){deps[_i].checked=true;}}}}// фильтр нужных департаментов\nvar currentDep=deps.filter(function(dep){return departId?dep._id===departId:dep._id===localUser.departmentId;});var filterDeps=deps.filter(function(dep){return currentDep.find(function(i){return i===dep.dep_id||i===currentDep[0].dep_id;});});filterDeps.push.apply(filterDeps,_toConsumableArray(currentDep));// фильтр нужных людей\nvar usersFilter=users.filter(function(user){return filterDeps.find(function(f){return f._id===user.departmentId;});});var usersFilterDeps=users.filter(function(user){var _localUser$checkedDep3;return(_localUser$checkedDep3=localUser.checkedDeps)===null||_localUser$checkedDep3===void 0?void 0:_localUser$checkedDep3.find(function(f){return f===user.departmentId;});});var depsFilterDeps=deps.filter(function(dep){var _localUser$checkedDep4;return(_localUser$checkedDep4=localUser.checkedDeps)===null||_localUser$checkedDep4===void 0?void 0:_localUser$checkedDep4.find(function(f){return f===dep._id;});});var isLockDeps=localUser.checkedDeps!==null&&((_localUser$checkedDep5=localUser.checkedDeps)===null||_localUser$checkedDep5===void 0?void 0:_localUser$checkedDep5.length)>0;var addChildrenArr=[];useEffect(function(){// получение всех пользователей\nvar fetchUsers=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,filterUsers;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsFetching(true);_context.next=3;return axios.get('/api/user');case 3:res=_context.sent;res.data.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});filterUsers=filterUsersFoo(res.data);setUsers(filterUsers);setIsFetching(false);case 8:case\"end\":return _context.stop();}}},_callee);}));return function fetchUsers(){return _ref.apply(this,arguments);};}();// получение данных о себе\nvar fetchUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get('/api/user/'+localUser._id);case 2:res=_context2.sent;setUser(res.data);setIsFetching(false);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function fetchUser(){return _ref2.apply(this,arguments);};}();// получение и фильтр департаментов\nvar getDeps=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res,_loop,_i2,newArr;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setIsModalFetching(true);_context3.next=3;return axios.get('/api/departments/');case 3:res=_context3.sent;addChecked(res.data);_loop=function _loop(_i2){var _loop2=function _loop2(j){if(res.data.find(function(k){return k===res.data[j].dep_id&&k!==res.data[_i2].dep_id;})){if(res.data[j].margin){res.data[j].margin+=10;}else{res.data[j].margin=10;}}};for(var j=_i2+1;j<res.data.length;j++){_loop2(j);}};for(_i2=0;_i2<res.data.length-1;_i2++){_loop(_i2);}newArr=res.data.filter(function(d){return d.dep_id!==7;});newArr.push(res.data[6]);setDeps(newArr);setIsModalFetching(false);case 11:case\"end\":return _context3.stop();}}},_callee3);}));return function getDeps(){return _ref3.apply(this,arguments);};}();var get_users_by_users=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var getUsers,res,users_users,filterUsers;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:setIsFetching(true);getUsers={id:localUser._id};_context4.next=4;return axios.post('/api/get_users_by_users',getUsers);case 4:res=_context4.sent;users_users=res.data[0]['get_users_by_users'];users_users.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});filterUsers=filterUsersFoo(users_users);setUsers(filterUsers);console.log(\"get_users_by_users=\",users_users);setIsFetching(false);/*setIsOpen(true)*/case 11:case\"end\":return _context4.stop();}}},_callee4);}));return function get_users_by_users(){return _ref4.apply(this,arguments);};}();getDeps();fetchUser();setIsOpen(false);/*    console.log(\"user=\",user)\r\n    console.log('depsId=',depsId)\r\n    console.log('departId=',departId)*/if(user.main_department===departId){setUsers([]);get_users_by_users();}else{setGetUser([]);fetchUsers();}},[departId]);// фильтр пользователей по статусу\nfunction filterUsersFoo(users){return users.filter(function(user){return user.status===1;}).concat(users.filter(function(user){return user.status===2;})).concat(users.filter(function(user){return user.status===3;})).concat(users.filter(function(user){return user.status!==1&&user.status!==2&&user.status!==3&&user.status!==4;})).concat(users.filter(function(user){return user.status===4;}));}// добавляем/удаляем департамент в модалке\nvar handlePush=function handlePush(e){if(e.target.checked){changedArr.push(e.target.value);}else{var index=changedArr.indexOf(e.target.value);changedArr.splice(index,1);delete e.target.checked;}};// добавление дочерних\nvar handleAddChildren=function handleAddChildren(e){global.chek=e.target.checked;};// обновляем данные модального окна\nvar handleModalClick=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(e){var chek,info,oldItems,newInfo,_oldItems,_newInfo,_info;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:chek=global.chek;e.preventDefault();if(!chek){_context5.next=14;break;}info={userId:localUser._id,deps:depsId,setchild:true};oldItems=JSON.parse(localStorage.getItem('user'));newInfo={_id:oldItems._id,isAdmin:localUser.isAdmin,username:localUser.username,email:localUser.email,departmentId:localUser.departmentId,main_department:departId,status:oldItems.status};localStorage.clear();localStorage.setItem('user',JSON.stringify(_objectSpread({},newInfo)));_context5.next=10;return axios.post('/api/child/',info);case 10:setIsOpen(true);setModalMain(false);_context5.next=23;break;case 14:_oldItems=JSON.parse(localStorage.getItem('user'));_newInfo={_id:_oldItems._id,isAdmin:localUser.isAdmin,username:localUser.username,email:localUser.email,departmentId:localUser.departmentId,main_department:departId,status:_oldItems.status};_info={userId:localUser._id,setchild:false,deps:depsId};setIsOpen(false);setModalMain(false);localStorage.clear();localStorage.setItem('user',JSON.stringify(_objectSpread({},_newInfo)));_context5.next=23;return axios.post('/api/child/',_info);case 23:case\"end\":return _context5.stop();}}},_callee5);}));return function handleModalClick(_x){return _ref5.apply(this,arguments);};}();/*  let newInfo\r\n\r\n    if (departId) {\r\n      addChildrenArr = addChildrenArr.map(i => i.id)\r\n      newInfo = {\r\n        userId: user.id,\r\n        checkedDeps: [departId, ...addChildrenArr]\r\n      }\r\n    } else {\r\n      newInfo = {\r\n        userId: user._id,\r\n        checkedDeps: changedArr\r\n      }\r\n    }\r\n\r\n    try {\r\n      await axios.put('/api/user/' + localUser._id, newInfo)\r\n      if (user._id === localUser._id) {\r\n        localStorage.setItem('user', JSON.stringify({...user, ...newInfo}))\r\n      }\r\n      window.location.reload()\r\n    } catch (error) {\r\n      console.log(error);\r\n\r\n    }\r\n  }*/ // функция get_users_by_dep\nvar get_users_by_dep=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var info,_res,dep_users,filterUsers;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!isJob){_context6.next=7;break;}info={depsId:depsId};_context6.next=4;return axios.post('/api/get_users_by_dep/',info);case 4:_res=_context6.sent;dep_users=_res.data[0]['get_users_by_dep'];if(dep_users===null){}else{console.log(\"get_users_by_dep=\",dep_users);dep_users.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});filterUsers=filterUsersFoo(dep_users);setUsers(filterUsers);setIsOpen(true);setIsJob(!isJob);}case 7:case\"end\":return _context6.stop();}}},_callee6);}));return function get_users_by_dep(){return _ref6.apply(this,arguments);};}();/*\r\n  if(isJob){\r\n    setIsOpen(true)}else {\r\n    setIsOpen(false)}\r\n  setIsJob(!isJob)\r\n}\r\n*/return/*#__PURE__*/_jsxs(\"div\",{className:\"staff\",children:[departId&&/*#__PURE__*/_jsxs(_Fragment,{children:[isJob?/*#__PURE__*/_jsx(\"button\",{onClick:get_users_by_dep,className:\"btnStaff\",style:{width:'155px'},children:\"\\u041F\\u043E\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C \\u0434\\u043E\\u0447\\u0435\\u0440\\u043D\\u0438\\u0438\"}):/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return window.location.href=\"/department/\".concat(departId);},className:\"btnStaff\",children:\"\\u0421\\u043A\\u0440\\u044B\\u0442\\u044C \\u0434\\u043E\\u0447\\u0435\\u0440\\u043D\\u0438\\u0438\"}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setModalMain(true);},className:\"btnStaff\",style:{float:'right'},children:\"\\u0421\\u0434\\u0435\\u043B\\u0430\\u0442\\u044C \\u0433\\u043B\\u0430\\u0432\\u043D\\u043E\\u0439\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"employeeWrapper\",children:[isFetching?/*#__PURE__*/_jsx(\"div\",{className:\"isFetching\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"}):users.length===0&&getUser.length!==0?'':!!departId?!isOpen?users.filter(function(user){return user.department_id===departId;}).map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):usersFilter.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):isLockDeps?usersFilterDeps.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):users.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}),!!isOpen?users.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):\"\",!!getUser?getUser.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):\"\"]}),/*#__PURE__*/_jsxs(Modal,{active:modalActive,setActive:setModalActive,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",children:[isModalFetching?/*#__PURE__*/_jsx(\"div\",{children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430\"}):deps.map(function(dep,id){return/*#__PURE__*/_jsxs(\"label\",{htmlFor:dep.department_name,style:{paddingLeft:\"\".concat(dep.margin,\"px\")},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",value:dep.id,id:dep.id,name:dep.department_name,onChange:handlePush,checked:dep.checked}),dep.department_name]},id);}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",disabled:isFetching,onClick:handleModalClick,children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"})]})]}),/*#__PURE__*/_jsxs(Modal,{active:modalMain,setActive:setModalMain,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",onChange:handleAddChildren}),\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0434\\u043E\\u0447\\u0435\\u0440\\u043D\\u0438\\u0435\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",disabled:isFetching,onClick:handleModalClick,children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"})]})]})]});}","map":{"version":3,"sources":["D:/Download/time_app/client/src/components/Staff/Staff.jsx"],"names":["useEffect","useState","axios","Employee","useParams","Modal","Staff","props","func","console","log","user","dep","users","setUsers","setUser","getUser","setGetUser","deps","setDeps","isOpen","setIsOpen","isFetching","setIsFetching","isJob","setIsJob","modalActive","setModalActive","modalMain","setModalMain","changedArr","isModalFetching","setIsModalFetching","departId","username","localUser","JSON","parse","localStorage","getItem","depsId","i","checkedDeps","length","push","addChecked","j","_id","checked","currentDep","filter","departmentId","filterDeps","find","dep_id","usersFilter","f","usersFilterDeps","depsFilterDeps","isLockDeps","addChildrenArr","fetchUsers","get","res","data","sort","a","b","user_name","localeCompare","filterUsers","filterUsersFoo","fetchUser","getDeps","k","margin","newArr","d","get_users_by_users","getUsers","id","post","users_users","main_department","status","concat","handlePush","e","target","value","index","indexOf","splice","handleAddChildren","global","chek","handleModalClick","preventDefault","info","userId","setchild","oldItems","newInfo","isAdmin","email","clear","setItem","stringify","get_users_by_dep","dep_users","width","window","location","href","float","department_id","map","department_name","paddingLeft"],"mappings":"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","sourcesContent":["import { useEffect, useState } from 'react'\r\nimport axios from 'axios'\r\n\r\nimport Employee from '../Employee/Employee'\r\nimport './Staff.css'\r\nimport { useParams } from 'react-router-dom'\r\nimport Modal from '../Templates/Modal/Modal'\r\nexport default function Staff(props) {\r\n  props.func(\"www\")\r\nconsole.log(props.user)\r\n  console.log(props.dep)\r\n  const [users, setUsers] = useState([])\r\n  const [user, setUser] = useState([])\r\n  const [getUser, setGetUser] = useState([])\r\n  const [deps, setDeps] = useState([])\r\n  const [isOpen, setIsOpen] = useState(false)\r\n  const [isFetching, setIsFetching] = useState(false)\r\n  const [isJob, setIsJob] = useState(true)\r\n  const [modalActive, setModalActive] = useState(false)\r\n  const [modalMain, setModalMain] = useState(false)\r\n  const changedArr = []\r\n  const [isModalFetching, setIsModalFetching] = useState(false)\r\n  const departId = useParams().username\r\n  const localUser = JSON.parse(localStorage.getItem('user'))\r\n  const depsId = useParams().username\r\n\r\n\r\n  for (let i = 0; i < localUser.checkedDeps?.length; i++) {\r\n    changedArr.push(localUser.checkedDeps[i])\r\n\r\n  }\r\n\r\n  // ставит галочки в модалке\r\n  function addChecked(deps) {\r\n    for (let i = 0; i < deps.length; i++) {\r\n      for (let j = 0; j < localUser.checkedDeps?.length; j++) {\r\n        if (deps[i]._id === localUser.checkedDeps[j]) {\r\n          deps[i].checked = true\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // фильтр нужных департаментов\r\n  const currentDep = deps.filter(dep => departId ? dep._id === departId : dep._id === localUser.departmentId)\r\n  let filterDeps = deps.filter(dep => currentDep.find(i => i === dep.dep_id || i === currentDep[0].dep_id))\r\n  filterDeps.push(...currentDep)\r\n\r\n  // фильтр нужных людей\r\n  const usersFilter = users.filter(user => filterDeps.find(f => f._id === user.departmentId))\r\n  const usersFilterDeps = users.filter(user => localUser.checkedDeps?.find(f => f === user.departmentId))\r\n  const depsFilterDeps = deps.filter(dep => localUser.checkedDeps?.find(f => f === dep._id))\r\n\r\n  const isLockDeps = localUser.checkedDeps !== null && localUser.checkedDeps?.length > 0\r\n\r\n  let addChildrenArr = []\r\n\r\n  useEffect(() => {\r\n\r\n    // получение всех пользователей\r\n    const fetchUsers = async () => {\r\n      setIsFetching(true)\r\n      const res = await axios.get('/api/user')\r\n      res.data.sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n      let filterUsers = filterUsersFoo(res.data)\r\n      setUsers(filterUsers)\r\n      setIsFetching(false)\r\n    }\r\n\r\n\r\n\r\n\r\n    // получение данных о себе\r\n    const fetchUser = async () => {\r\n      const res = await axios.get('/api/user/' + localUser._id)\r\n      setUser(res.data)\r\n      setIsFetching(false)\r\n    }\r\n\r\n    // получение и фильтр департаментов\r\n    const getDeps = async () => {\r\n      setIsModalFetching(true)\r\n      const res = await axios.get('/api/departments/')\r\n      addChecked(res.data)\r\n      for (let i = 0; i < res.data.length - 1; i++) {\r\n        for (let j = i + 1; j < res.data.length; j++) {\r\n          if (res.data.find(k => k === res.data[j].dep_id && k !== res.data[i].dep_id)) {\r\n            if (res.data[j].margin) {\r\n              res.data[j].margin += 10\r\n            } else {\r\n              res.data[j].margin = 10\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      let newArr = res.data.filter(d => d.dep_id !== 7)\r\n      newArr.push(res.data[6])\r\n\r\n      setDeps(newArr)\r\n      setIsModalFetching(false)\r\n    }\r\n    const get_users_by_users = async () => {\r\n      setIsFetching(true)\r\n      const getUsers={\r\n        id:localUser._id\r\n      }\r\n      const res = await axios.post('/api/get_users_by_users', getUsers)\r\n      const users_users = res.data[0]['get_users_by_users']\r\n      users_users.sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n      let filterUsers = filterUsersFoo(users_users)\r\n      setUsers(filterUsers)\r\n      console.log(\"get_users_by_users=\",users_users)\r\n      setIsFetching(false)\r\n      /*setIsOpen(true)*/\r\n\r\n    }\r\n    getDeps()\r\n    fetchUser()\r\n    setIsOpen(false)\r\n\r\n/*    console.log(\"user=\",user)\r\n    console.log('depsId=',depsId)\r\n    console.log('departId=',departId)*/\r\n\r\n    if(user.main_department===departId) {\r\n      setUsers([])\r\n      get_users_by_users()\r\n    }   else{\r\n      setGetUser([])\r\n      fetchUsers()\r\n    }\r\n\r\n  }, [departId])\r\n\r\n  // фильтр пользователей по статусу\r\n  function filterUsersFoo(users) {\r\n    return users.filter(user => user.status === 1)\r\n        .concat(users.filter(user => user.status === 2))\r\n        .concat(users.filter(user => user.status === 3))\r\n        .concat(users.filter(user => user.status !== 1 && user.status !== 2 && user.status !== 3 && user.status !== 4))\r\n        .concat(users.filter(user => user.status === 4))\r\n  }\r\n\r\n\r\n  // добавляем/удаляем департамент в модалке\r\n  const handlePush = e => {\r\n    if (e.target.checked) {\r\n      changedArr.push(e.target.value)\r\n    } else {\r\n      const index = changedArr.indexOf(e.target.value)\r\n      changedArr.splice(index, 1)\r\n      delete e.target.checked\r\n    }\r\n  }\r\n\r\n  // добавление дочерних\r\n  const handleAddChildren = e => {\r\n    global.chek = e.target.checked\r\n\r\n  }\r\n\r\n    // обновляем данные модального окна\r\n  const handleModalClick = async (e) => {\r\n    const chek=global.chek\r\n    e.preventDefault()\r\n  if (chek) {\r\n      const info={\r\n        userId:localUser._id,\r\n        deps:depsId,\r\n        setchild:true\r\n      }\r\n    const oldItems = JSON.parse(localStorage.getItem('user'))\r\n    const newInfo = {\r\n      _id: oldItems._id,\r\n      isAdmin: localUser.isAdmin,\r\n      username: localUser.username,\r\n      email: localUser.email,\r\n      departmentId: localUser.departmentId,\r\n      main_department: departId,\r\n      status:oldItems.status\r\n    }\r\n    localStorage.clear()\r\n    localStorage.setItem('user', JSON.stringify({...newInfo}))\r\n    await axios.post('/api/child/',info)\r\n    setIsOpen(true)\r\n    setModalMain(false)\r\n    }else{\r\n    const oldItems = JSON.parse(localStorage.getItem('user'))\r\n    const newInfo = {\r\n      _id: oldItems._id,\r\n      isAdmin: localUser.isAdmin,\r\n      username: localUser.username,\r\n      email: localUser.email,\r\n      departmentId: localUser.departmentId,\r\n      main_department: departId,\r\n      status:oldItems.status\r\n    }\r\n      const info ={\r\n        userId:localUser._id,\r\n        setchild:false,\r\n        deps:depsId\r\n      }\r\n    setIsOpen(false)\r\n    setModalMain(false)\r\n    localStorage.clear()\r\n    localStorage.setItem('user', JSON.stringify({...newInfo}))\r\n      await axios.post('/api/child/',info)\r\n\r\n    }\r\n  }\r\n\r\n  /*  let newInfo\r\n\r\n    if (departId) {\r\n      addChildrenArr = addChildrenArr.map(i => i.id)\r\n      newInfo = {\r\n        userId: user.id,\r\n        checkedDeps: [departId, ...addChildrenArr]\r\n      }\r\n    } else {\r\n      newInfo = {\r\n        userId: user._id,\r\n        checkedDeps: changedArr\r\n      }\r\n    }\r\n\r\n    try {\r\n      await axios.put('/api/user/' + localUser._id, newInfo)\r\n      if (user._id === localUser._id) {\r\n        localStorage.setItem('user', JSON.stringify({...user, ...newInfo}))\r\n      }\r\n      window.location.reload()\r\n    } catch (error) {\r\n      console.log(error);\r\n\r\n    }\r\n  }*/\r\n\r\n // функция get_users_by_dep\r\n  const get_users_by_dep = async () => {\r\n    if (isJob) {\r\n      const info = {\r\n        depsId: depsId\r\n      }\r\n      const res = await axios.post('/api/get_users_by_dep/', info)\r\n      const dep_users = res.data[0]['get_users_by_dep']\r\n      if (dep_users === null) {\r\n\r\n      } else {\r\n        console.log(\"get_users_by_dep=\",dep_users)\r\n        dep_users.sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n        let filterUsers = filterUsersFoo(dep_users)\r\n        setUsers(filterUsers)\r\n        setIsOpen(true)\r\n        setIsJob(!isJob)\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n\r\n/*\r\n  if(isJob){\r\n    setIsOpen(true)}else {\r\n    setIsOpen(false)}\r\n  setIsJob(!isJob)\r\n}\r\n*/\r\n\r\n  return (\r\n    <div className='staff'>\r\n      {/*{!departId && <div className='changeDepsContainer'>\r\n        {<div><span className='changeDeps' onClick={handleClick}>Изменить</span></div>}\r\n      </div>}*/}\r\n\r\n      {departId && <>\r\n        {isJob ? <button onClick={get_users_by_dep} className=\"btnStaff\" style={{width:'155px'}}>Показать дочернии</button> : <button onClick={() => window.location.href = `/department/${departId}`} className=\"btnStaff\" >Скрыть дочернии</button> }\r\n        <button onClick={() => setModalMain(true)} className='btnStaff' style={{float: 'right'}}>Сделать главной</button>\r\n      </>}\r\n\r\n      <div className=\"employeeWrapper\">\r\n        {isFetching\r\n            ? <div className='isFetching'>Загрузка...</div>\r\n            : users.length === 0\r\n                && getUser.length !==0\r\n                ? ''\r\n                : !!departId\r\n                    ? !isOpen\r\n                        ? users.filter(user => user.department_id === departId).map((user, id) => <Employee key={id} user={user}/>)\r\n                        : usersFilter.map((user, id) => <Employee key={id} user={user} />)\r\n                    : isLockDeps\r\n                        ? usersFilterDeps.map((user, id) => <Employee key={id} user={user}/>)\r\n                        : users.map((user, id) => <Employee key={id} user={user}/>)\r\n        }\r\n        {\r\n          !!isOpen\r\n              ?\r\n              users.map((user, id) =>  <Employee key={id} user={user}/>)\r\n              :\"\"\r\n        }\r\n\r\n        {\r\n          !!getUser\r\n        ?\r\n        getUser.map((user, id) =>  <Employee key={id} user={user}/>)\r\n        :\"\"\r\n        }\r\n      </div>\r\n      <Modal active={modalActive} setActive={setModalActive}>\r\n        <h1>Изменение информации:</h1>\r\n        <hr/>\r\n        <form className=\"modalLoginBox\">\r\n          {isModalFetching\r\n            ?<div>Загрузка</div>\r\n            : deps.map((dep, id) => <label key={id} htmlFor={dep.department_name} style={{paddingLeft: `${dep.margin}px`}}>\r\n            <input\r\n              type='checkbox'\r\n              value={dep.id}\r\n              id={dep.id}\r\n              name={dep.department_name}\r\n              onChange={handlePush}\r\n              checked={dep.checked}\r\n            />{dep.department_name}</label>)\r\n          }\r\n          <button className=\"ModalButton\" type=\"submit\" disabled={isFetching} onClick={handleModalClick}>\r\n            Изменить\r\n          </button>\r\n        </form>\r\n      </Modal>\r\n      <Modal active={modalMain} setActive={setModalMain}>\r\n        <h1>Изменение информации:</h1>\r\n        <hr/>\r\n        <form className=\"modalLoginBox\">\r\n          <label>\r\n            <input\r\n              type='checkbox'\r\n              onChange={handleAddChildren}\r\n            />Добавить дочерние</label>\r\n          <button className=\"ModalButton\" type=\"submit\" disabled={isFetching} onClick={handleModalClick}>\r\n            Изменить\r\n          </button>\r\n        </form>\r\n      </Modal>\r\n    </div>\r\n  )\r\n}"]},"metadata":{},"sourceType":"module"}