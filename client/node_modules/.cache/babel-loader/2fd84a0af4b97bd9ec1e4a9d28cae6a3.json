{"ast":null,"code":"import _regeneratorRuntime from\"D:/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState}from'react';import axios from'axios';import Employee from'../Employee/Employee';import'./Staff.css';import{Link,useParams}from'react-router-dom';import Modal from'../Templates/Modal/Modal';import VacanciesView from\"../VacanciesView/VacanciesView\";import VacanciesAdd from\"../VacanciesAdd/VacanciesAdd\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Staff(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),see_childs=_useState2[0],setSee_child=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),checked=_useState4[0],setChecked=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),statisticsWork=_useState6[0],setStatisticsWork=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),users=_useState8[0],setUsers=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),UsersDep=_useState10[0],setUsersDeps=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),us=_useState12[0],setUs=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),user=_useState14[0],setUser=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),getUser=_useState16[0],setGetUser=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),deps=_useState18[0],setDeps=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),isOpen=_useState20[0],setIsOpen=_useState20[1];var username=useParams();var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),isOpenVacation=_useState22[0],setIsOpenVacation=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),vacationAdd=_useState24[0],setVacationAdd=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),hideButtons=_useState26[0],setHideButtons=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),openAdd=_useState28[0],setIsOpenAdd=_useState28[1];var _useState29=useState(true),_useState30=_slicedToArray(_useState29,2),isJob=_useState30[0],setIsJob=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),isFetching=_useState32[0],setIsFetching=_useState32[1];var _useState33=useState(false),_useState34=_slicedToArray(_useState33,2),modalMain=_useState34[0],setModalMain=_useState34[1];var departId=useParams().username;var localUser=JSON.parse(localStorage.getItem('user'));var depsId=useParams().username;// фильтр нужных департаментов\nvar currentDep=deps.filter(function(dep){return departId?dep._id===departId:dep._id===localUser.departmentId;});var filterDeps=deps.filter(function(dep){return currentDep.find(function(i){return i===dep.dep_id||i===currentDep[0].dep_id;});});filterDeps.push.apply(filterDeps,_toConsumableArray(currentDep));useEffect(function(){///////////////////////////////////////////////////////////////////////////////////////////////////\n// получение всех пользователей\nvar fetchUsers=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,filterUsers;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsFetching(true);_context.next=3;return axios.get('/api/user');case 3:res=_context.sent;res.data.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});filterUsers=filterUsersFoo(res.data);setUsers(filterUsers);setIsFetching(false);case 8:case\"end\":return _context.stop();}}},_callee);}));return function fetchUsers(){return _ref.apply(this,arguments);};}();///////////////////////////////////////////////////////////////////////////////////////////////////\n//Вывод статистики для админов\nvar get_statistics_all_users=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var getUsers,res,all,all_users,sort,_sort,_sort2,_sort3,_sort4,_sort5;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(localUser.isAdmin===true)){_context2.next=21;break;}getUsers={id:localUser._id};_context2.next=4;return axios.post('/api/get_statistics_all_users',getUsers);case 4:res=_context2.sent;all=res.data[0].get_statistics_all_users[0]['all_users'].sort(function(a,b){return a.user_name.localeCompare(b.user_name);});all_users=filterUsersFoo(all);if(res.data[0].get_statistics_all_users[0]['all_users']===null&&!!~document.location.href.indexOf('/all_users/')){alert('Нет не одного пользователя в работе');}if(res.data[0].get_statistics_all_users[0]['not_working_today']===null&&!!~document.location.href.indexOf('/not_working_today/')){alert('Сегодня все в работе');window.location.href=\"/department/\".concat(localUser.departmentId);}if(res.data[0].get_statistics_all_users[0]['not_worked_yesterday']===null&&!!~document.location.href.indexOf('/not_worked_yesterday/')){alert('Вчера все работали');window.location.href=\"/department/\".concat(localUser.departmentId);}if(res.data[0].get_statistics_all_users[0]['sick_today']===null&&!!~document.location.href.indexOf('/sick_today/')){alert('Нет болеющих сегодня');window.location.href=\"/department/\".concat(localUser.departmentId);}if(res.data[0].get_statistics_all_users[0]['sick_yesterday']===null&&!!~document.location.href.indexOf('/sick_yesterday')){alert('Вчера не было сотрудников на больничном');window.location.href=\"/department/\".concat(localUser.main_department);}if(res.data[0].get_statistics_all_users[0]['vacation_today']===null&&!!~document.location.href.indexOf('/vacation_today')){alert('На сегодня нет сотрудников в отпуске');window.location.href=\"/department/\".concat(localUser.main_department);}if(res.data[0].get_statistics_all_users[0]['vacation_yesterday']===null&&!!~document.location.href.indexOf('/vacation_yesterday')){alert('Вчера не было сотрудников в отпуске');window.location.href=\"/department/\".concat(localUser.main_department);}if(!!~document.location.href.indexOf('/all_users/')){setIsJob(isJob);setStatisticsWork(all_users);}if(!!~document.location.href.indexOf('/not_working_today/')){if(res.data[0].get_statistics_all_users[0]['not_working_today']===null){}else{setIsJob(isJob);sort=res.data[0].get_statistics_all_users[0]['not_working_today'].sort(function(a,b){return a.user_name.localeCompare(b.user_name);});setStatisticsWork(filterUsersFoo(sort));}}if(!!~document.location.href.indexOf('/not_worked_yesterday/')){if(res.data[0].get_statistics_all_users[0]['not_worked_yesterday']===null){}else{setIsJob(isJob);_sort=res.data[0].get_statistics_all_users[0]['not_worked_yesterday'].sort(function(a,b){return a.user_name.localeCompare(b.user_name);});setStatisticsWork(filterUsersFoo(_sort));}}if(!!~document.location.href.indexOf('/sick_today/')){if(res.data[0].get_statistics_all_users[0]['sick_today']===null){}else{setIsJob(isJob);_sort2=res.data[0].get_statistics_all_users[0]['sick_today'].sort(function(a,b){return a.user_name.localeCompare(b.user_name);});setStatisticsWork(filterUsersFoo(_sort2));}}if(!!~document.location.href.indexOf('/sick_yesterday/')){if(res.data[0].get_statistics_all_users[0]['sick_yesterday']===null){}else{setIsJob(isJob);_sort3=res.data[0].get_statistics_all_users[0]['sick_yesterday'].sort(function(a,b){return a.user_name.localeCompare(b.user_name);});setStatisticsWork(filterUsersFoo(_sort3));}}if(!!~document.location.href.indexOf('/vacation_today/')){if(res.data[0].get_statistics_all_users[0]['vacation_today']===null){}else{setIsJob(isJob);_sort4=res.data[0].get_statistics_all_users[0]['vacation_today'].sort(function(a,b){return a.user_name.localeCompare(b.user_name);});setStatisticsWork(filterUsersFoo(_sort4));}}if(!!~document.location.href.indexOf('/vacation_yesterday/')){if(res.data[0].get_statistics_all_users[0]['vacation_yesterday']===null){}else{setIsJob(isJob);_sort5=res.data[0].get_statistics_all_users[0]['vacation_yesterday'].sort(function(a,b){return a.user_name.localeCompare(b.user_name);});setStatisticsWork(filterUsersFoo(_sort5));}}case 21:case\"end\":return _context2.stop();}}},_callee2);}));return function get_statistics_all_users(){return _ref2.apply(this,arguments);};}();// функция показывает нажата ли галочка показать дочернии\nvar statusChild=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var user;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.get('/api/user/'+localUser._id);case 2:user=_context3.sent;setChecked(user.data.see_child);setSee_child(user.data.see_child);case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function statusChild(){return _ref3.apply(this,arguments);};}();// Функция фиксирует всех пользоватей если стоит галочка добавить дочернии в модальном окне\nvar get_users_by_depIsCheckedTrue=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var info,addchild,dep_users,filterUsers;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:info={depsId:depsId};_context4.next=3;return axios.post('/api/get_users_by_dep/',info);case 3:addchild=_context4.sent;dep_users=addchild.data[0]['get_users_by_dep'];if(dep_users===null){setUs([]);}else{dep_users.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});filterUsers=filterUsersFoo(dep_users);setUs(filterUsers);}case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function get_users_by_depIsCheckedTrue(){return _ref4.apply(this,arguments);};}();if(user.main_department===departId){setUsers([]);}else{setGetUser([]);fetchUsers();setIsOpen(false);}if(departId&&!isOpen){setIsJob(isJob);}else{setIsJob(!isJob);}get_users_by_depIsCheckedTrue();get_statistics_all_users();statusChild();},[departId]);//Сортировка пользователей по статусам\nfunction filterUsersFoo(users){return users.filter(function(user){return user.status===1;}).concat(users.filter(function(user){return user.status===2;})).concat(users.filter(function(user){return user.status===3;})).concat(users.filter(function(user){return user.status!==1&&user.status!==2&&user.status!==3&&user.status!==4;})).concat(users.filter(function(user){return user.status===4;}));}// Добавление дочерних по checkbox\nvar clickcheckbox=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var info,inf,res,dep_users,filterUsers;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:setChecked(!checked);info={userId:localUser._id,ischeked:!checked};_context5.next=4;return axios.post('/api/statusChild/',info);case 4:inf={depsId:depsId};_context5.next=7;return axios.post('/api/get_users_by_dep/',inf);case 7:res=_context5.sent;dep_users=res.data[0]['get_users_by_dep'];if(dep_users===null){setUs([]);}else{dep_users.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});filterUsers=filterUsersFoo(dep_users);setUs(filterUsers);}if(checked===true){setIsJob(!isJob);}if(!checked===false){setIsJob(isJob);}case 12:case\"end\":return _context5.stop();}}},_callee5);}));return function clickcheckbox(){return _ref5.apply(this,arguments);};}();// Обновляем main department по кнопке изменить в модальном окне\nvar handleModalClick=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var add,res;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:add={id:localUser._id,depsId:depsId};_context6.next=3;return axios.put('/api/user',add);case 3:res=_context6.sent;setModalMain(false);case 5:case\"end\":return _context6.stop();}}},_callee6);}));return function handleModalClick(){return _ref6.apply(this,arguments);};}();// Функция get_users_by_dep по кнопке показать дочернии\nvar get_users_by_depIsOpen=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var info,res,dep_users,filterUsers;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(checked===true){setUs([]);}else{}if(!isJob){_context7.next=8;break;}info={depsId:depsId};_context7.next=5;return axios.post('/api/get_users_by_dep/',info);case 5:res=_context7.sent;dep_users=res.data[0]['get_users_by_dep'];if(dep_users===null){}else{dep_users.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});filterUsers=filterUsersFoo(dep_users);setUsersDeps(filterUsers);setIsOpen(true);setIsJob(!isJob);}case 8:case\"end\":return _context7.stop();}}},_callee7);}));return function get_users_by_depIsOpen(){return _ref7.apply(this,arguments);};}();var handleShowVacancies=function handleShowVacancies(){setIsOpen(true);setHideButtons(true);setIsOpenVacation(true);setIsOpenAdd(false);};var handleReturn=function handleReturn(){setIsOpen(false);setHideButtons(false);setIsOpenVacation(false);setVacationAdd(false);};var clickAdd=function clickAdd(){setIsOpenAdd(true);setIsOpenVacation(false);setVacationAdd(true);};return/*#__PURE__*/_jsxs(\"div\",{className:!hideButtons?'staff':'stafff',children:[departId&&/*#__PURE__*/_jsxs(_Fragment,{children:[!hideButtons&&/*#__PURE__*/_jsxs(_Fragment,{children:[checked===true||!isJob?/*#__PURE__*/_jsx(\"button\",{disabled:checked,onClick:function onClick(){return window.location.href=\"/department/\".concat(departId);},className:\"btnStaff\",children:\"\\u0421\\u043A\\u0440\\u044B\\u0442\\u044C \\u0434\\u043E\\u0447\\u0435\\u0440\\u043D\\u0438\\u0435\"}):/*#__PURE__*/_jsx(\"button\",{onClick:get_users_by_depIsOpen,className:\"btnStaff\",style:{width:'155px'},children:\"\\u041F\\u043E\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C \\u0434\\u043E\\u0447\\u0435\\u0440\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return setModalMain(true);},className:\"btnStaff\",style:{float:'right'},children:\"\\u0421\\u0434\\u0435\\u043B\\u0430\\u0442\\u044C \\u0433\\u043B\\u0430\\u0432\\u043D\\u043E\\u0439\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btnStaff\",onClick:hideButtons?handleReturn:handleShowVacancies,style:{width:'155px'},children:hideButtons?'Вернуться':'Показать вакансии'}),hideButtons&&(localUser||username===localUser._id)&&!openAdd&&/*#__PURE__*/_jsx(\"button\",{className:\"btnStaff\",onClick:clickAdd,children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0432\\u0430\\u043A\\u0430\\u043D\\u0441\\u0438\\u0438\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"employeeWrapper\",children:[isFetching&&checked===false?/*#__PURE__*/_jsx(\"div\",{className:\"isFetching\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"}):users.length===0&&getUser.length!==0?'':!!departId&&!checked&&!hideButtons?!isOpen?users.filter(function(user){return user.department_id===departId;}).map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):'':'',!departId?statisticsWork.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):'',checked&&!hideButtons?us.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):'',!!isOpen&&!hideButtons?UsersDep.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):\"\",!!getUser?getUser.map(function(user,id){return/*#__PURE__*/_jsx(Employee,{user:user},id);}):\"\"]}),isOpenVacation?/*#__PURE__*/_jsx(VacanciesView,{departId:departId}):'',vacationAdd?/*#__PURE__*/_jsx(VacanciesAdd,{depsId:depsId}):'',/*#__PURE__*/_jsxs(Modal,{active:modalMain,setActive:setModalMain,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",onChange:clickcheckbox,checked:checked}),\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0434\\u043E\\u0447\\u0435\\u0440\\u043D\\u0438\\u0435\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",disabled:isFetching,onClick:handleModalClick,children:\"\\u0421\\u0434\\u0435\\u043B\\u0430\\u0442\\u044C \\u0433\\u043B\\u0430\\u0432\\u043D\\u044B\\u043C \\u0434\\u0435\\u043F\\u0430\\u0440\\u0442\\u0430\\u043C\\u0435\\u043D\\u0442\\u043E\\u043C\"})]})]})]});}","map":{"version":3,"sources":["D:/time_app/client/src/components/Staff/Staff.jsx"],"names":["useEffect","useState","axios","Employee","Link","useParams","Modal","VacanciesView","VacanciesAdd","Staff","see_childs","setSee_child","checked","setChecked","statisticsWork","setStatisticsWork","users","setUsers","UsersDep","setUsersDeps","us","setUs","user","setUser","getUser","setGetUser","deps","setDeps","isOpen","setIsOpen","username","isOpenVacation","setIsOpenVacation","vacationAdd","setVacationAdd","hideButtons","setHideButtons","openAdd","setIsOpenAdd","isJob","setIsJob","isFetching","setIsFetching","modalMain","setModalMain","departId","localUser","JSON","parse","localStorage","getItem","depsId","currentDep","filter","dep","_id","departmentId","filterDeps","find","i","dep_id","push","fetchUsers","get","res","data","sort","a","b","user_name","localeCompare","filterUsers","filterUsersFoo","get_statistics_all_users","isAdmin","getUsers","id","post","all","all_users","document","location","href","indexOf","alert","window","main_department","statusChild","see_child","get_users_by_depIsCheckedTrue","info","addchild","dep_users","status","concat","clickcheckbox","userId","ischeked","inf","handleModalClick","add","put","get_users_by_depIsOpen","handleShowVacancies","handleReturn","clickAdd","width","float","length","department_id","map"],"mappings":"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","sourcesContent":["import {useEffect,useState} from 'react'\r\nimport axios from 'axios'\r\nimport Employee from '../Employee/Employee'\r\nimport './Staff.css'\r\nimport {Link, useParams} from 'react-router-dom'\r\nimport Modal from '../Templates/Modal/Modal'\r\nimport VacanciesView from \"../VacanciesView/VacanciesView\";\r\nimport VacanciesAdd from \"../VacanciesAdd/VacanciesAdd\"\r\n\r\n\r\nexport default function Staff() {\r\n    const [see_childs, setSee_child] = useState()\r\n    const [checked, setChecked] = useState(false)\r\n    const [statisticsWork, setStatisticsWork] = useState([])\r\n    const [users, setUsers] = useState([])\r\n    const [UsersDep, setUsersDeps] = useState([])\r\n    const [us, setUs] = useState([])\r\n    const [user, setUser] = useState([])\r\n    const [getUser, setGetUser] = useState([])\r\n    const [deps, setDeps] = useState([])\r\n    const [isOpen, setIsOpen] = useState(false)\r\n    const username = useParams()\r\n\r\n    const [isOpenVacation, setIsOpenVacation] = useState(false)\r\n    const [vacationAdd, setVacationAdd] = useState(false)\r\n    const [hideButtons, setHideButtons] = useState(false)\r\n\r\n    const [openAdd, setIsOpenAdd] = useState(false)\r\n\r\n    const [isJob, setIsJob] = useState(true)\r\n    const [isFetching, setIsFetching] = useState(false)\r\n    const [modalMain, setModalMain] = useState(false)\r\n    const departId = useParams().username\r\n    const localUser = JSON.parse(localStorage.getItem('user'))\r\n    const depsId = useParams().username\r\n\r\n    // фильтр нужных департаментов\r\n    const currentDep = deps.filter(dep => departId ? dep._id === departId : dep._id === localUser.departmentId)\r\n    let filterDeps = deps.filter(dep => currentDep.find(i => i === dep.dep_id || i === currentDep[0].dep_id))\r\n    filterDeps.push(...currentDep)\r\n\r\n    useEffect(() => {\r\n\r\n///////////////////////////////////////////////////////////////////////////////////////////////////\r\n        // получение всех пользователей\r\n        const fetchUsers = async () => {\r\n            setIsFetching(true)\r\n            const res = await axios.get('/api/user')\r\n            res.data.sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n            let filterUsers = filterUsersFoo(res.data)\r\n            setUsers(filterUsers)\r\n            setIsFetching(false)\r\n\r\n        }\r\n\r\n///////////////////////////////////////////////////////////////////////////////////////////////////\r\n        //Вывод статистики для админов\r\n        const get_statistics_all_users = async () => {\r\n\r\n            if (localUser.isAdmin === true) {\r\n                const getUsers = {\r\n                    id: localUser._id\r\n                }\r\n                const res = await axios.post('/api/get_statistics_all_users', getUsers)\r\n                const all = res.data[0].get_statistics_all_users[0]['all_users'].sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n\r\n                let all_users = filterUsersFoo(all)\r\n\r\n                if (res.data[0].get_statistics_all_users[0]['all_users'] === null && !!~document.location.href.indexOf('/all_users/')) {\r\n                    alert('Нет не одного пользователя в работе')\r\n                }\r\n                if (res.data[0].get_statistics_all_users[0]['not_working_today'] === null && !!~document.location.href.indexOf('/not_working_today/')) {\r\n                    alert('Сегодня все в работе')\r\n                    window.location.href = `/department/${localUser.departmentId}`\r\n                }\r\n                if (res.data[0].get_statistics_all_users[0]['not_worked_yesterday'] === null && !!~document.location.href.indexOf('/not_worked_yesterday/')) {\r\n                    alert('Вчера все работали')\r\n                    window.location.href = `/department/${localUser.departmentId}`\r\n                }\r\n                if (res.data[0].get_statistics_all_users[0]['sick_today'] === null && !!~document.location.href.indexOf('/sick_today/')) {\r\n                    alert('Нет болеющих сегодня')\r\n                    window.location.href = `/department/${localUser.departmentId}`\r\n                }\r\n                if (res.data[0].get_statistics_all_users[0]['sick_yesterday'] === null && !!~document.location.href.indexOf('/sick_yesterday')) {\r\n                    alert('Вчера не было сотрудников на больничном')\r\n                    window.location.href = `/department/${localUser.main_department}`\r\n                }\r\n                if (res.data[0].get_statistics_all_users[0]['vacation_today'] === null && !!~document.location.href.indexOf('/vacation_today')) {\r\n                    alert('На сегодня нет сотрудников в отпуске')\r\n                    window.location.href = `/department/${localUser.main_department}`\r\n                }\r\n                if (res.data[0].get_statistics_all_users[0]['vacation_yesterday'] === null && !!~document.location.href.indexOf('/vacation_yesterday')) {\r\n                    alert('Вчера не было сотрудников в отпуске')\r\n                    window.location.href = `/department/${localUser.main_department}`\r\n                }\r\n                if (!!~document.location.href.indexOf('/all_users/')) {\r\n                        setIsJob(isJob)\r\n                        setStatisticsWork(all_users)\r\n                }\r\n                if (!!~document.location.href.indexOf('/not_working_today/')) {\r\n                    if(res.data[0].get_statistics_all_users[0]['not_working_today']===null){\r\n\r\n                    }else{\r\n                        setIsJob(isJob)\r\n                        const sort = res.data[0].get_statistics_all_users[0]['not_working_today'].sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n                        setStatisticsWork(filterUsersFoo(sort))\r\n                    }\r\n                }\r\n\r\n                if (!!~document.location.href.indexOf('/not_worked_yesterday/')) {\r\n                    if (res.data[0].get_statistics_all_users[0]['not_worked_yesterday'] === null) {\r\n\r\n                    } else {\r\n                        setIsJob(isJob)\r\n                        const sort = res.data[0].get_statistics_all_users[0]['not_worked_yesterday'].sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n                        setStatisticsWork(filterUsersFoo(sort))\r\n                    }\r\n                }\r\n\r\n                if (!!~document.location.href.indexOf('/sick_today/')) {\r\n                    if(res.data[0].get_statistics_all_users[0]['sick_today']===null)\r\n                    {\r\n\r\n                    }else{\r\n                        setIsJob(isJob)\r\n                        const sort = res.data[0].get_statistics_all_users[0]['sick_today'].sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n                        setStatisticsWork(filterUsersFoo(sort))\r\n                    }\r\n                }\r\n\r\n                if (!!~document.location.href.indexOf('/sick_yesterday/')) {\r\n                    if(res.data[0].get_statistics_all_users[0]['sick_yesterday']===null)\r\n                    {\r\n\r\n                    }else{\r\n                        setIsJob(isJob)\r\n                        const sort = res.data[0].get_statistics_all_users[0]['sick_yesterday'].sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n                        setStatisticsWork(filterUsersFoo(sort))\r\n                    }\r\n                }\r\n\r\n                if (!!~document.location.href.indexOf('/vacation_today/')) {\r\n                    if(res.data[0].get_statistics_all_users[0]['vacation_today']===null)\r\n                    {\r\n\r\n                    }else{\r\n                        setIsJob(isJob)\r\n                        const sort = res.data[0].get_statistics_all_users[0]['vacation_today'].sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n                        setStatisticsWork(filterUsersFoo(sort))\r\n                    }\r\n                }\r\n\r\n                if (!!~document.location.href.indexOf('/vacation_yesterday/')) {\r\n                    if(res.data[0].get_statistics_all_users[0]['vacation_yesterday']===null)\r\n                    {\r\n\r\n                    }else{\r\n                        setIsJob(isJob)\r\n                        const sort = res.data[0].get_statistics_all_users[0]['vacation_yesterday'].sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n                        setStatisticsWork(filterUsersFoo(sort))\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n\r\n\r\n\r\n        // функция показывает нажата ли галочка показать дочернии\r\n        const statusChild = async () => {\r\n            const user = await axios.get('/api/user/' + localUser._id)\r\n            setChecked(user.data.see_child)\r\n            setSee_child(user.data.see_child)\r\n\r\n        }\r\n\r\n\r\n        // Функция фиксирует всех пользоватей если стоит галочка добавить дочернии в модальном окне\r\n        const get_users_by_depIsCheckedTrue= async () => {\r\n            const info = {\r\n                depsId: depsId\r\n            }\r\n            const addchild = await axios.post('/api/get_users_by_dep/', info)\r\n\r\n            const dep_users = addchild.data[0]['get_users_by_dep']\r\n            if (dep_users === null) {\r\n                setUs([])\r\n            } else {\r\n                dep_users.sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n                const filterUsers = filterUsersFoo(dep_users)\r\n                setUs(filterUsers)\r\n            }\r\n        }\r\n\r\n        if (user.main_department === departId) {\r\n            setUsers([])\r\n\r\n        } else {\r\n            setGetUser([])\r\n            fetchUsers()\r\n            setIsOpen(false)\r\n        }\r\nif(departId && !isOpen){\r\n    setIsJob(isJob)\r\n}else{\r\n    setIsJob(!isJob)\r\n}\r\n        get_users_by_depIsCheckedTrue()\r\n        get_statistics_all_users()\r\n        statusChild()\r\n\r\n    }, [departId])\r\n\r\n\r\n    //Сортировка пользователей по статусам\r\n    function filterUsersFoo(users) {\r\n        return users.filter(user => user.status === 1)\r\n            .concat(users.filter(user => user.status === 2))\r\n            .concat(users.filter(user => user.status === 3))\r\n            .concat(users.filter(user => user.status !== 1 && user.status !== 2 && user.status !== 3 && user.status !== 4))\r\n            .concat(users.filter(user => user.status === 4))\r\n    }\r\n\r\n\r\n    // Добавление дочерних по checkbox\r\n    const clickcheckbox = async () => {\r\n        setChecked(!checked);\r\n\r\n        const info = {\r\n            userId: localUser._id,\r\n            ischeked: !checked\r\n        };\r\n        await axios.post('/api/statusChild/', info);\r\n\r\n        const inf = {\r\n            depsId: depsId\r\n        };\r\n        const res = await axios.post('/api/get_users_by_dep/', inf);\r\n        const dep_users = res.data[0]['get_users_by_dep'];\r\n\r\n        if (dep_users === null) {\r\n            setUs([]);\r\n        } else {\r\n            dep_users.sort((a, b) => a.user_name.localeCompare(b.user_name));\r\n            let filterUsers = filterUsersFoo(dep_users);\r\n            setUs(filterUsers);\r\n        }\r\n        if(checked===true) {\r\n            setIsJob(!isJob)\r\n        }\r\n        if(!checked===false){\r\n            setIsJob(isJob)\r\n        }\r\n    }\r\n\r\n\r\n    // Обновляем main department по кнопке изменить в модальном окне\r\n    const handleModalClick = async () => {\r\n\r\n        const add = {\r\n            id: localUser._id,\r\n            depsId: depsId\r\n        }\r\n        const res = await axios.put('/api/user', add)\r\n        setModalMain(false)\r\n    }\r\n\r\n    // Функция get_users_by_dep по кнопке показать дочернии\r\n    const get_users_by_depIsOpen = async () => {\r\n    if(checked===true){\r\n        setUs([])\r\n    }else{\r\n\r\n    }\r\n        if (isJob) {\r\n            const info = {\r\n                depsId: depsId\r\n            }\r\n            const res = await axios.post('/api/get_users_by_dep/', info)\r\n            const dep_users = res.data[0]['get_users_by_dep']\r\n\r\n            if (dep_users === null) {\r\n\r\n            } else {\r\n                dep_users.sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n                let filterUsers = filterUsersFoo(dep_users)\r\n                setUsersDeps(filterUsers)\r\n                setIsOpen(true)\r\n                setIsJob(!isJob)\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    const handleShowVacancies = () => {\r\n        setIsOpen(true)\r\n        setHideButtons(true)\r\n        setIsOpenVacation(true)\r\n        setIsOpenAdd(false)\r\n    }\r\n\r\n    const handleReturn = () => {\r\n        setIsOpen(false)\r\n        setHideButtons(false)\r\n        setIsOpenVacation(false)\r\n        setVacationAdd(false)\r\n    }\r\n    const clickAdd = () => {\r\n        setIsOpenAdd(true)\r\n        setIsOpenVacation(false)\r\n        setVacationAdd(true)\r\n    }\r\n    return (\r\n\r\n        <div className={!hideButtons?'staff':'stafff'}>\r\n            {departId && (\r\n                <>\r\n                    {!hideButtons && (\r\n                        <>\r\n                            {checked === true || !isJob ? (\r\n                                <button disabled={checked} onClick={() => window.location.href = `/department/${departId}`} className=\"btnStaff\">\r\n                                    Скрыть дочерние\r\n                              </button>\r\n                            ) : (\r\n                                <button onClick={get_users_by_depIsOpen} className=\"btnStaff\" style={{ width: '155px' }}>\r\n                                    Показать дочерние\r\n                                </button>\r\n                            )}\r\n                            <button onClick={() => setModalMain(true)} className='btnStaff' style={{ float: 'right' }}>Сделать главной</button>\r\n                        </>\r\n                    )}\r\n\r\n                    <button className=\"btnStaff\" onClick={hideButtons ? handleReturn : handleShowVacancies} style={{ width: '155px' }}>\r\n                        {hideButtons ? 'Вернуться' : 'Показать вакансии'}\r\n                   </button>\r\n\r\n                    {hideButtons && (localUser || username === localUser._id)\r\n\r\n                    && !openAdd && <button className='btnStaff' onClick={clickAdd}>Добавить вакансии</button>}\r\n\r\n                </>\r\n            )}\r\n\r\n            <div className=\"employeeWrapper\">\r\n\r\n                {isFetching && checked===false\r\n                    ? <div className='isFetching'>Загрузка...</div>\r\n                    : users.length === 0 && getUser.length !== 0\r\n                        ? ''\r\n                        : !!departId  && !checked && !hideButtons\r\n                            ? !isOpen\r\n                                ? users.filter(user => user.department_id === departId).map((user, id) => <Employee key={id} user={user}/>)\r\n                                : ''\r\n                            : ''\r\n                }\r\n\r\n\r\n\r\n                {!departId\r\n                    ? statisticsWork.map((user, id) => <Employee key={id} user={user} />)\r\n                    :''\r\n\r\n                }\r\n\r\n                {\r\n                    checked && !hideButtons\r\n                        ? us.map((user, id) => <Employee key={id} user={user}/>)\r\n                        : ''\r\n                }\r\n\r\n                {\r\n                    !!isOpen && !hideButtons\r\n                        ?\r\n                        UsersDep.map((user, id) => <Employee key={id} user={user}/>)\r\n                        : \"\"\r\n                }\r\n\r\n                {\r\n                    !!getUser\r\n                        ?\r\n                        getUser.map((user, id) => <Employee key={id} user={user}/>)\r\n                        : \"\"\r\n                }\r\n\r\n            </div>\r\n            {isOpenVacation ?\r\n                <VacanciesView departId={departId}/>:''}\r\n\r\n            {vacationAdd ? <VacanciesAdd depsId={depsId}/>:'' }\r\n\r\n\r\n\r\n            <Modal active={modalMain} setActive={setModalMain}>\r\n                <h1>Изменение информации:</h1>\r\n                <hr/>\r\n                <form className=\"modalLoginBox\">\r\n                    <label>\r\n                        {<input\r\n                            type='checkbox'\r\n                            onChange={clickcheckbox}\r\n                            checked={checked}\r\n                        />\r\n                        }Добавить дочерние</label>\r\n                    <button className=\"ModalButton\" type=\"submit\" disabled={isFetching} onClick={handleModalClick}>\r\n                        Сделать главным департаментом\r\n                    </button>\r\n                </form>\r\n            </Modal>\r\n        </div>\r\n\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}