{"ast":null,"code":"import _objectSpread from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from'react';import Modal from\"../../Templates/Modal/Modal\";import axios from\"axios\";import{useParams}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Editing(_ref){var modalActive=_ref.modalActive,setModalActive=_ref.setModalActive;var username=useParams();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),selectedValue=_useState4[0],setSelectedValue=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),cityName=_useState6[0],setCityName=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),user=_useState8[0],setUser=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),nameValue=_useState10[0],setNameValue=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),email=_useState12[0],setEmail=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),emailChange=_useState14[0],setEmailChange=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),phone=_useState16[0],setPhone=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),phoneChange=_useState18[0],setPhoneChange=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),additional_contact=_useState20[0],setAdditional_Contact=_useState20[1];var _useState21=useState([]),_useState22=_slicedToArray(_useState21,2),additional_contact_change=_useState22[0],setAdditional_Contact_Change=_useState22[1];var _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),distribution_group=_useState24[0],setDistribution_Group=_useState24[1];var _useState25=useState([]),_useState26=_slicedToArray(_useState25,2),distribution_group_change=_useState26[0],setDistribution_Group_Change=_useState26[1];var _useState27=useState([]),_useState28=_slicedToArray(_useState27,2),activity_profile=_useState28[0],setActivity_Profile=_useState28[1];var _useState29=useState([]),_useState30=_slicedToArray(_useState29,2),activity_profile_change=_useState30[0],setActivity_Profile_Change=_useState30[1];var _useState31=useState([]),_useState32=_slicedToArray(_useState31,2),CityPlace=_useState32[0],setCityPlace=_useState32[1];var _useState33=useState([]),_useState34=_slicedToArray(_useState33,2),CityPlace_Change=_useState34[0],setCityPlace_Change=_useState34[1];var _useState35=useState([]),_useState36=_slicedToArray(_useState35,2),surnameValue=_useState36[0],setSurnameValue=_useState36[1];var _useState37=useState([]),_useState38=_slicedToArray(_useState37,2),options=_useState38[0],setOptions=_useState38[1];var localUse=JSON.parse(localStorage.getItem('user'));var modalDep=useRef();var phoneNumber=useRef();var additionalContact=useRef();var distributionGroup=useRef();var activityProfile=useRef();var modalCity=useRef();var modalCityPlace=useRef();var _useState39=useState([]),_useState40=_slicedToArray(_useState39,2),citiesId=_useState40[0],setCitiesId=_useState40[1];var _useState41=useState(''),_useState42=_slicedToArray(_useState41,2),searchTermCities=_useState42[0],setSearchTermCities=_useState42[1];var _useState43=useState([]),_useState44=_slicedToArray(_useState43,2),filteredCities=_useState44[0],setFilteredCities=_useState44[1];var _useState45=useState([]),_useState46=_slicedToArray(_useState45,2),cities=_useState46[0],setCities=_useState46[1];var handleUserClickCities=function handleUserClickCities(city_name,id){setCitiesId(id);setSearchTermCities(city_name);setFilteredCities([]);};var handleInputChangeCities=function handleInputChangeCities(e){var termCities=e.target.value;setSearchTermCities(termCities);if(termCities===''){setCitiesId('');setFilteredCities([]);setCityName('');return;// Добавьте это, чтобы избежать выполнения нижестоящего кода при пустом termCities\n}var filtered=cities.filter(function(city){return city.city_name&&city.city_name.toLowerCase().includes(termCities.toLowerCase());});setFilteredCities(filtered);};useEffect(function(){var getNameAndSurname=function getNameAndSurname(){if(user.user_name){var _user$user_name$split=user.user_name.split(\" \"),_user$user_name$split2=_slicedToArray(_user$user_name$split,2),name=_user$user_name$split2[0],surname=_user$user_name$split2[1];setSurnameValue(surname||\"\");setNameValue(name);}};var getDeps=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,data,extractedOptions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/department_tree_to_json/');case 2:res=_context.sent;data=res.data[0]['department_tree_to_json'];extractedOptions=extractOptions(data);setOptions(extractedOptions);setSelectedValue(user.department_id);case 7:case\"end\":return _context.stop();}}},_callee);}));return function getDeps(){return _ref2.apply(this,arguments);};}();var extractOptions=function extractOptions(node){var optionsList=[{id:node.id,name:node.Name}];if(node.Subclasses&&node.Subclasses.length>0){node.Subclasses.forEach(function(subclass){optionsList=optionsList.concat(extractOptions(subclass));});}return optionsList;};var getNameDeps=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var deps,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:deps={user:username.username};_context2.next=3;return axios.post('/api/departments/',deps);case 3:res=_context2.sent;setCityName(res.data[0]['city_name']);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function getNameDeps(){return _ref3.apply(this,arguments);};}();var fetchUser=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res,city;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.get('/api/user/'+username.username);case 2:res=_context3.sent;setUser(res.data);_context3.next=6;return axios.get('/api/Cities/');case 6:city=_context3.sent;setCities(city.data);case 8:case\"end\":return _context3.stop();}}},_callee3);}));return function fetchUser(){return _ref4.apply(this,arguments);};}();// Номинации\nif(user&&user.email&&email){setEmail(user.email);}if(user&&user.phone_number&&phone){setPhone(user.phone_number);}if(user&&user.additional_contact&&additional_contact){setAdditional_Contact(user.additional_contact);}if(user&&user.distribution_group&&distribution_group){setDistribution_Group(user.distribution_group);}if(user&&user.activity_profile&&activity_profile){setActivity_Profile(user.activity_profile);}if(user&&user.place_of_residence&&CityPlace){setCityPlace(user.place_of_residence);}getNameAndSurname();fetchUser();getDeps();getNameDeps();},[user.user_name,user.email,user.phone_number,user.additional_contact,user.distribution_group,user.activity_profile,user.place_of_residence,username.username]);var handleEmailChange=function handleEmailChange(e){if(e.target.value){setEmail('');setEmailChange(e.target.value);}if(e.target.value===''){setEmail('');setEmailChange('');}};var formatPhoneNumber=function formatPhoneNumber(value){// Убираем все символы, кроме цифр\nvar cleaned=value.replace(/\\D/g,'');if(cleaned.startsWith('7')){cleaned=cleaned.slice(1);// Удаляем ведущую 7, если она уже присутствует после +\n}// Ограничиваем длину очищенного значения до 10 цифр (XXX-XXX-XX-XX без кода страны)\ncleaned=cleaned.slice(0,10);// Разделяем на части, добавляя дефисы\nvar match=cleaned.match(/^(\\d{0,3})(\\d{0,3})(\\d{0,2})(\\d{0,2})$/);if(match){return'+7 '+[match[1],match[2],match[3],match[4]].filter(Boolean).join('-');}return'+7 '+cleaned;};var handlePhoneChange=function handlePhoneChange(e){if(e.target.value){setPhone('');setPhoneChange(e.target.value);}if(e.target.value===''){setPhone('');setPhoneChange('');}var value=e.target.value;if(value.length<1){setPhoneChange('');}else{var formattedValue=formatPhoneNumber(value);setPhoneChange(formattedValue);}};var additional_Contact=function additional_Contact(e){if(e.target.value){setAdditional_Contact('');setAdditional_Contact_Change(e.target.value);}if(e.target.value===''){setAdditional_Contact('');setAdditional_Contact_Change('');}};var distribution_Group=function distribution_Group(e){if(e.target.value){setDistribution_Group('');setDistribution_Group_Change(e.target.value);}if(e.target.value===''){setDistribution_Group('');setDistribution_Group_Change('');}};var activity_Profile=function activity_Profile(e){if(e.target.value){setActivity_Profile('');setActivity_Profile_Change(e.target.value);}if(e.target.value===''){setActivity_Profile('');setActivity_Profile_Change('');}};var cityPlace=function cityPlace(e){if(e.target.value){setCityPlace('');setCityPlace_Change(e.target.value);}if(e.target.value===''){setCityPlace('');setCityPlace_Change('');}};var handleNameChange=function handleNameChange(e){setNameValue(e.target.value);};var handleSurnameChange=function handleSurnameChange(e){setSurnameValue(e.target.value);};// изменение данных пользователя\nvar handleClick=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){var name,part,newInfo,newInfo2;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:name=user.user_name;part=name.split(' ');e.preventDefault();newInfo={departmentId:modalDep.current.value||user.department_id,email:email?email:emailChange.toUpperCase(),username:nameValue+' '+surnameValue,_id:user.id,isAdmin:user.isadmin,see_child:user.see_child,status:user.status,main_department:user.main_department,phone_number:phoneNumber.current.value===''?'':phoneNumber.current.value,additional_contact:additionalContact.current.value,distribution_group:distributionGroup.current.value,activity_profile:activityProfile.current.value,city_id:citiesId,cityPlaceChange:modalCityPlace.current.value};if(!(localUse._id!==username.username)){_context4.next=11;break;}newInfo2={departmentId:modalDep.current.value||user.department_id,email:email?email:emailChange.toUpperCase(),username:nameValue+' '+surnameValue,phone_number:phoneNumber.current.value===''?'':phoneNumber.current.value,additional_contact:additionalContact.current.value,distribution_group:distributionGroup.current.value,activity_profile:activityProfile.current.value,city_id:citiesId,_id:user.id,cityPlaceChange:modalCityPlace.current.value};_context4.next=8;return axios.put('/api/user/',newInfo2);case 8:window.location.reload();_context4.next=22;break;case 11:_context4.next=13;return axios.put('/api/user/',newInfo);case 13:delete newInfo.phone_number;delete newInfo.additional_contact;delete newInfo.distribution_group;delete newInfo.activity_profile;delete newInfo.city_id;delete newInfo.cityPlaceChange;localStorage.setItem('user',JSON.stringify(_objectSpread({},newInfo)));setModalActive(false);window.location.reload();case 22:case\"end\":return _context4.stop();}}},_callee4);}));return function handleClick(_x){return _ref5.apply(this,arguments);};}();var handleChange=function handleChange(e){setSelectedValue(e.target.value);};return/*#__PURE__*/_jsxs(Modal,{active:modalActive,setActive:setModalActive,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"modalError\",children:error}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",onSubmit:handleClick,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u0424\\u0430\\u043C\\u0438\\u043B\\u0438\\u044F\",className:\"ModalInputUpdate\",onChange:handleNameChange,value:nameValue})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u0418\\u043C\\u044F\",className:\"ModalInputUpdate\",onChange:handleSurnameChange,value:surnameValue})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{placeholder:\"Email\",type:\"email\",className:\"ModalInputUpdate\",onChange:handleEmailChange,value:email||emailChange,minLength:6})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u0422\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D\",type:\"text\",className:\"ModalInputUpdate\",ref:phoneNumber,onChange:handlePhoneChange,value:phone||phoneChange})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u0414\\u043E\\u043F \\u043A\\u043E\\u043D\\u0442\\u0430\\u043A\\u0442(\\u041D\\u043E\\u043C\\u0435\\u0440 \\u0442\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D\\u0430,\\u0424\\u0418\\u041E,\\u0441\\u0442\\u0430\\u0442\\u0443\\u0441 \\u0447\\u0435\\u043B\\u043E\\u0432\\u0435\\u043A\\u0430)\",type:\"text\",className:\"ModalInputUpdate\",ref:additionalContact,onChange:additional_Contact,value:additional_contact||additional_contact_change})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u0413\\u0440\\u0443\\u043F\\u043F\\u0430 \\u0440\\u0430\\u0441\\u0441\\u044B\\u043B\\u043A\\u0438\",type:\"text\",className:\"ModalInputUpdate\",ref:distributionGroup,onChange:distribution_Group,value:distribution_group||distribution_group_change})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u041F\\u0440\\u043E\\u0444\\u0438\\u043B\\u044C \\u0434\\u0435\\u044F\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u0438\",type:\"text\",className:\"ModalInputUpdate\",ref:activityProfile,onChange:activity_Profile,value:activity_profile||activity_profile_change})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u0413\\u043E\\u0440\\u043E\\u0434\",type:\"text\",className:\"ModalInputUpdate\",ref:modalCity,value:searchTermCities||cityName,onChange:handleInputChangeCities}),/*#__PURE__*/_jsxs(\"div\",{children:[filteredCities.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"divSelectRegister\",children:filteredCities.map(function(city,id){return/*#__PURE__*/_jsx(\"div\",{className:\"selectNameDiv\",value:city.id,onClick:function onClick(){return handleUserClickCities(city.city_name,city.id);},children:city.city_name},id);})}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u0410\\u0434\\u0440\\u0435\\u0441 \\u0444\\u0430\\u043A\\u0442\\u0438\\u0447\\u0435\\u0441\\u043A\\u043E\\u0433\\u043E \\u043F\\u0440\\u043E\\u0436\\u0438\\u0432\\u0430\\u043D\\u0438\\u044F\",type:\"text\",className:\"ModalInputUpdate\",ref:modalCityPlace,onChange:cityPlace,value:CityPlace||CityPlace_Change})]})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"select\",{value:selectedValue// Привязываем значение к selectedValue\n,onChange:handleChange,ref:modalDep,className:\"ModalInputUpdateSelect\",children:options.map(function(option){return/*#__PURE__*/_jsx(\"option\",{value:option.id,children:option.name},option.id);})})}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"})]})]});}export default Editing;","map":{"version":3,"sources":["D:/time_app/client/src/components/ProfileInfo/Editing/Editing.jsx"],"names":["React","useEffect","useRef","useState","Modal","axios","useParams","Editing","modalActive","setModalActive","username","error","setError","selectedValue","setSelectedValue","cityName","setCityName","user","setUser","nameValue","setNameValue","email","setEmail","emailChange","setEmailChange","phone","setPhone","phoneChange","setPhoneChange","additional_contact","setAdditional_Contact","additional_contact_change","setAdditional_Contact_Change","distribution_group","setDistribution_Group","distribution_group_change","setDistribution_Group_Change","activity_profile","setActivity_Profile","activity_profile_change","setActivity_Profile_Change","CityPlace","setCityPlace","CityPlace_Change","setCityPlace_Change","surnameValue","setSurnameValue","options","setOptions","localUse","JSON","parse","localStorage","getItem","modalDep","phoneNumber","additionalContact","distributionGroup","activityProfile","modalCity","modalCityPlace","citiesId","setCitiesId","searchTermCities","setSearchTermCities","filteredCities","setFilteredCities","cities","setCities","handleUserClickCities","city_name","id","handleInputChangeCities","e","termCities","target","value","filtered","filter","city","toLowerCase","includes","getNameAndSurname","user_name","split","name","surname","getDeps","get","res","data","extractedOptions","extractOptions","department_id","node","optionsList","Name","Subclasses","length","forEach","subclass","concat","getNameDeps","deps","post","fetchUser","phone_number","place_of_residence","handleEmailChange","formatPhoneNumber","cleaned","replace","startsWith","slice","match","Boolean","join","handlePhoneChange","formattedValue","additional_Contact","distribution_Group","activity_Profile","cityPlace","handleNameChange","handleSurnameChange","handleClick","part","preventDefault","newInfo","departmentId","current","toUpperCase","_id","isAdmin","isadmin","see_child","status","main_department","city_id","cityPlaceChange","newInfo2","put","window","location","reload","setItem","stringify","handleChange","map","option"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport Modal from \"../../Templates/Modal/Modal\";\r\nimport axios from \"axios\";\r\nimport { useParams } from \"react-router-dom\";\r\n\r\nfunction Editing({modalActive,setModalActive}) {\r\n    const username = useParams()\r\n\r\n    const [error, setError] = useState('')\r\n\r\n    const [selectedValue, setSelectedValue] = useState('');\r\n\r\n    const [cityName, setCityName] = useState([])\r\n\r\n    const [user, setUser] = useState([])\r\n\r\n    const [nameValue, setNameValue] = useState(\"\");\r\n\r\n\r\n    const [email, setEmail] = useState([])\r\n    const [emailChange, setEmailChange] = useState([])\r\n\r\n\r\n    const [phone, setPhone] = useState([])\r\n    const [phoneChange, setPhoneChange] = useState([])\r\n\r\n\r\n    const [additional_contact, setAdditional_Contact] = useState([])\r\n    const [additional_contact_change, setAdditional_Contact_Change] = useState([])\r\n\r\n\r\n    const [distribution_group, setDistribution_Group] = useState([])\r\n    const [distribution_group_change, setDistribution_Group_Change] = useState([])\r\n\r\n\r\n    const [activity_profile, setActivity_Profile] = useState([])\r\n    const [activity_profile_change, setActivity_Profile_Change] = useState([])\r\n\r\n    const [CityPlace, setCityPlace] = useState([])\r\n    const [CityPlace_Change, setCityPlace_Change] = useState([])\r\n\r\n\r\n    const [surnameValue, setSurnameValue] = useState([])\r\n\r\n\r\n    const [options, setOptions] = useState([]);\r\n\r\n\r\n    const localUse = JSON.parse(localStorage.getItem('user'))\r\n\r\n    const modalDep = useRef()\r\n    const phoneNumber = useRef()\r\n    const additionalContact = useRef()\r\n    const distributionGroup = useRef()\r\n    const activityProfile = useRef()\r\n    const modalCity = useRef()\r\n    const modalCityPlace = useRef()\r\n\r\n\r\n    const [citiesId, setCitiesId] = useState([])\r\n    const [searchTermCities, setSearchTermCities] = useState('');\r\n    const [filteredCities, setFilteredCities] = useState([]);\r\n    const [cities, setCities] = useState([])\r\n\r\n\r\n    const handleUserClickCities = (city_name, id) => {\r\n        setCitiesId(id)\r\n        setSearchTermCities(city_name)\r\n        setFilteredCities([])\r\n    }\r\n\r\n\r\n    const handleInputChangeCities = (e) => {\r\n        const termCities = e.target.value;\r\n        setSearchTermCities(termCities);\r\n\r\n        if (termCities === '') {\r\n            setCitiesId('');\r\n            setFilteredCities([]);\r\n            setCityName('');\r\n            return; // Добавьте это, чтобы избежать выполнения нижестоящего кода при пустом termCities\r\n        }\r\n\r\n        const filtered = cities.filter(city =>\r\n            city.city_name && city.city_name.toLowerCase().includes(termCities.toLowerCase())\r\n        );\r\n        setFilteredCities(filtered);\r\n    }\r\n\r\n\r\n\r\n    useEffect(() => {\r\n\r\n        const getNameAndSurname = () => {\r\n            if (user.user_name) {\r\n                const [name, surname] = user.user_name.split(\" \");\r\n                setSurnameValue(surname || \"\");\r\n                setNameValue(name);\r\n            }\r\n        }\r\n\r\n        const getDeps = async () => {\r\n\r\n            const res = await axios.get('/api/department_tree_to_json/');\r\n            const data = res.data[0]['department_tree_to_json'];\r\n            const extractedOptions = extractOptions(data);\r\n            setOptions(extractedOptions);\r\n            setSelectedValue(user.department_id);\r\n        }\r\n        const extractOptions = (node) => {\r\n            let optionsList = [{ id: node.id, name: node.Name }];\r\n            if (node.Subclasses && node.Subclasses.length > 0) {\r\n                node.Subclasses.forEach(subclass => {\r\n                    optionsList = optionsList.concat(extractOptions(subclass));\r\n                });\r\n            }\r\n            return optionsList;\r\n\r\n        };\r\n\r\n        const getNameDeps = async () => {\r\n            const deps = {\r\n                user: username.username\r\n            }\r\n            const res = await axios.post('/api/departments/', deps)\r\n            setCityName(res.data[0]['city_name'])\r\n        }\r\n\r\n        const fetchUser = async () => {\r\n            const res = await axios.get('/api/user/' + username.username)\r\n            setUser(res.data)\r\n\r\n\r\n            const city = await axios.get('/api/Cities/')\r\n            setCities(city.data)\r\n        }\r\n        // Номинации\r\n\r\n        if (user && user.email && email) {\r\n            setEmail(user.email);\r\n        }\r\n        if (user && user.phone_number && phone) {\r\n            setPhone(user.phone_number);\r\n        }\r\n\r\n        if (user && user.additional_contact && additional_contact) {\r\n            setAdditional_Contact(user.additional_contact);\r\n        }\r\n\r\n        if (user && user.distribution_group && distribution_group) {\r\n            setDistribution_Group(user.distribution_group);\r\n        }\r\n        if (user && user.activity_profile && activity_profile) {\r\n            setActivity_Profile(user.activity_profile);\r\n        }\r\n        if (user && user.place_of_residence && CityPlace) {\r\n            setCityPlace(user.place_of_residence);\r\n        }\r\n\r\n        getNameAndSurname();\r\n        fetchUser()\r\n        getDeps()\r\n        getNameDeps()\r\n    }, [\r\n        user.user_name,\r\n        user.email,\r\n        user.phone_number,\r\n        user.additional_contact,\r\n        user.distribution_group,\r\n        user.activity_profile,\r\n        user.place_of_residence,\r\n        username.username\r\n    ])\r\n\r\n    const handleEmailChange = (e) => {\r\n\r\n        if (e.target.value) {\r\n            setEmail('')\r\n            setEmailChange(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setEmail('')\r\n            setEmailChange('')\r\n        }\r\n\r\n    }\r\n    const formatPhoneNumber = (value) => {\r\n        // Убираем все символы, кроме цифр\r\n        let cleaned = value.replace(/\\D/g, '');\r\n        if (cleaned.startsWith('7')) {\r\n            cleaned = cleaned.slice(1); // Удаляем ведущую 7, если она уже присутствует после +\r\n        }\r\n        // Ограничиваем длину очищенного значения до 10 цифр (XXX-XXX-XX-XX без кода страны)\r\n        cleaned = cleaned.slice(0, 10);\r\n        // Разделяем на части, добавляя дефисы\r\n        const match = cleaned.match(/^(\\d{0,3})(\\d{0,3})(\\d{0,2})(\\d{0,2})$/);\r\n        if (match) {\r\n            return '+7 ' + [match[1], match[2], match[3], match[4]].filter(Boolean).join('-');\r\n        }\r\n        return '+7 ' + cleaned;\r\n    };\r\n    const handlePhoneChange = (e) => {\r\n        if (e.target.value) {\r\n            setPhone('')\r\n            setPhoneChange(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setPhone('')\r\n            setPhoneChange('')\r\n        }\r\n        const value = e.target.value;\r\n        if (value.length < 1) {\r\n            setPhoneChange('')\r\n        } else {\r\n            const formattedValue = formatPhoneNumber(value);\r\n            setPhoneChange(formattedValue);\r\n        }\r\n    }\r\n\r\n    const additional_Contact = (e) => {\r\n        if (e.target.value) {\r\n            setAdditional_Contact('')\r\n            setAdditional_Contact_Change(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setAdditional_Contact('')\r\n            setAdditional_Contact_Change('')\r\n        }\r\n    }\r\n\r\n    const distribution_Group = (e) => {\r\n        if (e.target.value) {\r\n            setDistribution_Group('')\r\n            setDistribution_Group_Change(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setDistribution_Group('')\r\n            setDistribution_Group_Change('')\r\n        }\r\n    }\r\n\r\n    const activity_Profile = (e) => {\r\n        if (e.target.value) {\r\n            setActivity_Profile('')\r\n            setActivity_Profile_Change(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setActivity_Profile('')\r\n            setActivity_Profile_Change('')\r\n        }\r\n    }\r\n\r\n    const cityPlace = (e) => {\r\n        if (e.target.value) {\r\n            setCityPlace('')\r\n            setCityPlace_Change(e.target.value)\r\n        }\r\n        if (e.target.value === '') {\r\n            setCityPlace('')\r\n            setCityPlace_Change('')\r\n        }\r\n    }\r\n\r\n    const handleNameChange = (e) => {\r\n        setNameValue(e.target.value);\r\n    }\r\n\r\n    const handleSurnameChange = (e) => {\r\n        setSurnameValue(e.target.value)\r\n    }\r\n\r\n\r\n    // изменение данных пользователя\r\n    const handleClick = async (e) => {\r\n\r\n        const name = user.user_name\r\n        const part = name.split(' ')\r\n        e.preventDefault()\r\n        const newInfo = {\r\n            departmentId: modalDep.current.value || user.department_id,\r\n            email: (email ? email : emailChange.toUpperCase()),\r\n            username: nameValue + ' ' + surnameValue,\r\n            _id: user.id,\r\n            isAdmin: user.isadmin,\r\n            see_child: user.see_child,\r\n            status: user.status,\r\n            main_department: user.main_department,\r\n            phone_number: (phoneNumber.current.value === '' ? '' : phoneNumber.current.value),\r\n            additional_contact: additionalContact.current.value,\r\n            distribution_group: distributionGroup.current.value,\r\n            activity_profile: activityProfile.current.value,\r\n            city_id: citiesId,\r\n            cityPlaceChange:modalCityPlace.current.value\r\n        }\r\n\r\n        if (localUse._id !== username.username) {\r\n            const newInfo2 = {\r\n                departmentId: modalDep.current.value || user.department_id,\r\n                email: (email ? email : emailChange.toUpperCase()),\r\n                username: nameValue + ' ' + surnameValue,\r\n                phone_number: (phoneNumber.current.value === '' ? '' : phoneNumber.current.value),\r\n                additional_contact: additionalContact.current.value,\r\n                distribution_group: distributionGroup.current.value,\r\n                activity_profile: activityProfile.current.value,\r\n                city_id: citiesId,\r\n                _id: user.id,\r\n                cityPlaceChange:modalCityPlace.current.value\r\n            }\r\n\r\n            await axios.put('/api/user/', newInfo2)\r\n            window.location.reload()\r\n        } else {\r\n            await axios.put('/api/user/', newInfo)\r\n            delete newInfo.phone_number\r\n            delete newInfo.additional_contact\r\n            delete newInfo.distribution_group\r\n            delete newInfo.activity_profile\r\n            delete newInfo.city_id\r\n            delete newInfo.cityPlaceChange\r\n            localStorage.setItem('user', JSON.stringify({...newInfo}))\r\n            setModalActive(false)\r\n            window.location.reload()\r\n        }\r\n    }\r\n\r\n    const handleChange = (e) => {\r\n        setSelectedValue(e.target.value);\r\n    };\r\n\r\n\r\n    return (\r\n\r\n\r\n                <Modal active={modalActive} setActive={setModalActive}>\r\n                    <h1>Изменение информации:</h1>\r\n                    <hr/>\r\n                    {error && <div className='modalError'>{error}</div>}\r\n                    <form className=\"modalLoginBox\" onSubmit={handleClick}>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Фамилия\"\r\n                                className=\"ModalInputUpdate\"\r\n                                onChange={handleNameChange}\r\n                                value={nameValue}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Имя\"\r\n                                className=\"ModalInputUpdate\"\r\n                                onChange={handleSurnameChange}\r\n                                value={surnameValue}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Email\"\r\n                                type=\"email\"\r\n                                className=\"ModalInputUpdate\"\r\n                                onChange={handleEmailChange}\r\n                                value={email || emailChange}\r\n                                minLength={6}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Телефон\"\r\n                                type='text'\r\n                                className=\"ModalInputUpdate\"\r\n                                ref={phoneNumber}\r\n                                onChange={handlePhoneChange}\r\n                                value={phone || phoneChange}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Доп контакт(Номер телефона,ФИО,статус человека)\"\r\n                                type='text'\r\n                                className=\"ModalInputUpdate\"\r\n                                ref={additionalContact}\r\n                                onChange={additional_Contact}\r\n                                value={additional_contact || additional_contact_change}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Группа рассылки\"\r\n                                type='text'\r\n                                className=\"ModalInputUpdate\"\r\n                                ref={distributionGroup}\r\n                                onChange={distribution_Group}\r\n                                value={distribution_group || distribution_group_change}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Профиль деятельности\"\r\n                                type='text'\r\n                                className=\"ModalInputUpdate\"\r\n                                ref={activityProfile}\r\n                                onChange={activity_Profile}\r\n                                value={activity_profile || activity_profile_change}\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <input\r\n                                placeholder=\"Город\"\r\n                                type='text'\r\n                                className=\"ModalInputUpdate\"\r\n                                ref={modalCity}\r\n                                value={searchTermCities || cityName}\r\n                                onChange={handleInputChangeCities}\r\n                            />\r\n                            <div>\r\n                                {filteredCities.length > 0 && (\r\n                                    <div className='divSelectRegister'>\r\n                                        {filteredCities.map((city, id) => (\r\n                                            <div className='selectNameDiv' key={id} value={city.id}\r\n                                                 onClick={() => handleUserClickCities(city.city_name, city.id)}>\r\n                                                {city.city_name}\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                                <input\r\n                                    placeholder=\"Адрес фактического проживания\"\r\n                                    type='text'\r\n                                    className=\"ModalInputUpdate\"\r\n                                    ref={modalCityPlace}\r\n                                    onChange={cityPlace}\r\n                                    value={CityPlace || CityPlace_Change}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <select\r\n                                value={selectedValue} // Привязываем значение к selectedValue\r\n                                onChange={handleChange}\r\n                                ref={modalDep}\r\n                                className=\"ModalInputUpdateSelect\"\r\n                            >\r\n                                {options.map((option) => (\r\n                                    <option key={option.id} value={option.id}>\r\n                                        {option.name}\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                        <button className=\"ModalButton\" type=\"submit\">\r\n                            Изменить\r\n                        </button>\r\n                    </form>\r\n                </Modal>\r\n\r\n        )\r\n}\r\n\r\nexport default Editing;"]},"metadata":{},"sourceType":"module"}