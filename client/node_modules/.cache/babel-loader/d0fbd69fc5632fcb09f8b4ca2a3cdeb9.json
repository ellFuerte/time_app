{"ast":null,"code":"import _regeneratorRuntime from\"D:/Download/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from'react';import Topbar from'../../components/Topbar/Topbar';import'./Reports.css';import axios from\"axios\";import{useParams}from\"react-router-dom\";import InfoReposts from\"../../components/ReportsInfo/InfoReposts\";import VacationPost from\"../../components/VacationPost/VacationPost\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function Reports(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isFetching=_useState2[0],setIsFetching=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var historyStartWork=useRef(null);var historyEndWork=useRef(null);var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),isJob=_useState6[0],setIsJob=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isFilter=_useState10[0],setIsFilter=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),posts=_useState12[0],setPosts=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),vacationPosts=_useState14[0],setVacationPosts=_useState14[1];var username=useParams();var localUser=!!username?{_id:username.username,email:\"\"}:JSON.parse(localStorage.getItem('user'));var localUse=JSON.parse(localStorage.getItem('user'));var depsId=useParams().username;console.log(\"user=\",depsId,username.username,user.id);var handleClick=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var start,end,filter,fill;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:start=historyStartWork.current.value;end=historyEndWork.current.value;if(start===\"\"||end===\"\"){setError('Введите дату');}else{if(start!==''||end!==''){setError('Выберите дату');}if(end<start){setError('Конечная дата меньше начальной');}else{filter={startdate:historyStartWork.current.value,enddate:historyEndWork.current.value,userId:localUse._id,typework:isJob};setError('');fill=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.post('/api/post/filter',filter);case 2:res=_context.sent;console.log(res);setVacationPosts(res.data.sort(function(p1,p2){return new Date(p2.workstart)-new Date(p1.workstart);}));setPosts(res.data.sort(function(p1,p2){return new Date(p2.workstart)-new Date(p1.workstart);}));setError('');case 7:case\"end\":return _context.stop();}}},_callee);}));return function fill(){return _ref2.apply(this,arguments);};}();fill();}}case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleClick(){return _ref.apply(this,arguments);};}();var handleClickCancel=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setError('');setIsFilter(false);historyStartWork.current.value='';historyEndWork.current.value='';case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function handleClickCancel(){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Topbar,{}),/*#__PURE__*/_jsx(\"div\",{className:\"Reports\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"ReportsContainer\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"ReportsMainText\",children:\"\\u041E\\u0442\\u0447\\u0435\\u0442\\u044B\"}),/*#__PURE__*/_jsx(\"hr\",{}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"errorHistoryInfo\",children:error}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",placeholder:\"\\u041D\\u0430\\u0447\\u0430\\u043B\\u043E \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B\",className:\"ModalInput\",ref:historyStartWork,style:{'marginRight':'10px'}}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",placeholder:\"\\u041A\\u043E\\u043D\\u0435\\u0446 \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B\",className:\"ModalInput\",ref:historyEndWork,style:{'marginRight':'10px'}}),/*#__PURE__*/_jsx(\"button\",{className:\"filterButton\",onClick:handleClick,children:\"\\u043E\\u043A\"}),/*#__PURE__*/_jsx(\"button\",{className:\"filterButton\",onClick:handleClickCancel,children:\"\\u0441\\u0431\\u0440\\u043E\\u0441\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"br\",{}),isJob?/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"historyinfodate\",children:\"\\u0424\\u0418\\u041E\"}),/*#__PURE__*/_jsx(\"td\",{className:\"historyinfopost\",children:\"\\u041D\\u0430\\u0447\\u0430\\u043B\\u043E\"}),/*#__PURE__*/_jsx(\"td\",{className:\"historyinfopost\",children:\"\\u041A\\u043E\\u043D\\u0435\\u0446\"}),/*#__PURE__*/_jsx(\"td\",{className:\"historyinfopost\",children:\"\\u0414\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u044C\"})]}):\"\"]})})]});}","map":{"version":3,"sources":["D:/Download/time_app/client/src/pages/Reports/Reports.jsx"],"names":["React","useEffect","useRef","useState","Topbar","axios","useParams","InfoReposts","VacationPost","Reports","isFetching","setIsFetching","user","setUser","historyStartWork","historyEndWork","isJob","setIsJob","error","setError","isFilter","setIsFilter","posts","setPosts","vacationPosts","setVacationPosts","username","localUser","_id","email","JSON","parse","localStorage","getItem","localUse","depsId","console","log","id","handleClick","start","current","value","end","filter","startdate","enddate","userId","typework","fill","post","res","data","sort","p1","p2","Date","workstart","handleClickCancel"],"mappings":"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","sourcesContent":["import React, {useEffect, useRef, useState} from 'react'\r\nimport Topbar from '../../components/Topbar/Topbar'\r\nimport './Reports.css'\r\nimport axios from \"axios\";\r\nimport {useParams} from \"react-router-dom\";\r\nimport InfoReposts from \"../../components/ReportsInfo/InfoReposts\";\r\nimport VacationPost from \"../../components/VacationPost/VacationPost\";\r\n\r\nexport default function Reports() {\r\n    const [isFetching, setIsFetching] = useState(false)\r\n    const [user, setUser] = useState([])\r\n    const historyStartWork = useRef(null)\r\n    const historyEndWork = useRef(null)\r\n    const [isJob, setIsJob] = useState(true)\r\n    const [error, setError] = useState('')\r\n    const [isFilter, setIsFilter] = useState(false)\r\n    const [posts, setPosts] = useState([])\r\n    const [vacationPosts, setVacationPosts] = useState([])\r\n    const username=useParams()\r\n    let localUser = !!username ? {_id:username.username,email:\"\"} : JSON.parse(localStorage.getItem('user'))\r\n    const localUse = JSON.parse(localStorage.getItem('user'))\r\n    const depsId = useParams().username\r\n\r\n    console.log(\"user=\",depsId,username.username,user.id)\r\n\r\n    const handleClick = async () => {\r\n        const start = historyStartWork.current.value\r\n        const end = historyEndWork.current.value\r\n        if (start === \"\" || end === \"\") {\r\n            setError('Введите дату')\r\n        } else {\r\n            if (start !== '' || end !== '') {\r\n                setError('Выберите дату')\r\n            }\r\n            if (end < start) {\r\n                setError('Конечная дата меньше начальной')\r\n            } else {\r\n\r\n                const filter = {\r\n                    startdate: historyStartWork.current.value,\r\n                    enddate: historyEndWork.current.value,\r\n                    userId: localUse._id,\r\n                    typework: isJob\r\n                }\r\n                setError('')\r\n\r\n                const fill = async () => {\r\n                    const res = await axios.post('/api/post/filter', filter)\r\n                    console.log(res)\r\n                    setVacationPosts(res.data.sort((p1, p2) => {\r\n                        return new Date(p2.workstart) - new Date(p1.workstart)\r\n                    }))\r\n                    setPosts(res.data.sort((p1, p2) => {\r\n                        return new Date(p2.workstart) - new Date(p1.workstart)\r\n                    }))\r\n                    setError('')\r\n                }\r\n                fill()\r\n            }\r\n        }\r\n    }\r\n    const handleClickCancel = async () =>{\r\n        setError('')\r\n        setIsFilter(false)\r\n        historyStartWork.current.value = ''\r\n        historyEndWork.current.value = ''\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Topbar/>\r\n            <div className='Reports'>\r\n                <div className=\"ReportsContainer\">\r\n                    <h2 className='ReportsMainText'>Отчеты</h2>\r\n                    <hr/>\r\n                    {error && <div className='errorHistoryInfo'>{error}</div>}\r\n                    <br/>\r\n                    <input\r\n                        type='date'\r\n                        placeholder=\"Начало работы\"\r\n                        className=\"ModalInput\"\r\n                        ref={historyStartWork}\r\n                        style={{'marginRight': '10px'}}\r\n                    />\r\n                    <input\r\n                        type='date'\r\n                        placeholder=\"Конец работы\"\r\n                        className=\"ModalInput\"\r\n                        ref={historyEndWork}\r\n                        style={{'marginRight': '10px'}}\r\n                    />\r\n                    <button className=\"filterButton\" onClick={handleClick}>ок</button>\r\n                    <button className=\"filterButton\" onClick={handleClickCancel}>сбросить</button>\r\n                    <br/>\r\n                    <br/>\r\n                    <hr/>\r\n                    <br/>\r\n                    {isJob\r\n                        ?\r\n                        <tr>\r\n                            <td className=\"historyinfodate\">ФИО</td>\r\n                            <td className=\"historyinfopost\">Начало</td>\r\n                            <td className=\"historyinfopost\">Конец</td>\r\n                            <td className=\"historyinfopost\">Длительность</td>\r\n                        </tr>\r\n                        :\"\"\r\n                    }\r\n                </div>\r\n            </div>\r\n        </>\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}