{"ast":null,"code":"import _objectSpread from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/Download/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useRef,useState}from'react';import axios from'axios';import{CircularProgress}from'@material-ui/core';import Modal from'../Templates/Modal/Modal';import'./Status.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var usersStatuses={0:'',1:'start',2:'end',3:'sick_leave',4:'deleted',5:'vacation',6:'time_off',7:'other'};function findStatus(k){for(var i in usersStatuses){if(i==k){return usersStatuses[i];}}}export default function Status(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var localUser=JSON.parse(localStorage.getItem('user'));var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isFetching=_useState4[0],setIsFetching=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),status=_useState6[0],setStatus=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),modalActive=_useState10[0],setModalActive=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),modalName=_useState12[0],setModalName=_useState12[1];var modalComment=useRef();// получение данных пользователя о работе\nuseEffect(function(){var fetchUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/user/'+localUser._id);case 2:res=_context.sent;setUser(res.data);/*     setPosts(res.data.sort((p1, p2) => {\r\n        return new Date(p2.workStart) - new Date(p1.workStart)\r\n      }))*/case 4:case\"end\":return _context.stop();}}},_callee);}));return function fetchUser(){return _ref.apply(this,arguments);};}();fetchUser();},[localUser._id]);// начало работы.\nvar handlerStart=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var newPost,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();if(+modalName===0&&modalComment.current.value===''){setError('Заполните комментарий');}if(!(+modalName!==0&&+modalName!==1)){_context2.next=6;break;}setError('Заполните состояние здоровья');_context2.next=19;break;case 6:setIsFetching(true);newPost={userId:localUser._id,typework_id:1,status:1,healthStart:+modalName,commentStart:modalComment.current.value||'-',workStart:new Date(Date.now())};_context2.prev=8;_context2.next=11;return axios.post(\"/api/post/\",newPost);case 11:res=_context2.sent;/*await axios.post(\"/api/status/\")*/ /*await axios.put('/api/user/'+user._id, {status:1, userId: user._id})*/localStorage.setItem('user',JSON.stringify(_objectSpread(_objectSpread({},localUser),{},{status:1})));window.location.reload();_context2.next=19;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](8);console.log(_context2.t0);case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[8,16]]);}));return function handlerStart(_x){return _ref2.apply(this,arguments);};}();// конец работы\nvar handlerEnd=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var newPost;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();if(!(+modalName===0&&modalComment.current.value==='')){_context3.next=4;break;}setError('Заполните комментарий');return _context3.abrupt(\"return\");case 4:setIsFetching(true);newPost={userId:localUser._id,typework_id:1,status:2,healthEnd:+modalName,commentEnd:modalComment.current.value||'-',workEnd:new Date(Date.now())/*workTime: new Date(Date.now()) - new Date(posts[0].workStart)*/};_context3.prev=6;_context3.next=9;return axios.put(\"/api/post/\",newPost);case 9:/*await axios.put('/api/user/'+user._id, {status:2, userId: user._id})*/localStorage.setItem('user',JSON.stringify(_objectSpread(_objectSpread({},localUser),{},{status:2})));window.location.reload();_context3.next=16;break;case 13:_context3.prev=13;_context3.t0=_context3[\"catch\"](6);console.log(_context3.t0);case 16:case\"end\":return _context3.stop();}}},_callee3,null,[[6,13]]);}));return function handlerEnd(_x2){return _ref3.apply(this,arguments);};}();var handleName=function handleName(e){setModalName(e.target.value);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",onClick:function onClick(){return setModalActive(true);},className:'statusBtn '+findStatus(user.status),children:isFetching?/*#__PURE__*/_jsx(CircularProgress,{style:{color:'white',size:'20px',width:'20px',height:'20px'}}):user.status!==1?'Начать':'Закончить'}),/*#__PURE__*/_jsxs(Modal,{active:modalActive,setActive:setModalActive,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"modalError\",children:error}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",onSubmit:user.status===1?handlerEnd:handlerStart,children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',fontSize:'20px',width:'30%',marginLeft:'35%',marginTop:'30px'},children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"sickLeave\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:1,id:\"sickLeave\",name:\"sickLeave\",onChange:handleName,checked:+modalName===1}),\"\\u0417\\u0434\\u043E\\u0440\\u043E\\u0432\"]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"vacation\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:0,id:\"vacation\",name:\"vacation\",onChange:handleName,checked:+modalName===0}),\"\\u0411\\u043E\\u043B\\u0435\\u043D\"]})]}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0439\",className:\"ModalInput\",ref:modalComment}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",disabled:isFetching,children:\"\\u043E\\u043A\"})]})]})]});}","map":{"version":3,"sources":["D:/Download/time_app/client/src/components/Status/Status.jsx"],"names":["useEffect","useRef","useState","axios","CircularProgress","Modal","usersStatuses","findStatus","k","i","Status","user","setUser","localUser","JSON","parse","localStorage","getItem","isFetching","setIsFetching","status","setStatus","error","setError","modalActive","setModalActive","modalName","setModalName","modalComment","fetchUser","get","_id","res","data","handlerStart","e","preventDefault","current","value","newPost","userId","typework_id","healthStart","commentStart","workStart","Date","now","post","setItem","stringify","window","location","reload","console","log","handlerEnd","healthEnd","commentEnd","workEnd","put","handleName","target","color","size","width","height","display","justifyContent","fontSize","marginLeft","marginTop"],"mappings":"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","sourcesContent":["import { useEffect, useRef, useState } from 'react'\r\nimport axios from 'axios'\r\nimport {CircularProgress} from '@material-ui/core'\r\nimport Modal from '../Templates/Modal/Modal'\r\nimport './Status.css'\r\n\r\nconst usersStatuses = {0: '', 1: 'start', 2: 'end', 3: 'sick_leave', 4: 'deleted' ,5: 'vacation', 6: 'time_off', 7: 'other'}\r\nfunction findStatus(k){\r\n  for(let i in usersStatuses){\r\n    if(i == k){\r\n      return usersStatuses[i]\r\n    }\r\n  }\r\n}\r\nexport default function Status() {\r\n  const [user, setUser] = useState([])\r\n  const localUser = JSON.parse(localStorage.getItem('user'))\r\n  const [isFetching, setIsFetching] = useState(false)\r\n  const [status, setStatus]= useState('')\r\n  const [error, setError] = useState('')\r\n  const [modalActive, setModalActive] = useState(false)\r\n  const [modalName, setModalName] = useState()\r\n  const modalComment = useRef()\r\n\r\n  // получение данных пользователя о работе\r\n  useEffect(() => {\r\n    const fetchUser = async () => {\r\n      const res = await axios.get('/api/user/'+localUser._id)\r\n      setUser(res.data)\r\n /*     setPosts(res.data.sort((p1, p2) => {\r\n        return new Date(p2.workStart) - new Date(p1.workStart)\r\n      }))*/\r\n    }\r\n    fetchUser()\r\n  }, [localUser._id])\r\n\r\n  // начало работы.\r\n  const handlerStart = async (e) => {\r\n    e.preventDefault()\r\n    if (+modalName === 0 && modalComment.current.value === '') {\r\n      setError('Заполните комментарий')}\r\n      if (+modalName !== 0 && +modalName !== 1) {\r\n        setError('Заполните состояние здоровья')\r\n    } else {\r\n      setIsFetching(true)\r\n      const newPost = {\r\n        userId: localUser._id,\r\n        typework_id: 1,\r\n        status: 1,\r\n        healthStart: +modalName,\r\n        commentStart: modalComment.current.value || '-',\r\n        workStart: new Date(Date.now())\r\n      }\r\n      try {\r\n        const res = await axios.post(\"/api/post/\", newPost)\r\n\r\n        /*await axios.post(\"/api/status/\")*/\r\n        /*await axios.put('/api/user/'+user._id, {status:1, userId: user._id})*/\r\n        localStorage.setItem('user', JSON.stringify({...localUser, status: 1}))\r\n        window.location.reload()\r\n      } catch (error) {\r\n        console.log(error)\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  // конец работы\r\n  const handlerEnd = async (e) => {\r\n    e.preventDefault()\r\n    if(+modalName === 0 && modalComment.current.value===''){\r\n      setError('Заполните комментарий')\r\n      return\r\n    }\r\n\r\n    setIsFetching(true)\r\n    const newPost = {\r\n      userId: localUser._id,\r\n      typework_id: 1,\r\n      status: 2,\r\n      healthEnd: +modalName,\r\n      commentEnd: modalComment.current.value  || '-',\r\n      workEnd: new Date(Date.now())\r\n      /*workTime: new Date(Date.now()) - new Date(posts[0].workStart)*/\r\n    }\r\n\r\n    try {\r\n\r\n      await axios.put(\"/api/post/\", newPost)\r\n      /*await axios.put('/api/user/'+user._id, {status:2, userId: user._id})*/\r\n      localStorage.setItem('user', JSON.stringify({...localUser, status:2}))\r\n      window.location.reload()\r\n    } catch (error) {\r\n      console.log(error)\r\n    }\r\n\r\n  }\r\n\r\n  const handleName = e => {\r\n    setModalName(e.target.value)\r\n  }\r\n\r\n  return (\r\n    <>\r\n     <button type='submit' onClick={() => setModalActive(true)} className={'statusBtn ' + (findStatus(user.status))}>\r\n        {isFetching\r\n          ? <CircularProgress style={{color:'white', size:'20px', width:'20px', height:'20px'}}/>\r\n          : user.status !== 1\r\n            ? 'Начать'\r\n            : 'Закончить'\r\n        }\r\n      </button>\r\n      <Modal active={modalActive} setActive={setModalActive}>\r\n        <h1>Изменение информации:</h1>\r\n        <hr/>\r\n        {error && <div className='modalError'>{error}</div>}\r\n        <form className=\"modalLoginBox\" onSubmit={user.status === 1 ? handlerEnd : handlerStart}>\r\n        <div style={{display:'flex', justifyContent:'space-between', fontSize: '20px', width:'30%', marginLeft:'35%', marginTop: '30px'}}>\r\n            <label htmlFor='sickLeave'>\r\n            <input\r\n              type='radio'\r\n              value={1}\r\n              id='sickLeave'\r\n              name='sickLeave'\r\n              onChange={handleName}\r\n              checked={+modalName === 1}\r\n            />Здоров</label>\r\n            <label htmlFor='vacation'>\r\n            <input\r\n              type='radio'\r\n              value={0}\r\n              id='vacation'\r\n              name='vacation'\r\n              onChange={handleName}\r\n              checked={+modalName === 0}\r\n            />Болен</label>\r\n          </div>\r\n          <input\r\n            placeholder=\"Комментарий\"\r\n            className=\"ModalInput\"\r\n            ref={modalComment}\r\n          />\r\n          <button className=\"ModalButton\" type=\"submit\" disabled={isFetching}>\r\n            ок\r\n          </button>\r\n        </form>\r\n      </Modal>\r\n    </>\r\n  )\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}