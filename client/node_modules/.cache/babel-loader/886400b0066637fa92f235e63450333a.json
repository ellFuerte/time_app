{"ast":null,"code":"import _regeneratorRuntime from\"D:/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import axios from\"axios\";import{useEffect,useRef,useState}from\"react\";import{Link,useHistory}from'react-router-dom';import\"./Register.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Register(){var email=useRef();var password=useRef();var passwordAgain=useRef();var username=useRef();var firstname=useRef();var department=useRef();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),deps=_useState2[0],setDeps=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),checkVal=_useState6[0],setCheckVal=_useState6[1];var changeVal=function changeVal(e){setCheckVal(!checkVal);};var history=useHistory();useEffect(function(){var getDeps=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/departments/');case 2:res=_context.sent;setDeps(res.data);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getDeps(){return _ref.apply(this,arguments);};}();getDeps();},[]);var handleClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var name,user,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();if(!(password.current.value!==passwordAgain.current.value)){_context2.next=5;break;}passwordAgain.current.setCustomValidity('Пароли не совпадают');_context2.next=22;break;case 5:if(!(department.current.value==='')){_context2.next=10;break;}setError('Не все поля заполнены');return _context2.abrupt(\"return\");case 10:name=username.current.value+' '+firstname.current.value;user={user_name:name,email:email.current.value.toUpperCase(),department_id:department.current.value,password:password.current.value,isadmin:checkVal};_context2.next=14;return axios.post('/api/Register/',user);case 14:res=_context2.sent;if(!(res.data.status===\"Username taken\")){_context2.next=19;break;}setError(\"Такой email уже существует\");_context2.next=22;break;case 19:_context2.next=21;return axios.post('/api/Register/',user);case 21:history.push('/login');case 22:case\"end\":return _context2.stop();}}},_callee2);}));return function handleClick(_x){return _ref2.apply(this,arguments);};}();function handleSubmit(e){if(e.target.value===''){setError('Email должен содержать формат домена VTB');}if(e.target.value.length>0){setError('');}}function handleClickSubmit(){setError('');}return/*#__PURE__*/_jsxs(\"div\",{className:\"register\",children:[error&&/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:error}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"registerWrapper\",children:/*#__PURE__*/_jsx(\"div\",{className:\"registerCenter\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"registerBox\",onSubmit:handleClick,children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u0418\\u043C\\u044F\",required:true,ref:username,className:\"registerInput\",onMouseDown:handleClickSubmit}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u0424\\u0430\\u043C\\u0438\\u043B\\u0438\\u044F\",required:true,ref:firstname,className:\"registerInput\",onMouseDown:handleClickSubmit}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Email \\u0432 \\u0444\\u043E\\u0440\\u043C\\u0430\\u0442\\u0435 IvanoIA@vtb.ru\",type:\"email\",required:true,ref:email,className:\"registerInput\",onMouseDown:handleSubmit,onInput:handleSubmit}),/*#__PURE__*/_jsxs(\"select\",{ref:department,className:\"selectDeps\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u043F\\u043E\\u0434\\u0440\\u0430\\u0437\\u0434\\u0435\\u043B\\u0435\\u043D\\u0438\\u0435\"}),deps.map(function(dep,name){return/*#__PURE__*/_jsx(\"option\",{value:dep.id,children:dep.department_name},name);})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u041D\\u0430\\u0447\\u0430\\u043B\\u044C\\u043D\\u0438\\u043A \\u043E\\u0442\\u0434\\u0435\\u043B\\u0430?\",/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"trueAdmin\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:true,name:\"trueAdmin\",checked:checkVal,onChange:changeVal,onMouseDown:handleClickSubmit}),\"\\u0414\\u0430\"]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"falseAdmin\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:false,name:\"falseAdmin\",checked:!checkVal,onChange:changeVal,onMouseDown:handleClickSubmit}),\"\\u041D\\u0435\\u0442\"]})]}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Password\",type:\"password\",required:true,ref:password,className:\"registerInput\",minLength:\"6\",onMouseDown:handleClickSubmit}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Password Again\",type:\"password\",required:true,ref:passwordAgain,className:\"registerInput\",minLength:\"6\",onMouseDown:handleClickSubmit}),/*#__PURE__*/_jsx(\"button\",{className:\"registerButton\",type:\"submit\",children:\"\\u0417\\u0430\\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\\u0441\\u044F\"}),/*#__PURE__*/_jsx(Link,{to:\"/login\",style:{width:'167%'},children:/*#__PURE__*/_jsx(\"button\",{className:\"registerLoginButton\",children:\"\\u0412\\u043E\\u0439\\u0442\\u0438 \\u0432 \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442\"})})]})})})]});}","map":{"version":3,"sources":["D:/time_app/client/src/pages/Register/Register.jsx"],"names":["axios","useEffect","useRef","useState","Link","useHistory","Register","email","password","passwordAgain","username","firstname","department","deps","setDeps","error","setError","checkVal","setCheckVal","changeVal","e","history","getDeps","get","res","data","handleClick","preventDefault","current","value","setCustomValidity","name","user","user_name","toUpperCase","department_id","isadmin","post","status","push","handleSubmit","target","length","handleClickSubmit","map","dep","id","department_name","width"],"mappings":"4SAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,SAAT,CAAoBC,MAApB,CAA4BC,QAA5B,KAA4C,OAA5C,CACA,OAASC,IAAT,CAAeC,UAAf,KAAgC,kBAAhC,CACA,MAAO,gBAAP,C,wFAEA,cAAe,SAASC,CAAAA,QAAT,EAAoB,CACjC,GAAMC,CAAAA,KAAK,CAAGL,MAAM,EAApB,CACA,GAAMM,CAAAA,QAAQ,CAAGN,MAAM,EAAvB,CACA,GAAMO,CAAAA,aAAa,CAAGP,MAAM,EAA5B,CACA,GAAMQ,CAAAA,QAAQ,CAAGR,MAAM,EAAvB,CACA,GAAMS,CAAAA,SAAS,CAAGT,MAAM,EAAxB,CACA,GAAMU,CAAAA,UAAU,CAAGV,MAAM,EAAzB,CACA,cAAwBC,QAAQ,CAAC,EAAD,CAAhC,wCAAOU,IAAP,eAAaC,OAAb,eACA,eAA0BX,QAAQ,CAAC,EAAD,CAAlC,yCAAOY,KAAP,eAAcC,QAAd,eACA,eAAgCb,QAAQ,CAAC,KAAD,CAAxC,yCAAOc,QAAP,eAAiBC,WAAjB,eACA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAACC,CAAD,CAAO,CACvBF,WAAW,CAAC,CAACD,QAAF,CAAX,CACD,CAFD,CAGA,GAAMI,CAAAA,OAAO,CAAGhB,UAAU,EAA1B,CAEAJ,SAAS,CAAC,UAAM,CACd,GAAMqB,CAAAA,OAAO,0FAAG,iKACItB,CAAAA,KAAK,CAACuB,GAAN,CAAU,mBAAV,CADJ,QACRC,GADQ,eAEdV,OAAO,CAACU,GAAG,CAACC,IAAL,CAAP,CAFc,sDAAH,kBAAPH,CAAAA,OAAO,0CAAb,CAKAA,OAAO,GACR,CAPQ,CAON,EAPM,CAAT,CASA,GAAMI,CAAAA,WAAW,2FAAG,kBAAON,CAAP,wIAClBA,CAAC,CAACO,cAAF,GADkB,KAEfnB,QAAQ,CAACoB,OAAT,CAAiBC,KAAjB,GAA2BpB,aAAa,CAACmB,OAAd,CAAsBC,KAFlC,2BAGhBpB,aAAa,CAACmB,OAAd,CAAsBE,iBAAtB,CAAwC,qBAAxC,EAHgB,oCAIRlB,UAAU,CAACgB,OAAX,CAAmBC,KAAnB,GAA6B,EAJrB,4BAKhBb,QAAQ,CAAC,uBAAD,CAAR,CALgB,0CASVe,IATU,CASHrB,QAAQ,CAACkB,OAAT,CAAiBC,KAAjB,CAAwB,GAAxB,CAA6BlB,SAAS,CAACiB,OAAV,CAAkBC,KAT5C,CAWVG,IAXU,CAWH,CACXC,SAAS,CAAEF,IADA,CAEXxB,KAAK,CAAEA,KAAK,CAACqB,OAAN,CAAcC,KAAd,CAAoBK,WAApB,EAFI,CAGXC,aAAa,CAAEvB,UAAU,CAACgB,OAAX,CAAmBC,KAHvB,CAIXrB,QAAQ,CAAEA,QAAQ,CAACoB,OAAT,CAAiBC,KAJhB,CAKXO,OAAO,CAAEnB,QALE,CAXG,yBAmBIjB,CAAAA,KAAK,CAACqC,IAAN,CAAW,gBAAX,CAA6BL,IAA7B,CAnBJ,SAmBRR,GAnBQ,qBAoBVA,GAAG,CAACC,IAAJ,CAASa,MAAT,GAAoB,gBApBV,4BAqBZtB,QAAQ,CAAC,4BAAD,CAAR,CArBY,wDAwBNhB,CAAAA,KAAK,CAACqC,IAAN,CAAW,gBAAX,CAA6BL,IAA7B,CAxBM,SAyBZX,OAAO,CAACkB,IAAR,CAAa,QAAb,EAzBY,yDAAH,kBAAXb,CAAAA,WAAW,6CAAjB,CA+BA,QAASc,CAAAA,YAAT,CAAsBpB,CAAtB,CAAyB,CACvB,GAAIA,CAAC,CAACqB,MAAF,CAASZ,KAAT,GAAmB,EAAvB,CAA2B,CACzBb,QAAQ,CAAC,0CAAD,CAAR,CACD,CACD,GAAII,CAAC,CAACqB,MAAF,CAASZ,KAAT,CAAea,MAAf,CAAwB,CAA5B,CAA+B,CAC7B1B,QAAQ,CAAC,EAAD,CAAR,CACD,CACF,CAED,QAAS2B,CAAAA,iBAAT,EAA6B,CAC/B3B,QAAQ,CAAC,EAAD,CAAR,CACG,CAED,mBACI,aAAK,SAAS,CAAC,UAAf,WACGD,KAAK,eACN,YAAK,SAAS,CAAC,OAAf,UACGA,KADH,EAFF,cAME,aANF,cAOE,YAAK,SAAS,CAAC,iBAAf,uBACE,YAAK,SAAS,CAAC,gBAAf,uBACE,cAAM,SAAS,CAAC,aAAhB,CAA8B,QAAQ,CAAEW,WAAxC,wBACE,cACI,WAAW,CAAC,oBADhB,CAEI,QAAQ,KAFZ,CAEa,GAAG,CAAEhB,QAFlB,CAGI,SAAS,CAAC,eAHd,CAII,WAAW,CAAEiC,iBAJjB,EADF,cAOE,cACI,WAAW,CAAC,4CADhB,CAEI,QAAQ,KAFZ,CAEa,GAAG,CAAEhC,SAFlB,CAGI,SAAS,CAAC,eAHd,CAII,WAAW,CAAEgC,iBAJjB,EAPF,cAaE,cACI,WAAW,CAAC,wEADhB,CAEI,IAAI,CAAC,OAFT,CAGI,QAAQ,KAHZ,CAGa,GAAG,CAAEpC,KAHlB,CAII,SAAS,CAAC,eAJd,CAKI,WAAW,CAAEiC,YALjB,CAMI,OAAO,CAAEA,YANb,EAbF,cAqBA,gBAAQ,GAAG,CAAE5B,UAAb,CAAyB,SAAS,CAAC,YAAnC,wBACE,eAAQ,KAAK,CAAC,EAAd,6IADF,CAEGC,IAAI,CAAC+B,GAAL,CAAS,SAACC,GAAD,CAAMd,IAAN,qBAAe,eAAmB,KAAK,CAAEc,GAAG,CAACC,EAA9B,UAAmCD,GAAG,CAACE,eAAvC,EAAahB,IAAb,CAAf,EAAT,CAFH,GArBA,cAyBA,mIAEE,eAAO,OAAO,CAAC,WAAf,wBACA,cACE,IAAI,CAAC,OADP,CAEE,KAAK,CAAE,IAFT,CAGE,IAAI,CAAC,WAHP,CAIE,OAAO,CAAEd,QAJX,CAKE,QAAQ,CAAEE,SALZ,CAME,WAAW,CAAEwB,iBANf,EADA,kBAFF,cAWE,eAAO,OAAO,CAAC,YAAf,wBACA,cACE,IAAI,CAAC,OADP,CAEE,KAAK,CAAE,KAFT,CAGE,IAAI,CAAC,YAHP,CAIE,OAAO,CAAE,CAAC1B,QAJZ,CAKE,QAAQ,CAAEE,SALZ,CAME,WAAW,CAAEwB,iBANf,EADA,wBAXF,GAzBA,cA8CA,cACE,WAAW,CAAC,UADd,CAEE,IAAI,CAAC,UAFP,CAGE,QAAQ,KAHV,CAGW,GAAG,CAAEnC,QAHhB,CAIE,SAAS,CAAC,eAJZ,CAKE,SAAS,CAAC,GALZ,CAME,WAAW,CAAEmC,iBANf,EA9CA,cAsDA,cACE,WAAW,CAAC,gBADd,CAEE,IAAI,CAAC,UAFP,CAGE,QAAQ,KAHV,CAGW,GAAG,CAAElC,aAHhB,CAIE,SAAS,CAAC,eAJZ,CAKE,SAAS,CAAC,GALZ,CAME,WAAW,CAAEkC,iBANf,EAtDA,cA8DA,eAAQ,SAAS,CAAC,gBAAlB,CAAmC,IAAI,CAAC,QAAxC,0HA9DA,cAgEA,KAAC,IAAD,EAAM,EAAE,CAAC,QAAT,CAAkB,KAAK,CAAE,CAACK,KAAK,CAAC,MAAP,CAAzB,uBAEE,eAAQ,SAAS,CAAC,qBAAlB,8FAFF,EAhEA,GADF,EADF,EAPF,GADJ,CAqFD","sourcesContent":["import axios from \"axios\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { Link, useHistory} from 'react-router-dom'\r\nimport \"./Register.css\";\r\n\r\nexport default function Register() {\r\n  const email = useRef()\r\n  const password = useRef()\r\n  const passwordAgain = useRef()\r\n  const username = useRef()\r\n  const firstname = useRef()\r\n  const department = useRef()\r\n  const [deps, setDeps] = useState([])\r\n  const [error, setError] = useState('')\r\n  const [checkVal, setCheckVal] = useState(false)\r\n  const changeVal = (e) => {\r\n    setCheckVal(!checkVal)\r\n  }\r\n  const history = useHistory()\r\n\r\n  useEffect(() => {\r\n    const getDeps = async () => {\r\n      const res = await axios.get('/api/departments/')\r\n      setDeps(res.data)\r\n    }\r\n\r\n    getDeps()\r\n  }, [])\r\n\r\n  const handleClick = async (e) => {\r\n    e.preventDefault()\r\n    if(password.current.value !== passwordAgain.current.value){\r\n      passwordAgain.current.setCustomValidity('Пароли не совпадают')\r\n    } else if(department.current.value === ''){\r\n      setError('Не все поля заполнены')\r\n      return\r\n    } else {\r\n\r\n      const name = username.current.value +' '+ firstname.current.value\r\n\r\n      const user = {\r\n        user_name: name,\r\n        email: email.current.value.toUpperCase(),\r\n        department_id: department.current.value,\r\n        password: password.current.value,\r\n        isadmin: checkVal\r\n      }\r\n\r\n        const res = await axios.post('/api/Register/', user)\r\n        if (res.data.status === \"Username taken\"){\r\n          setError(\"Такой email уже существует\")\r\n\r\n        }else{\r\n          await axios.post('/api/Register/', user)\r\n          history.push('/login')\r\n        }\r\n\r\n    }\r\n  }\r\n\r\n  function handleSubmit(e) {\r\n    if (e.target.value === '') {\r\n      setError('Email должен содержать формат домена VTB')\r\n    }\r\n    if (e.target.value.length > 0) {\r\n      setError('')\r\n    }\r\n  }\r\n\r\n  function handleClickSubmit() {\r\nsetError('')\r\n  }\r\n\r\n  return (\r\n      <div className=\"register\">\r\n        {error &&\r\n        <div className='error'>\r\n          {error}\r\n        </div>\r\n        }\r\n        <br/>\r\n        <div className=\"registerWrapper\">\r\n          <div className=\"registerCenter\">\r\n            <form className=\"registerBox\" onSubmit={handleClick}>\r\n              <input\r\n                  placeholder=\"Имя\"\r\n                  required ref={username}\r\n                  className=\"registerInput\"\r\n                  onMouseDown={handleClickSubmit}\r\n              />\r\n              <input\r\n                  placeholder=\"Фамилия\"\r\n                  required ref={firstname}\r\n                  className=\"registerInput\"\r\n                  onMouseDown={handleClickSubmit}\r\n              />\r\n              <input\r\n                  placeholder=\"Email в формате IvanoIA@vtb.ru\"\r\n                  type='email'\r\n                  required ref={email}\r\n                  className=\"registerInput\"\r\n                  onMouseDown={handleSubmit}\r\n                  onInput={handleSubmit}\r\n              />\r\n            <select ref={department} className='selectDeps'>\r\n              <option value=''>Выберите подразделение</option>\r\n              {deps.map((dep, name) => <option key={name} value={dep.id}>{dep.department_name}</option>)}\r\n            </select>\r\n            <div>\r\n              Начальник отдела?\r\n              <label htmlFor='trueAdmin'>\r\n              <input\r\n                type='radio'\r\n                value={true}\r\n                name='trueAdmin'\r\n                checked={checkVal}\r\n                onChange={changeVal}\r\n                onMouseDown={handleClickSubmit}\r\n              />Да</label>\r\n              <label htmlFor='falseAdmin'>\r\n              <input\r\n                type='radio'\r\n                value={false}\r\n                name='falseAdmin'\r\n                checked={!checkVal}\r\n                onChange={changeVal}\r\n                onMouseDown={handleClickSubmit}\r\n              />Нет</label>\r\n            </div>\r\n            <input\r\n              placeholder=\"Password\"\r\n              type='password'\r\n              required ref={password}\r\n              className=\"registerInput\"\r\n              minLength='6'\r\n              onMouseDown={handleClickSubmit}\r\n            />\r\n            <input\r\n              placeholder=\"Password Again\"\r\n              type='password'\r\n              required ref={passwordAgain}\r\n              className=\"registerInput\"\r\n              minLength='6'\r\n              onMouseDown={handleClickSubmit}\r\n            />\r\n            <button className=\"registerButton\" type='submit'>Зарегистрироваться</button>\r\n\r\n            <Link to='/login' style={{width:'167%'}}>\r\n\r\n              <button className=\"registerLoginButton\">\r\n                Войти в аккаунт\r\n              </button>\r\n            </Link>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"]},"metadata":{},"sourceType":"module"}