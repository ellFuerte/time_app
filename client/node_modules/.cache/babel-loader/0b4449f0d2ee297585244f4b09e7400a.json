{"ast":null,"code":"import _regeneratorRuntime from\"D:/time_app/client/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import Modal from\"../../Templates/Modal/Modal\";import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function AddNomination(_ref){var modalVote=_ref.modalVote,setModalVote=_ref.setModalVote,username=_ref.username,updateNominationStatus=_ref.updateNominationStatus;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),checkedItems=_useState2[0],setCheckedItems=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),check=_useState4[0],setCheck=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),er=_useState6[0],setErr=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),user=_useState8[0],setUser=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),vote=_useState10[0],setVote=_useState10[1];useEffect(function(){var fetchVote=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var rez,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/vote/');case 2:rez=_context.sent;_context.next=5;return axios.get('/api/user/'+username.username);case 5:res=_context.sent;setUser(res.data);setVote(rez.data);// Инициализация состояния чекбоксов на основе текущего статуса номинации пользователя\nsetCheckedItems(function(prevCheckedItems){return _objectSpread(_objectSpread({},prevCheckedItems),{},_defineProperty({},user.nomination_status,true));});case 9:case\"end\":return _context.stop();}}},_callee);}));return function fetchVote(){return _ref2.apply(this,arguments);};}();fetchVote();},[]);var secureButton=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res,addNomination;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get('/api/user/'+username.username);case 2:res=_context2.sent;addNomination={userId:username.username,id_nomination:check};if(!(check===undefined)){_context2.next=8;break;}setErr('Выберите номинацию');_context2.next=12;break;case 8:_context2.next=10;return axios.post('/api/vote/',addNomination);case 10:setModalVote(false);window.location.reload();case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function secureButton(){return _ref3.apply(this,arguments);};}();var clearSecureButton=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res,addNomination;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.get('/api/user/'+username.username);case 2:res=_context3.sent;addNomination={userId:username.username,id_nomination:null};_context3.next=6;return axios.post('/api/vote/',addNomination);case 6:setModalVote(false);window.location.reload();case 8:case\"end\":return _context3.stop();}}},_callee3);}));return function clearSecureButton(){return _ref4.apply(this,arguments);};}();var inputClick=function inputClick(event,voteId){var _event$target=event.target,id=_event$target.id,checked=_event$target.checked;if(checked){setCheckedItems(checked);}else{setCheckedItems(null);}setCheck(event.target.value);setCheckedItems(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},id,checked));});updateNominationStatus(id);setUser(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{nomination_status:checked?voteId:null});});};return/*#__PURE__*/_jsxs(Modal,{active:modalVote,setActive:setModalVote,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0417\\u0430\\u043A\\u0440\\u0435\\u043F\\u0438\\u0442\\u044C \\u043D\\u043E\\u043C\\u0438\\u043D\\u0430\\u0446\\u0438\\u044E:\"}),er&&/*#__PURE__*/_jsx(\"div\",{className:\"modalError\",children:er}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"voteContainer\",children:vote.map(function(vote,id){return/*#__PURE__*/_jsx(\"div\",{className:\"voteItem\",children:/*#__PURE__*/_jsxs(\"label\",{htmlFor:vote.id,className:\"inputVote\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:vote.id,value:vote.id,onChange:function onChange(e){return inputClick(e,vote.id);},checked:user.nomination_status===vote.id}),vote.nominations_name,' ',/*#__PURE__*/_jsx(\"img\",{src:\"../images/\".concat(vote.id,\".png\"),alt:\"Image for \".concat(vote.nominations_name),className:\"images\"})]},id)},id);})})}),/*#__PURE__*/_jsx(\"button\",{className:\"button\",type:\"submit\",onClick:secureButton,children:\"\\u0417\\u0430\\u043A\\u0440\\u0435\\u043F\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"button\",{className:\"button\",type:\"submit\",onClick:clearSecureButton,children:\"\\u0421\\u043D\\u044F\\u0442\\u044C \\u043D\\u043E\\u043C\\u0438\\u043D\\u0430\\u0446\\u0438\\u044E\"})]});}export default AddNomination;","map":{"version":3,"sources":["D:/time_app/client/src/components/ProfileInfo/AddNomination/AddNomination.jsx"],"names":["React","useEffect","useState","Modal","axios","AddNomination","modalVote","setModalVote","username","updateNominationStatus","checkedItems","setCheckedItems","check","setCheck","er","setErr","user","setUser","vote","setVote","fetchVote","get","rez","res","data","prevCheckedItems","nomination_status","secureButton","addNomination","userId","id_nomination","undefined","post","window","location","reload","clearSecureButton","inputClick","event","voteId","target","id","checked","value","prevState","map","e","nominations_name"],"mappings":"ufAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,KAAP,KAAkB,6BAAlB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,C,wFAGA,QAASC,CAAAA,aAAT,MAAiF,IAAzDC,CAAAA,SAAyD,MAAzDA,SAAyD,CAA/CC,YAA+C,MAA/CA,YAA+C,CAAlCC,QAAkC,MAAlCA,QAAkC,CAAzBC,sBAAyB,MAAzBA,sBAAyB,CAE7E,cAAwCP,QAAQ,CAAC,EAAD,CAAhD,wCAAOQ,YAAP,eAAqBC,eAArB,eACA,eAA0BT,QAAQ,EAAlC,yCAAOU,KAAP,eAAcC,QAAd,eACA,eAAqBX,QAAQ,CAAC,EAAD,CAA7B,yCAAOY,EAAP,eAAWC,MAAX,eACA,eAAwBb,QAAQ,CAAC,EAAD,CAAhC,yCAAOc,IAAP,eAAaC,OAAb,eACA,eAAwBf,QAAQ,CAAC,EAAD,CAAhC,0CAAOgB,IAAP,gBAAaC,OAAb,gBAGAlB,SAAS,CAAC,UAAM,CACZ,GAAMmB,CAAAA,SAAS,2FAAG,qKACIhB,CAAAA,KAAK,CAACiB,GAAN,CAAU,YAAV,CADJ,QACRC,GADQ,qCAEIlB,CAAAA,KAAK,CAACiB,GAAN,CAAU,aAAeb,QAAQ,CAACA,QAAlC,CAFJ,QAERe,GAFQ,eAGdN,OAAO,CAACM,GAAG,CAACC,IAAL,CAAP,CACAL,OAAO,CAACG,GAAG,CAACE,IAAL,CAAP,CAEI;AACAb,eAAe,CAAC,SAACc,gBAAD,wCACTA,gBADS,wBAEXT,IAAI,CAACU,iBAFM,CAEc,IAFd,IAAD,CAAf,CAPU,sDAAH,kBAATN,CAAAA,SAAS,2CAAf,CAcAA,SAAS,GAEZ,CAjBQ,CAiBN,EAjBM,CAAT,CAsBA,GAAMO,CAAAA,YAAY,2FAAG,qLAECvB,CAAAA,KAAK,CAACiB,GAAN,CAAU,aAAeb,QAAQ,CAACA,QAAlC,CAFD,QAEXe,GAFW,gBAIXK,aAJW,CAIK,CAClBC,MAAM,CAAErB,QAAQ,CAACA,QADC,CAElBsB,aAAa,CAAElB,KAFG,CAJL,MASbA,KAAK,GAAKmB,SATG,2BAUbhB,MAAM,CAAC,oBAAD,CAAN,CAVa,uDAYPX,CAAAA,KAAK,CAAC4B,IAAN,CAAW,YAAX,CAAyBJ,aAAzB,CAZO,SAabrB,YAAY,CAAC,KAAD,CAAZ,CACA0B,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GAda,yDAAH,kBAAZR,CAAAA,YAAY,2CAAlB,CAmBA,GAAMS,CAAAA,iBAAiB,2FAAG,qLACJhC,CAAAA,KAAK,CAACiB,GAAN,CAAU,aAAeb,QAAQ,CAACA,QAAlC,CADI,QAChBe,GADgB,gBAEhBK,aAFgB,CAEA,CAClBC,MAAM,CAAErB,QAAQ,CAACA,QADC,CAElBsB,aAAa,CAAE,IAFG,CAFA,wBAOhB1B,CAAAA,KAAK,CAAC4B,IAAN,CAAW,YAAX,CAAyBJ,aAAzB,CAPgB,QAQtBrB,YAAY,CAAC,KAAD,CAAZ,CACA0B,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GATsB,wDAAH,kBAAjBC,CAAAA,iBAAiB,2CAAvB,CAeA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACC,KAAD,CAAQC,MAAR,CAAmB,CAClC,kBAAsBD,KAAK,CAACE,MAA5B,CAAOC,EAAP,eAAOA,EAAP,CAAWC,OAAX,eAAWA,OAAX,CACA,GAAIA,OAAJ,CAAa,CACT/B,eAAe,CAAC+B,OAAD,CAAf,CACH,CAFD,IAEO,CACH/B,eAAe,CAAC,IAAD,CAAf,CACH,CACDE,QAAQ,CAACyB,KAAK,CAACE,MAAN,CAAaG,KAAd,CAAR,CAEAhC,eAAe,CAAC,SAAAiC,SAAS,wCAClBA,SADkB,wBAEpBH,EAFoB,CAEfC,OAFe,IAAV,CAAf,CAIAjC,sBAAsB,CAACgC,EAAD,CAAtB,CACAxB,OAAO,CAAC,SAAA2B,SAAS,wCACNA,SADM,MAETlB,iBAAiB,CAAEgB,OAAO,CAAGH,MAAH,CAAY,IAF7B,IAAV,CAAP,CAKH,CAnBD,CAsBA,mBAEI,MAAC,KAAD,EAAO,MAAM,CAAEjC,SAAf,CAA0B,SAAS,CAAEC,YAArC,wBACI,sIADJ,CAEKO,EAAE,eAAI,YAAK,SAAS,CAAC,YAAf,UAA6BA,EAA7B,EAFX,cAGI,aAHJ,cAII,kCACI,YAAK,SAAS,CAAC,eAAf,UACKI,IAAI,CAAC2B,GAAL,CAAS,SAAC3B,IAAD,CAAOuB,EAAP,qBACN,YAAc,SAAS,CAAC,UAAxB,uBACI,eAAgB,OAAO,CAAEvB,IAAI,CAACuB,EAA9B,CAAkC,SAAS,CAAC,WAA5C,wBAEI,cACI,IAAI,CAAC,UADT,CAEI,EAAE,CAAEvB,IAAI,CAACuB,EAFb,CAGI,KAAK,CAAEvB,IAAI,CAACuB,EAHhB,CAII,QAAQ,CAAE,kBAACK,CAAD,QAAOT,CAAAA,UAAU,CAACS,CAAD,CAAI5B,IAAI,CAACuB,EAAT,CAAjB,EAJd,CAKI,OAAO,CAAEzB,IAAI,CAACU,iBAAL,GAA2BR,IAAI,CAACuB,EAL7C,EAFJ,CAUKvB,IAAI,CAAC6B,gBAVV,CAU4B,GAV5B,cAYI,YAAK,GAAG,qBAAe7B,IAAI,CAACuB,EAApB,QAAR,CAAsC,GAAG,qBAAevB,IAAI,CAAC6B,gBAApB,CAAzC,CAAiF,SAAS,CAAC,QAA3F,EAZJ,GAAYN,EAAZ,CADJ,EAAUA,EAAV,CADM,EAAT,CADL,EADJ,EAJJ,cA2BI,eAAQ,SAAS,CAAC,QAAlB,CAA2B,IAAI,CAAC,QAAhC,CAA0C,OAAO,CAAEd,YAAnD,oEA3BJ,cA4BI,eAAQ,SAAS,CAAC,QAAlB,CAA2B,IAAI,CAAC,QAAhC,CAA0C,OAAO,CAAES,iBAAnD,mGA5BJ,GAFJ,CAkCH,CAED,cAAe/B,CAAAA,aAAf","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport Modal from \"../../Templates/Modal/Modal\";\r\nimport axios from \"axios\";\r\n\r\n\r\nfunction AddNomination({modalVote,setModalVote,username,updateNominationStatus}) {\r\n\r\n    const [checkedItems, setCheckedItems] = useState({});\r\n    const [check, setCheck] = useState();\r\n    const [er, setErr] = useState('')\r\n    const [user, setUser] = useState([])\r\n    const [vote, setVote] = useState([])\r\n\r\n\r\n    useEffect(() => {\r\n        const fetchVote = async () => {\r\n            const rez = await axios.get('/api/vote/')\r\n            const res = await axios.get('/api/user/' + username.username)\r\n            setUser(res.data)\r\n            setVote(rez.data)\r\n\r\n                // Инициализация состояния чекбоксов на основе текущего статуса номинации пользователя\r\n                setCheckedItems((prevCheckedItems) => ({\r\n                    ...prevCheckedItems,\r\n                    [user.nomination_status]: true\r\n                }));\r\n\r\n        }\r\n\r\n        fetchVote()\r\n\r\n    }, [])\r\n\r\n\r\n\r\n\r\n    const secureButton = async () => {\r\n\r\n        const res = await axios.get('/api/user/' + username.username)\r\n\r\n        const addNomination = {\r\n            userId: username.username,\r\n            id_nomination: check\r\n        }\r\n\r\n        if (check === undefined) {\r\n            setErr('Выберите номинацию')\r\n        } else {\r\n            await axios.post('/api/vote/', addNomination)\r\n            setModalVote(false)\r\n            window.location.reload()\r\n        }\r\n    }\r\n\r\n\r\n    const clearSecureButton = async () => {\r\n        const res = await axios.get('/api/user/' + username.username)\r\n        const addNomination = {\r\n            userId: username.username,\r\n            id_nomination: null\r\n        }\r\n\r\n        await axios.post('/api/vote/', addNomination)\r\n        setModalVote(false)\r\n        window.location.reload()\r\n\r\n    }\r\n\r\n\r\n\r\n    const inputClick = (event, voteId) => {\r\n        const {id, checked} = event.target\r\n        if (checked) {\r\n            setCheckedItems(checked)\r\n        } else {\r\n            setCheckedItems(null)\r\n        }\r\n        setCheck(event.target.value)\r\n\r\n        setCheckedItems(prevState => ({\r\n            ...prevState,\r\n            [id]: checked,\r\n        }))\r\n        updateNominationStatus(id)\r\n        setUser(prevState => ({\r\n                ...prevState,\r\n                nomination_status: checked ? voteId : null\r\n            }\r\n        ))\r\n    }\r\n\r\n\r\n    return (\r\n\r\n        <Modal active={modalVote} setActive={setModalVote}>\r\n            <h1>Закрепить номинацию:</h1>\r\n            {er && <div className='modalError'>{er}</div>}\r\n            <hr/>\r\n            <div>\r\n                <div className='voteContainer'>\r\n                    {vote.map((vote, id) => (\r\n                        <div key={id} className=\"voteItem\">\r\n                            <label key={id} htmlFor={vote.id} className=\"inputVote\">\r\n\r\n                                <input\r\n                                    type='checkbox'\r\n                                    id={vote.id}\r\n                                    value={vote.id}\r\n                                    onChange={(e) => inputClick(e, vote.id)}\r\n                                    checked={user.nomination_status === vote.id}\r\n                                />\r\n\r\n                                {vote.nominations_name}{' '}\r\n\r\n                                <img src={`../images/${vote.id}.png`} alt={`Image for ${vote.nominations_name}`} className='images'/>\r\n\r\n                            </label>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n            <button className=\"button\" type=\"submit\"  onClick={secureButton}>Закрепить</button>\r\n            <button className=\"button\" type=\"submit\"  onClick={clearSecureButton}>Снять номинацию</button>\r\n        </Modal>\r\n    );\r\n\r\n}\r\n\r\nexport default AddNomination;"]},"metadata":{},"sourceType":"module"}