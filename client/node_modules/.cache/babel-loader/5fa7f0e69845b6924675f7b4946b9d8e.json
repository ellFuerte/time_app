{"ast":null,"code":"import _objectSpread from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/Download/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useRef,useState}from'react';import axios from'axios';import{CircularProgress}from'@material-ui/core';import Modal from'../Templates/Modal/Modal';import'./Status.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function Status(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),posts=_useState2[0],setPosts=_useState2[1];var user=JSON.parse(localStorage.getItem('user'));var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isFetching=_useState4[0],setIsFetching=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),modalActive=_useState8[0],setModalActive=_useState8[1];var _useState9=useState('Здоров'),_useState10=_slicedToArray(_useState9,2),modalName=_useState10[0],setModalName=_useState10[1];var modalComment=useRef();// получение данных пользователя о работе\nuseEffect(function(){var fetchUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/user'+user._id);case 2:res=_context.sent;setPosts(res.data.sort(function(p1,p2){return new Date(p2.workStart)-new Date(p1.workStart);}));case 4:case\"end\":return _context.stop();}}},_callee);}));return function fetchUser(){return _ref.apply(this,arguments);};}();fetchUser();},[user._id]);// начало работы.\nvar handlerStart=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var newPost;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();if(!(+modalName===0&&modalComment.current.value==='')){_context2.next=4;break;}setError('Заполните комментарий');return _context2.abrupt(\"return\");case 4:setIsFetching(true);newPost={userId:user._id,typework_id:1,status:1,healthStart:+modalName,commentStart:modalComment.current.value||'-',workStart:new Date(Date.now())};_context2.prev=6;_context2.next=9;return axios.post(\"/api/post/\",newPost);case 9:/*await axios.put('/api/user/'+user._id, {status:1, userId: user._id})*/localStorage.setItem('user',JSON.stringify(_objectSpread(_objectSpread({},user),{},{status:1})));window.location.reload();_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2[\"catch\"](6);console.log(_context2.t0);case 16:case\"end\":return _context2.stop();}}},_callee2,null,[[6,13]]);}));return function handlerStart(_x){return _ref2.apply(this,arguments);};}();// конец работы\nvar handlerEnd=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var newPost;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();if(!(+modalName===0&&modalComment.current.value==='')){_context3.next=4;break;}setError('Заполните комментарий');return _context3.abrupt(\"return\");case 4:setIsFetching(true);newPost={userId:user._id,typework_id:1,status:2,healthEnd:+modalName,commentEnd:modalComment.current.value||'-',workEnd:new Date(Date.now())/*workTime: new Date(Date.now()) - new Date(posts[0].workStart)*/};_context3.prev=6;_context3.next=9;return axios.put(\"/api/post/\",newPost);case 9:/*await axios.put('/api/user/'+user._id, {status:2, userId: user._id})*/localStorage.setItem('user',JSON.stringify(_objectSpread(_objectSpread({},user),{},{status:2})));window.location.reload();_context3.next=16;break;case 13:_context3.prev=13;_context3.t0=_context3[\"catch\"](6);console.log(_context3.t0);case 16:case\"end\":return _context3.stop();}}},_callee3,null,[[6,13]]);}));return function handlerEnd(_x2){return _ref3.apply(this,arguments);};}();var handleName=function handleName(e){setModalName(e.target.value);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"statusBtn\",type:\"submit\",onClick:function onClick(){return setModalActive(true);},children:isFetching?/*#__PURE__*/_jsx(CircularProgress,{style:{color:'white',size:'20px',width:'20px',height:'20px'}}):user.status!==1?'Начать':'Закончить'}),/*#__PURE__*/_jsxs(Modal,{active:modalActive,setActive:setModalActive,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"modalError\",children:error}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",onSubmit:user.status===1?handlerEnd:handlerStart,children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',fontSize:'20px',width:'30%',marginLeft:'35%',marginTop:'30px'},children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"sickLeave\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:1,id:\"sickLeave\",name:\"sickLeave\",onChange:handleName,checked:+modalName===1}),\"\\u0417\\u0434\\u043E\\u0440\\u043E\\u0432\"]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"vacation\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:0,id:\"vacation\",name:\"vacation\",onChange:handleName,checked:+modalName===0}),\"\\u0411\\u043E\\u043B\\u0435\\u043D\"]})]}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0439\",className:\"ModalInput\",ref:modalComment}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",disabled:isFetching,children:\"\\u043E\\u043A\"})]})]})]});}","map":{"version":3,"sources":["D:/Download/time_app/client/src/components/Status/Status.jsx"],"names":["useEffect","useRef","useState","axios","CircularProgress","Modal","Status","posts","setPosts","user","JSON","parse","localStorage","getItem","isFetching","setIsFetching","error","setError","modalActive","setModalActive","modalName","setModalName","modalComment","fetchUser","get","_id","res","data","sort","p1","p2","Date","workStart","handlerStart","e","preventDefault","current","value","newPost","userId","typework_id","status","healthStart","commentStart","now","post","setItem","stringify","window","location","reload","console","log","handlerEnd","healthEnd","commentEnd","workEnd","put","handleName","target","color","size","width","height","display","justifyContent","fontSize","marginLeft","marginTop"],"mappings":"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","sourcesContent":["import { useEffect, useRef, useState } from 'react'\r\nimport axios from 'axios'\r\nimport {CircularProgress} from '@material-ui/core'\r\nimport Modal from '../Templates/Modal/Modal'\r\n\r\nimport './Status.css'\r\n\r\nexport default function Status() {\r\n  const [posts, setPosts] = useState([])\r\n  const user = JSON.parse(localStorage.getItem('user'))\r\n  const [isFetching, setIsFetching] = useState(false)\r\n  const [error, setError] = useState('')\r\n\r\n  const [modalActive, setModalActive] = useState(false)\r\n  \r\n  const [modalName, setModalName] = useState('Здоров')\r\n  const modalComment = useRef()\r\n\r\n  // получение данных пользователя о работе\r\n  useEffect(() => {\r\n    const fetchUser = async () => {\r\n      const res = await axios.get('/api/user'+user._id)\r\n      setPosts(res.data.sort((p1, p2) => {\r\n        return new Date(p2.workStart) - new Date(p1.workStart)\r\n      }))\r\n    }\r\n    fetchUser()\r\n  }, [user._id])\r\n\r\n  // начало работы.\r\n  const handlerStart = async (e) => {\r\n    e.preventDefault()\r\n\r\n    if(+modalName === 0 && modalComment.current.value===''){\r\n      setError('Заполните комментарий')\r\n      return\r\n    }\r\n\r\n    setIsFetching(true)\r\n    const newPost = {\r\n      userId: user._id,\r\n      typework_id: 1,\r\n      status: 1,\r\n      healthStart: +modalName,\r\n      commentStart: modalComment.current.value || '-',\r\n      workStart: new Date(Date.now()),\r\n    }\r\n\r\n    try {\r\n      await axios.post(\"/api/post/\", newPost);\r\n      /*await axios.put('/api/user/'+user._id, {status:1, userId: user._id})*/\r\n      localStorage.setItem('user', JSON.stringify({...user, status:1}))\r\n      window.location.reload()\r\n    } catch (error) {\r\n      console.log(error)\r\n    }\r\n  }\r\n\r\n  // конец работы\r\n  const handlerEnd = async (e) => {\r\n    e.preventDefault()\r\n\r\n    if(+modalName === 0 && modalComment.current.value===''){\r\n      setError('Заполните комментарий')\r\n      return\r\n    }\r\n\r\n    setIsFetching(true)\r\n    const newPost = {\r\n      userId: user._id,\r\n      typework_id: 1,\r\n      status: 2,\r\n      healthEnd: +modalName,\r\n      commentEnd: modalComment.current.value  || '-',\r\n      workEnd: new Date(Date.now())\r\n      /*workTime: new Date(Date.now()) - new Date(posts[0].workStart)*/\r\n\r\n    }\r\n\r\n    try {\r\n      await axios.put(\"/api/post/\", newPost);\r\n      /*await axios.put('/api/user/'+user._id, {status:2, userId: user._id})*/\r\n      localStorage.setItem('user', JSON.stringify({...user, status:2}))\r\n      window.location.reload();\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }\r\n\r\n  const handleName = e => {\r\n    setModalName(e.target.value)\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <button className='statusBtn' type='submit' onClick={() => setModalActive(true)}>\r\n        {isFetching \r\n          ? <CircularProgress style={{color:'white', size:'20px', width:'20px', height:'20px'}}/> \r\n          : user.status !== 1\r\n            ? 'Начать'\r\n            : 'Закончить'\r\n        }\r\n      </button>\r\n      <Modal active={modalActive} setActive={setModalActive}>\r\n        <h1>Изменение информации:</h1>\r\n        <hr/>\r\n        {error && <div className='modalError'>{error}</div>}\r\n        <form className=\"modalLoginBox\" onSubmit={user.status === 1 ? handlerEnd : handlerStart}>\r\n        <div style={{display:'flex', justifyContent:'space-between', fontSize: '20px', width:'30%', marginLeft:'35%', marginTop: '30px'}}>\r\n            <label htmlFor='sickLeave'>\r\n            <input\r\n              type='radio'\r\n              value={1}\r\n              id='sickLeave'\r\n              name='sickLeave'\r\n              onChange={handleName}\r\n              checked={+modalName === 1}\r\n            />Здоров</label>\r\n            <label htmlFor='vacation'>\r\n            <input\r\n              type='radio'\r\n              value={0}\r\n              id='vacation'\r\n              name='vacation'\r\n              onChange={handleName}\r\n              checked={+modalName === 0}\r\n            />Болен</label>\r\n          </div>\r\n          <input \r\n            placeholder=\"Комментарий\"\r\n            className=\"ModalInput\"  \r\n            ref={modalComment} \r\n          />\r\n          <button className=\"ModalButton\" type=\"submit\" disabled={isFetching}>\r\n            ок\r\n          </button>\r\n        </form>\r\n      </Modal>\r\n    </>\r\n  )\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}