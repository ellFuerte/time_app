{"ast":null,"code":"import _objectSpread from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/Download/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import axios from'axios';import{useRef}from'react';import{useEffect,useState}from'react';import{format}from'date-fns';/*import { Add } from '@material-ui/icons'*/import InfoPost from'../InfoPost/InfoPost';import Pagination from'../Pagination/Pagination';import VacationPost from'../VacationPost/VacationPost';import'./HistoryInfo.css';import Modal from'../Templates/Modal/Modal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function HistoryInfo(_ref){var username=_ref.username;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),posts=_useState2[0],setPosts=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isFetching=_useState4[0],setIsFetching=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),currentPage=_useState6[0],setCurrentPage=_useState6[1];var _useState7=useState(30),_useState8=_slicedToArray(_useState7,1),postsPerPage=_useState8[0];var lastPostIndex=currentPage*postsPerPage;var firstPostIndex=lastPostIndex-postsPerPage;var currentlyPosts=posts.slice(firstPostIndex,lastPostIndex);var historyStartWork=useRef(null);var historyEndWork=useRef(null);var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isFilter=_useState10[0],setIsFilter=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),newPosts=_useState12[0],setNewPosts=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),error=_useState14[0],setError=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),modalError=_useState16[0],setModalError=_useState16[1];var localUser=JSON.parse(localStorage.getItem('user'));var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),vacationPosts=_useState18[0],setVacationPosts=_useState18[1];var _useState19=useState(true),_useState20=_slicedToArray(_useState19,2),isJob=_useState20[0],setIsJob=_useState20[1];var _useState21=useState(false),_useState22=_slicedToArray(_useState21,2),modalActive=_useState22[0],setModalActive=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),modalName=_useState24[0],setModalName=_useState24[1];var modalComment=useRef();var vacationStart=useRef();var vacationEnd=useRef();// получение всех постов работы от послелнего к первому\nuseEffect(function(){setIsFetching(true);var fetchUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/post?id='+localUser._id);case 2:res=_context.sent;console.log(res);setPosts(res.data.sort(function(p1,p2){return new Date(p2.workstart)-new Date(p1.workstart);}));setIsFetching(false);case 6:case\"end\":return _context.stop();}}},_callee);}));return function fetchUser(){return _ref2.apply(this,arguments);};}();fetchUser();handleClickCancel();},[username]);var paginate=function paginate(pageNumber){return setCurrentPage(pageNumber);};// фильтер постов по дате\nvar handleClick=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var start,end,filter,fill;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:start=historyStartWork.current.value;end=historyEndWork.current.value;if(start===\"\"||end===\"\"){setError('Введите дату');}else{if(start!==''||end!==''){setError('Выберите дату');}filter={startdate:historyStartWork.current.value,enddate:historyEndWork.current.value,userId:localUser._id};setError('');fill=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res,_res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post('/api/post/filter',filter);case 2:res=_context2.sent;console.log(res);setPosts(res.data.sort(function(p1,p2){return new Date(p2.workstart)-new Date(p1.workstart);}));/*handleClickCancel()*/setError('');if(!(start>end&&end!=='')){_context2.next=12;break;}setError('Конечная дата меньше начальной');_context2.next=10;return axios.get('/api/post?id='+localUser._id);case 10:_res=_context2.sent;setPosts(_res.data.sort(function(p1,p2){return new Date(p2.workstart)-new Date(p1.workstart);}));case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function fill(){return _ref4.apply(this,arguments);};}();fill();}/*      let filterPosts = isJob\r\n      ?  posts.filter(post => post.workdate.split('T')[0] >= start)\r\n      : vacationPosts.filter(post => post.start.split('T')[0] >= start)\r\n    if(end){\r\n      filterPosts = isJob\r\n        ? filterPosts.filter(post => post.workdate.split('T')[0] <= end)\r\n        : filterPosts.filter(post => post.end.split('T')[0] <= end)\r\n    }\r\n    setNewPosts(filterPosts)*/case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function handleClick(){return _ref3.apply(this,arguments);};}();// сброс фильтра\nvar handleClickCancel=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:/*    const res = await axios.get('/api/post?id='+localUser._id)\r\n      console.log(res.data)\r\n      setPosts(res.data.sort((p1, p2) => {\r\n        return new Date(p2.workstart) - new Date(p1.workstart)\r\n      }))*/setError('');setIsFilter(false);historyStartWork.current.value='';historyEndWork.current.value='';case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function handleClickCancel(){return _ref5.apply(this,arguments);};}();// получение всех постов об отпуске/больничном от послелнего к первому\nuseEffect(function(){setIsFetching(true);var fetchUser=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var res;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return axios.get('/api/vacation?id='+localUser._id);case 2:res=_context5.sent;setVacationPosts(res.data.sort(function(p1,p2){return new Date(p2.start)-new Date(p1.start);}));setIsFetching(false);case 5:case\"end\":return _context5.stop();}}},_callee5);}));return function fetchUser(){return _ref6.apply(this,arguments);};}();fetchUser();},[username]);// добавление больничного\nvar handleClickAdd=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(e){var currentDay,vacation,newPost,isTrue;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:e.preventDefault();currentDay=new Date();if(!(vacationStart.current.value===''||vacationEnd.current.value===''||modalName===null||modalComment.current.value==='')){_context6.next=5;break;}setModalError('Вcе поля должны быть заполнены');return _context6.abrupt(\"return\");case 5:if(!(new Date(vacationStart.current.value)>new Date(vacationEnd.current.value)&&vacationEnd.current.value!=='')){_context6.next=8;break;}setModalError('Вторая дата меньше первой');return _context6.abrupt(\"return\");case 8:vacation={userId:username,name:modalName,comment:modalComment.current.value,start:new Date(vacationStart.current.value),end:new Date(vacationEnd.current.value)};newPost={userId:username,healthEnd:1,workEnd:new Date(Date.now()),workTime:new Date(Date.now())-new Date(posts[0].workStart)};isTrue=new Date(vacationStart.current.value)<=currentDay&&currentDay.getDate()<=vacation.end.getDate()+1;_context6.prev=11;_context6.next=14;return axios.post('/api/vacation/',vacation);case 14:if(!isTrue){_context6.next=20;break;}_context6.next=17;return axios.put(\"/api/post/\"+posts[0]._id,newPost);case 17:_context6.next=19;return axios.put('/api/user/'+username,{status:3,userId:username});case 19:if(localUser._id===username){localStorage.setItem('user',JSON.stringify(_objectSpread(_objectSpread({},localUser),{},{status:3})));}case 20:window.location.reload();_context6.next=26;break;case 23:_context6.prev=23;_context6.t0=_context6[\"catch\"](11);console.log(_context6.t0);case 26:case\"end\":return _context6.stop();}}},_callee6,null,[[11,23]]);}));return function handleClickAdd(_x){return _ref7.apply(this,arguments);};}();// переход на страницу с больничным и обратно\nvar handleWorkVacation=function handleWorkVacation(){setIsJob(!isJob);setError('');setIsFilter(false);historyStartWork.current.value='';historyEndWork.current.value='';};var handleName=function handleName(e){setModalName(e.target.value);};return/*#__PURE__*/_jsxs(\"div\",{className:\"historyInfo\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"historyInfoTop\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"historyInfoTitle\",children:\"\\u0418\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"span\",{className:\"workVacation\",onClick:handleWorkVacation,children:isJob?/*#__PURE__*/_jsx(\"button\",{className:\"filterButton\",style:{width:'155px'},children:\"\\u041E\\u0442\\u043F\\u0443\\u0441\\u043A/\\u0411\\u043E\\u043B\\u044C\\u043D\\u0438\\u0447\\u043D\\u044B\\u0439\"}):/*#__PURE__*/_jsx(\"button\",{className:\"filterButton\",children:\"\\u0420\\u0430\\u0431\\u043E\\u0442\\u0430\"})}),!isJob&&(localUser.isAdmin||username===localUser._id)&&/*#__PURE__*/_jsx(\"div\",{className:\"addVacation\",onClick:function onClick(){return setModalActive(true);},children:/*#__PURE__*/_jsx(\"span\",{children:\"+\"})})]}),/*#__PURE__*/_jsx(\"hr\",{}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"errorHistoryInfo\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"historyFilter\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"date\",placeholder:\"\\u041D\\u0430\\u0447\\u0430\\u043B\\u043E \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B\",className:\"ModalInput\",ref:historyStartWork,style:{'marginRight':'10px'}}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",placeholder:\"\\u041A\\u043E\\u043D\\u0435\\u0446 \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B\",className:\"ModalInput\",ref:historyEndWork,style:{'marginRight':'10px'}}),/*#__PURE__*/_jsx(\"button\",{className:\"filterButton\",onClick:handleClick,children:\"\\u043E\\u043A\"}),/*#__PURE__*/_jsx(\"button\",{className:\"filterButton\",onClick:handleClickCancel,children:\"\\u0441\\u0431\\u0440\\u043E\\u0441\\u0438\\u0442\\u044C\"})]}),/*#__PURE__*/_jsx(\"hr\",{}),isJob?/*#__PURE__*/_jsxs(\"div\",{className:\"historyInfoTable\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"historyInfoTableBlock Data\",children:\"\\u0414\\u0430\\u0442\\u0430\"}),/*#__PURE__*/_jsx(\"div\",{className:\"historyInfoTableBlock Start\",children:\"\\u0412\\u0440\\u0435\\u043C\\u044F \\u043D\\u0430\\u0447\\u0430\\u043B\\u0430\"}),/*#__PURE__*/_jsx(\"div\",{className:\"historyInfoTableBlock End\",children:\"\\u0412\\u0440\\u0435\\u043C\\u044F \\u043E\\u043A\\u043E\\u043D\\u0447\\u0430\\u043D\\u0438\\u044F\"}),/*#__PURE__*/_jsx(\"div\",{className:\"historyInfoTableBlock Time\",children:\"\\u0414\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"div\",{className:\"historyInfoTableBlock Health\",children:\"\\u0421\\u043E\\u0441\\u0442\\u043E\\u044F\\u043D\\u0438\\u0435 \\u0437\\u0434\\u043E\\u0440\\u043E\\u0432\\u044C\\u044F\"}),/*#__PURE__*/_jsx(\"div\",{className:\"historyInfoTableBlock Health\",children:\"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0439\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"historyInfoTable\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"historyInfoTableBlock Data\",children:\"\\u041D\\u0430\\u0447\\u0430\\u043B\\u043E\"}),/*#__PURE__*/_jsx(\"div\",{className:\"historyInfoTableBlock Start\",children:\"\\u041A\\u043E\\u043D\\u0435\\u0446\"}),/*#__PURE__*/_jsx(\"div\",{className:\"historyInfoTableBlock Start\",children:\"\\u0414\\u043B\\u0438\\u0442\\u0435\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"div\",{className:\"historyInfoTableBlock End\",children:\"\\u041F\\u0440\\u0438\\u0447\\u0438\\u043D\\u0430\"}),/*#__PURE__*/_jsx(\"div\",{className:\"historyInfoTableBlock Time\",children:\"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0439\"})]}),isJob?isFetching?/*#__PURE__*/_jsx(\"div\",{className:\"isFatching\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"}):isFilter?newPosts.map(function(post,id){return/*#__PURE__*/_jsx(InfoPost,{post:post,username:username},id);}):currentlyPosts.map(function(post,id){return/*#__PURE__*/_jsx(InfoPost,{post:post,username:username},id);}):isFetching?/*#__PURE__*/_jsx(\"div\",{className:\"isFatching\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"}):isFilter?newPosts.map(function(post,id){return/*#__PURE__*/_jsx(VacationPost,{post:post,username:username},id);}):vacationPosts.map(function(post,id){return/*#__PURE__*/_jsx(VacationPost,{post:post},id);}),/*#__PURE__*/_jsx(Pagination,{postsPerPage:postsPerPage,totalPosts:posts.length,paginate:paginate,currentPage:currentPage}),/*#__PURE__*/_jsxs(Modal,{active:modalActive,setActive:setModalActive,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),modalError&&/*#__PURE__*/_jsx(\"div\",{className:\"errorHistoryInfo\",children:modalError}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",onSubmit:handleClickAdd,children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',fontSize:'20px',width:'60%',marginLeft:'20%'},children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"sickLeave\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:'Больничный',id:\"sickLeave\",name:\"sickLeave\",onChange:handleName,checked:modalName==='Больничный'}),\"\\u0411\\u043E\\u043B\\u044C\\u043D\\u0438\\u0447\\u043D\\u044B\\u0439\"]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"vacation\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:'Отпуск',id:\"vacation\",name:\"vacation\",onChange:handleName,checked:modalName==='Отпуск'}),\"\\u041E\\u0442\\u043F\\u0443\\u0441\\u043A\"]}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"anotherReason\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:'Другая причина',id:\"anotherReason\",name:\"anotherReason\",onChange:handleName,checked:modalName==='Другая причина'}),\"\\u0414\\u0440\\u0443\\u0433\\u0430\\u044F \\u043F\\u0440\\u0438\\u0447\\u0438\\u043D\\u0430\"]})]}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"\\u041A\\u043E\\u043C\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0438\\u0439\",className:\"ModalInput\",ref:modalComment}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",placeholder:\"\\u041D\\u0430\\u0447\\u0430\\u043B\\u043E \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B\",className:\"ModalInput\",ref:vacationStart,style:{'marginRight':'10px'}}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",placeholder:\"\\u041A\\u043E\\u043D\\u0435\\u0446 \\u0440\\u0430\\u0431\\u043E\\u0442\\u044B\",className:\"ModalInput\",ref:vacationEnd,style:{'marginRight':'10px'}}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",disabled:isFetching,children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"})]})]})]});}","map":{"version":3,"sources":["D:/Download/time_app/client/src/components/HistoryInfo/HistoryInfo.jsx"],"names":["axios","useRef","useEffect","useState","format","InfoPost","Pagination","VacationPost","Modal","HistoryInfo","username","posts","setPosts","isFetching","setIsFetching","currentPage","setCurrentPage","postsPerPage","lastPostIndex","firstPostIndex","currentlyPosts","slice","historyStartWork","historyEndWork","isFilter","setIsFilter","newPosts","setNewPosts","error","setError","modalError","setModalError","localUser","JSON","parse","localStorage","getItem","vacationPosts","setVacationPosts","isJob","setIsJob","modalActive","setModalActive","modalName","setModalName","modalComment","vacationStart","vacationEnd","fetchUser","get","_id","res","console","log","data","sort","p1","p2","Date","workstart","handleClickCancel","paginate","pageNumber","handleClick","start","current","value","end","filter","startdate","enddate","userId","fill","post","handleClickAdd","e","preventDefault","currentDay","vacation","name","comment","newPost","healthEnd","workEnd","now","workTime","workStart","isTrue","getDate","put","status","setItem","stringify","window","location","reload","handleWorkVacation","handleName","target","width","isAdmin","map","id","length","display","justifyContent","fontSize","marginLeft"],"mappings":"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","sourcesContent":["import axios from 'axios'\r\nimport { useRef } from 'react'\r\nimport { useEffect, useState } from 'react'\r\nimport { format } from 'date-fns'\r\n/*import { Add } from '@material-ui/icons'*/\r\n\r\nimport InfoPost from '../InfoPost/InfoPost'\r\nimport Pagination from '../Pagination/Pagination'\r\nimport VacationPost from '../VacationPost/VacationPost'\r\nimport './HistoryInfo.css'\r\nimport Modal from '../Templates/Modal/Modal'\r\n\r\nexport default function HistoryInfo({username}) {\r\n  const [posts, setPosts] = useState([])\r\n  const [isFetching, setIsFetching] = useState(false)\r\n  const [currentPage, setCurrentPage] = useState(1)\r\n  const [postsPerPage] = useState(30)\r\n\r\n  const lastPostIndex = currentPage * postsPerPage\r\n  const firstPostIndex = lastPostIndex - postsPerPage\r\n  const currentlyPosts = posts.slice(firstPostIndex, lastPostIndex)\r\n\r\n  const historyStartWork = useRef(null)\r\n  const historyEndWork = useRef(null)\r\n  const [isFilter, setIsFilter] = useState(false)\r\n  const [newPosts, setNewPosts] = useState([])\r\n  const [error, setError] = useState('')\r\n  const [modalError, setModalError] = useState('')\r\n\r\n  const localUser = JSON.parse(localStorage.getItem('user'))\r\n\r\n  const [vacationPosts, setVacationPosts] = useState([])\r\n  const [isJob, setIsJob] = useState(true)\r\n\r\n  const [modalActive, setModalActive] = useState(false)\r\n  const [modalName, setModalName] = useState(null)\r\n  const modalComment = useRef()\r\n  const vacationStart = useRef()\r\n  const vacationEnd = useRef()\r\n\r\n  // получение всех постов работы от послелнего к первому\r\n\r\n   useEffect(() => {\r\n    setIsFetching(true)\r\n      const fetchUser = async () => {\r\n      const res = await axios.get('/api/post?id='+localUser._id)\r\n      console.log(res)\r\n      setPosts(res.data.sort((p1, p2) => {\r\n       return new Date(p2.workstart) - new Date(p1.workstart)\r\n      }))\r\n      setIsFetching(false)\r\n    }\r\n    fetchUser()\r\n    handleClickCancel()\r\n  }, [username])\r\n\r\n  const paginate = pageNumber => setCurrentPage(pageNumber)\r\n\r\n  // фильтер постов по дате\r\n      const handleClick = async () => {\r\n      const start = historyStartWork.current.value\r\n      const end = historyEndWork.current.value\r\n      if (start === \"\" || end === \"\") {\r\n        setError('Введите дату')\r\n      } else {\r\n        if (start !== '' || end !== '') {\r\n          setError('Выберите дату')\r\n        }\r\n        const filter = {\r\n          startdate: historyStartWork.current.value,\r\n          enddate: historyEndWork.current.value,\r\n          userId: localUser._id\r\n        }\r\n        setError('')\r\n        const fill = async () => {\r\n        const res = await axios.post('/api/post/filter',filter)\r\n        console.log(res)\r\n          setPosts(res.data.sort((p1, p2) => {\r\n            return new Date(p2.workstart) - new Date(p1.workstart)\r\n          }))\r\n        /*handleClickCancel()*/\r\n        setError('')\r\n        if (start > end && end !== '') {\r\n          setError('Конечная дата меньше начальной')\r\n          const res = await axios.get('/api/post?id='+localUser._id)\r\n          setPosts(res.data.sort((p1, p2) => {\r\n            return new Date(p2.workstart) - new Date(p1.workstart)\r\n          }))\r\n        }}\r\n          fill()\r\n      }\r\n\r\n/*      let filterPosts = isJob\r\n      ?  posts.filter(post => post.workdate.split('T')[0] >= start)\r\n      : vacationPosts.filter(post => post.start.split('T')[0] >= start)\r\n    if(end){\r\n      filterPosts = isJob\r\n        ? filterPosts.filter(post => post.workdate.split('T')[0] <= end)\r\n        : filterPosts.filter(post => post.end.split('T')[0] <= end)\r\n    }\r\n    setNewPosts(filterPosts)*/\r\n\r\n  }\r\n\r\n\r\n  // сброс фильтра\r\n  const handleClickCancel = async () =>{\r\n/*    const res = await axios.get('/api/post?id='+localUser._id)\r\n      console.log(res.data)\r\n      setPosts(res.data.sort((p1, p2) => {\r\n        return new Date(p2.workstart) - new Date(p1.workstart)\r\n      }))*/\r\n    setError('')\r\n    setIsFilter(false)\r\n    historyStartWork.current.value = ''\r\n    historyEndWork.current.value = ''\r\n  }\r\n\r\n\r\n  // получение всех постов об отпуске/больничном от послелнего к первому\r\n    useEffect(() => {\r\n    setIsFetching(true)\r\n    const fetchUser = async () => {\r\n      const res = await axios.get('/api/vacation?id='+localUser._id)\r\n      setVacationPosts(res.data.sort((p1, p2) => {\r\n        return new Date(p2.start) - new Date(p1.start)\r\n      }))\r\n      setIsFetching(false)\r\n    }\r\n    fetchUser()\r\n  }, [username])\r\n\r\n  // добавление больничного\r\n  const handleClickAdd = async (e) => {\r\n    e.preventDefault()\r\n\r\n    const currentDay = new Date()\r\n\r\n    if( vacationStart.current.value === '' || vacationEnd.current.value === '' || modalName === null || modalComment.current.value === ''){\r\n      setModalError('Вcе поля должны быть заполнены')\r\n      return\r\n    }\r\n\r\n    if(new Date(vacationStart.current.value) > new Date(vacationEnd.current.value) && vacationEnd.current.value !== ''){\r\n      setModalError('Вторая дата меньше первой')\r\n      return\r\n    }\r\n\r\n    const vacation = {\r\n      userId: username,\r\n      name: modalName,\r\n      comment: modalComment.current.value,\r\n      start: new Date(vacationStart.current.value),\r\n      end: new Date(vacationEnd.current.value)\r\n    }\r\n\r\n    const newPost = {\r\n      userId: username,\r\n      healthEnd: 1,\r\n      workEnd: new Date(Date.now()),\r\n      workTime: new Date(Date.now()) - new Date(posts[0].workStart)\r\n    }\r\n\r\n    const isTrue = new Date(vacationStart.current.value) <= currentDay && currentDay.getDate() <= vacation.end.getDate()+1\r\n\r\n    try {\r\n      await axios.post('/api/vacation/',vacation)\r\n      if (isTrue) {\r\n        await axios.put(\"/api/post/\"+posts[0]._id, newPost)\r\n        await axios.put('/api/user/'+username, {status:3, userId: username})\r\n        if (localUser._id === username) {\r\n          localStorage.setItem('user', JSON.stringify({...localUser, status:3}))\r\n        }\r\n      }\r\n      window.location.reload()\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }\r\n\r\n  // переход на страницу с больничным и обратно\r\n  const handleWorkVacation = () => {\r\n    setIsJob(!isJob)\r\n    setError('')\r\n    setIsFilter(false)\r\n    historyStartWork.current.value = ''\r\n    historyEndWork.current.value = ''\r\n  }\r\n\r\n  const handleName = e => {\r\n    setModalName(e.target.value)\r\n  }\r\n\r\n  return (\r\n    <div className='historyInfo'>\r\n      <div className='historyInfoTop'>\r\n        <span className='historyInfoTitle'>История</span>\r\n        <span className='workVacation' onClick={handleWorkVacation}>{isJob\r\n          ? <button className=\"filterButton\" style={{width:'155px'}}>Отпуск/Больничный</button>\r\n          : <button className=\"filterButton\">Работа</button> }</span>\r\n        {!isJob && (localUser.isAdmin || username === localUser._id) && <div className='addVacation' onClick={() => setModalActive(true)}><span>+</span></div>}\r\n      </div>\r\n      <hr/>\r\n      {error && <div className='errorHistoryInfo'>{error}</div>}\r\n      <div className='historyFilter'>\r\n        <input\r\n          type='date'\r\n          placeholder=\"Начало работы\"\r\n          className=\"ModalInput\"\r\n          ref={historyStartWork}\r\n          style={{'marginRight': '10px'}}\r\n        />\r\n        <input\r\n          type='date'\r\n          placeholder=\"Конец работы\"\r\n          className=\"ModalInput\"\r\n          ref={historyEndWork}\r\n          style={{'marginRight': '10px'}}\r\n        />\r\n        <button className=\"filterButton\" onClick={handleClick}>ок</button>\r\n        <button className=\"filterButton\" onClick={handleClickCancel}>сбросить</button>\r\n      </div>\r\n      <hr/>\r\n      {isJob\r\n        ?  <div className='historyInfoTable'>\r\n            <div className='historyInfoTableBlock Data'>\r\n              Дата\r\n            </div>\r\n            <div className='historyInfoTableBlock Start'>\r\n              Время начала\r\n            </div>\r\n            <div className='historyInfoTableBlock End'>\r\n              Время окончания\r\n            </div>\r\n            <div className='historyInfoTableBlock Time'>\r\n              Длительность\r\n            </div>\r\n            <div className='historyInfoTableBlock Health'>\r\n              Состояние здоровья\r\n            </div>\r\n            <div className='historyInfoTableBlock Health'>\r\n              Комментарий\r\n            </div>\r\n          </div>\r\n        :  <div className='historyInfoTable'>\r\n            <div className='historyInfoTableBlock Data'>\r\n              Начало\r\n            </div >\r\n            <div className='historyInfoTableBlock Start'>\r\n              Конец\r\n            </div>\r\n            <div className='historyInfoTableBlock Start'>\r\n              Длительность\r\n            </div>\r\n            <div className='historyInfoTableBlock End'>\r\n              Причина\r\n            </div>\r\n            <div className='historyInfoTableBlock Time'>\r\n              Комментарий\r\n            </div>\r\n          </div>\r\n      }\r\n\r\n      {isJob\r\n        ? isFetching\r\n          ? <div className='isFatching'>Загрузка...</div>\r\n          : isFilter\r\n            ? newPosts.map((post, id) => <InfoPost key={id} post={post} username={username}/>)\r\n            : currentlyPosts.map((post, id) => <InfoPost key={id} post={post} username={username}/>)\r\n        : isFetching\r\n          ? <div className='isFatching'>Загрузка...</div>\r\n          : isFilter\r\n            ? newPosts.map((post, id) => <VacationPost key={id} post={post} username={username}/>)\r\n            : vacationPosts.map((post, id) => <VacationPost key={id} post={post}/>)\r\n      }\r\n\r\n      <Pagination postsPerPage={postsPerPage} totalPosts={posts.length} paginate={paginate} currentPage={currentPage}/>\r\n\r\n      <Modal active={modalActive} setActive={setModalActive}>\r\n        <h1>Изменение информации:</h1>\r\n        <hr/>\r\n        {modalError && <div className='errorHistoryInfo'>{modalError}</div>}\r\n        <form className=\"modalLoginBox\" onSubmit={handleClickAdd}>\r\n          <div style={{display:'flex', justifyContent:'space-between', fontSize: '20px', width:'60%', marginLeft:'20%'}}>\r\n            <label htmlFor='sickLeave'>\r\n            <input\r\n              type='radio'\r\n              value={'Больничный'}\r\n              id='sickLeave'\r\n              name='sickLeave'\r\n              onChange={handleName}\r\n              checked={modalName === 'Больничный'}\r\n            />Больничный</label>\r\n            <label htmlFor='vacation'>\r\n            <input\r\n              type='radio'\r\n              value={'Отпуск'}\r\n              id='vacation'\r\n              name='vacation'\r\n              onChange={handleName}\r\n              checked={modalName === 'Отпуск'}\r\n            />Отпуск</label>\r\n            <label htmlFor='anotherReason'>\r\n            <input\r\n              type='radio'\r\n              value={'Другая причина'}\r\n              id='anotherReason'\r\n              name='anotherReason'\r\n              onChange={handleName}\r\n              checked={modalName === 'Другая причина'}\r\n            />Другая причина</label>\r\n          </div>\r\n          <input\r\n            placeholder=\"Комментарий\"\r\n            className=\"ModalInput\"\r\n            ref={modalComment}\r\n          />\r\n          <input\r\n          type='date'\r\n          placeholder=\"Начало работы\"\r\n          className=\"ModalInput\"\r\n          ref={vacationStart}\r\n          style={{'marginRight': '10px'}}\r\n        />\r\n        <input\r\n          type='date'\r\n          placeholder=\"Конец работы\"\r\n          className=\"ModalInput\"\r\n          ref={vacationEnd}\r\n          style={{'marginRight': '10px'}}\r\n        />\r\n          <button className=\"ModalButton\" type=\"submit\" disabled={isFetching}>\r\n            Изменить\r\n          </button>\r\n        </form>\r\n      </Modal>\r\n    </div>\r\n  )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}