{"ast":null,"code":"import _objectSpread from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"D:/Download/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import axios from'axios';import{useEffect,useRef,useState}from'react';import{Create,Delete}from'@material-ui/icons';import Modal from'../Templates/Modal/Modal';import'./ProfileInfo.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function ProfileInfo(_ref){var username=_ref.username;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isFetching=_useState4[0],setIsFetching=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),modalActive=_useState6[0],setModalActive=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),modalActivePass=_useState8[0],setModalActivePass=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),modalActiveResetPass=_useState10[0],setModalActiveResetPass=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),modalActiveDelete=_useState12[0],setModalActiveDelete=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),deps=_useState14[0],setDeps=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),error=_useState16[0],setError=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),posts=_useState18[0],setPosts=_useState18[1];var localUser=JSON.parse(localStorage.getItem('user'));var modalName=useRef();var modalDep=useRef();var modalEmail=useRef();var modalOldPass=useRef();var modalNewPass=useRef();var modalNewPassAgain=useRef();var usersStatuses={0:'',1:'start',2:'end',3:'vacation',4:'deleted'};function findStatus(k){for(var i in usersStatuses){if(i==k){return usersStatuses[i];}}}// данные о пользователе\nuseEffect(function(){setIsFetching(true);var fetchUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/user/'+localUser._id);case 2:res=_context.sent;setUser(res.data);setIsFetching(false);case 5:case\"end\":return _context.stop();}}},_callee);}));return function fetchUser(){return _ref2.apply(this,arguments);};}();fetchUser();},[username]);// все возможные департаменты\nuseEffect(function(){var getDeps=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get('/api/departments/');case 2:res=_context2.sent;setDeps(res.data);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function getDeps(){return _ref3.apply(this,arguments);};}();getDeps();},[]);// данные о работе от последнего к первому\nuseEffect(function(){setIsFetching(true);var fetchUser=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.get('/api/user/');case 2:res=_context3.sent;setPosts(res.data.sort(function(p1,p2){return new Date(p2.workStart)-new Date(p1.workStart);}));setIsFetching(false);case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function fetchUser(){return _ref4.apply(this,arguments);};}();fetchUser();},[username]);// изменение данных пользователя\nvar handleClick=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e){var newInfo;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:e.preventDefault();newInfo={userId:localUser._id,username:modalName.current.value||user.username,email:modalEmail.current.value||user.email,departmentId:modalDep.current.value||user.departmentId};_context4.prev=2;_context4.next=5;return axios.put('/api/user/',newInfo);case 5:if(user._id===localUser._id){newInfo.password=localUser.password;localStorage.setItem('user',JSON.stringify(_objectSpread(_objectSpread({},user),newInfo)));}window.location.reload();_context4.next=12;break;case 9:_context4.prev=9;_context4.t0=_context4[\"catch\"](2);console.log(_context4.t0);case 12:case\"end\":return _context4.stop();}}},_callee4,null,[[2,9]]);}));return function handleClick(_x){return _ref5.apply(this,arguments);};}();// изменить пароль\nvar handleClickPassword=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(e){var passwords;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:e.preventDefault();if(!(modalNewPass.current.value!==modalNewPassAgain.current.value)){_context5.next=4;break;}setError('Новые пароли не совпадают');return _context5.abrupt(\"return\");case 4:passwords={userId:user._id,userPass:localUser.password,oldPassword:modalOldPass.current.value,newPassword:modalNewPass.current.value};_context5.prev=5;_context5.next=8;return axios.put('/api/user/'+user._id,passwords);case 8:localStorage.clear();window.location.reload();_context5.next=15;break;case 12:_context5.prev=12;_context5.t0=_context5[\"catch\"](5);setError('Старые пароли не совпадают');case 15:case\"end\":return _context5.stop();}}},_callee5,null,[[5,12]]);}));return function handleClickPassword(_x2){return _ref6.apply(this,arguments);};}();// сбросить пароль\nvar handleResetPass=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(e){var resetPassword;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:e.preventDefault();resetPassword={userId:localUser._id,newPassword:'qwerty123'};_context6.prev=2;_context6.next=5;return axios.put('/api/resetuser/',resetPassword);case 5:setModalActiveResetPass(false);_context6.next=11;break;case 8:_context6.prev=8;_context6.t0=_context6[\"catch\"](2);console.log('Ошибка');case 11:case\"end\":return _context6.stop();}}},_callee6,null,[[2,8]]);}));return function handleResetPass(_x3){return _ref7.apply(this,arguments);};}();// удалить пользователя\nvar handleDelete=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(e){var newPost;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:e.preventDefault();setIsFetching(true);newPost={userId:localUser._id,healthEnd:1,status:3/*      workEnd: new Date(Date.now()),\n      workTime: new Date(Date.now()) - new Date(posts[0].workStart)*/};_context7.prev=3;_context7.next=6;return axios.put('/api/deluser/',newPost);case 6:/*      if(user.status === 1){\n        await axios.put(\"/api/post/\"+posts[0]._id, newPost)\n      }*/ /*localStorage.clear()*/window.location.reload();/*window.location.href = '/'*/_context7.next=12;break;case 9:_context7.prev=9;_context7.t0=_context7[\"catch\"](3);console.log(_context7.t0);case 12:case\"end\":return _context7.stop();}}},_callee7,null,[[3,9]]);}));return function handleDelete(_x4){return _ref8.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"profileInfo\",children:[isFetching?/*#__PURE__*/_jsx(\"div\",{className:\"isFatching\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430...\"}):/*#__PURE__*/_jsxs(\"div\",{className:'employeePI '+findStatus(user.status),children:[/*#__PURE__*/_jsx(\"div\",{className:\"top\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"name\",children:[localUser.username,localUser.isAdmin?/*#__PURE__*/_jsx(Create,{style:{fontSize:'medium',cursor:'pointer',marginLeft:'10px'},onClick:function onClick(){return setModalActive(true);}}):'',localUser.isAdmin?/*#__PURE__*/_jsx(Delete,{style:{cursor:'pointer',fontSize:'medium'},onClick:function onClick(){return setModalActiveDelete(true);}}):/*#__PURE__*/_jsx(_Fragment,{})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"email\",children:localUser.email.toLowerCase()}),localUser._id===username&&/*#__PURE__*/_jsx(\"div\",{className:\"changePass\",onClick:function onClick(){return setModalActivePass(true);},children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u043F\\u0430\\u0440\\u043E\\u043B\\u044C\"}),localUser._id!==username&&localUser.isAdmin&&/*#__PURE__*/_jsx(\"div\",{className:\"changePass\",onClick:function onClick(){return setModalActiveResetPass(true);},children:\"\\u0421\\u0431\\u0440\\u043E\\u0441\\u0438\\u0442\\u044C \\u043F\\u0430\\u0440\\u043E\\u043B\\u044C\"})]}),/*#__PURE__*/_jsxs(Modal,{active:modalActive,setActive:setModalActive,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",onSubmit:handleClick,children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Name\",className:\"ModalInput\",ref:modalName}),/*#__PURE__*/_jsxs(\"select\",{ref:modalDep,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u041E\\u0442\\u0434\\u0435\\u043B\"}),deps.map(function(dep,id){return/*#__PURE__*/_jsx(\"option\",{value:dep.id,children:dep.department_name},id);})]}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Email\",type:\"email\",className:\"ModalInput\",ref:modalEmail,minLength:\"6\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",disabled:isFetching,children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"})]})]}),/*#__PURE__*/_jsxs(Modal,{active:modalActivePass,setActive:setModalActivePass,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"modalError\",children:error}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",onSubmit:handleClickPassword,children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Old Password\",type:\"password\",className:\"ModalInput\",ref:modalOldPass}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"New Password\",type:\"password\",className:\"ModalInput\",ref:modalNewPass,minLength:\"6\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"New Password Again\",type:\"password\",className:\"ModalInput\",ref:modalNewPassAgain,minLength:\"6\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",disabled:isFetching,children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"})]})]}),/*#__PURE__*/_jsxs(Modal,{active:modalActiveResetPass,setActive:setModalActiveResetPass,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",onSubmit:handleResetPass,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041D\\u043E\\u0432\\u044B\\u0439 \\u043F\\u0430\\u0440\\u043E\\u043B\\u044C \\u0431\\u0443\\u0434\\u0435\\u0442: qwerty123\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",disabled:isFetching,children:\"\\u0421\\u0431\\u0440\\u043E\\u0441\\u0438\\u0442\\u044C\"})]})]}),/*#__PURE__*/_jsxs(Modal,{active:modalActiveDelete,setActive:setModalActiveDelete,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0435\\u043D\\u0438\\u0435 \\u0438\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"form\",{className:\"modalLoginBox\",onSubmit:handleDelete,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044C \\u0431\\u0443\\u0434\\u0435\\u0442 \\u0443\\u0434\\u0430\\u043B\\u0435\\u043D\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ModalButton\",type:\"submit\",disabled:isFetching,children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"})]})]})]});}","map":{"version":3,"sources":["D:/Download/time_app/client/src/components/ProfileInfo/ProfileInfo.jsx"],"names":["axios","useEffect","useRef","useState","Create","Delete","Modal","ProfileInfo","username","user","setUser","isFetching","setIsFetching","modalActive","setModalActive","modalActivePass","setModalActivePass","modalActiveResetPass","setModalActiveResetPass","modalActiveDelete","setModalActiveDelete","deps","setDeps","error","setError","posts","setPosts","localUser","JSON","parse","localStorage","getItem","modalName","modalDep","modalEmail","modalOldPass","modalNewPass","modalNewPassAgain","usersStatuses","findStatus","k","i","fetchUser","get","_id","res","data","getDeps","sort","p1","p2","Date","workStart","handleClick","e","preventDefault","newInfo","userId","current","value","email","departmentId","put","password","setItem","stringify","window","location","reload","console","log","handleClickPassword","passwords","userPass","oldPassword","newPassword","clear","handleResetPass","resetPassword","handleDelete","newPost","healthEnd","status","isAdmin","fontSize","cursor","marginLeft","toLowerCase","map","dep","id","department_name"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport { useEffect, useRef, useState } from 'react'\nimport { Create, Delete } from '@material-ui/icons'\n\nimport Modal from '../Templates/Modal/Modal'\nimport './ProfileInfo.css'\n\nexport default function ProfileInfo({username}) {\n  const [user, setUser] = useState([])\n  const [isFetching, setIsFetching] = useState(false)\n  const [modalActive, setModalActive] = useState(false)\n  const [modalActivePass, setModalActivePass] = useState(false)\n  const [modalActiveResetPass, setModalActiveResetPass] = useState(false)\n  const [modalActiveDelete, setModalActiveDelete] = useState(false)\n  const [deps, setDeps] = useState([])\n  const [error, setError] = useState('')\n  const [posts, setPosts] = useState([])\n\n  const localUser = JSON.parse(localStorage.getItem('user'))\n\n  const modalName = useRef()\n  const modalDep = useRef()\n  const modalEmail = useRef()\n\n  const modalOldPass = useRef()\n  const modalNewPass = useRef()\n  const modalNewPassAgain = useRef()\n\n  const usersStatuses = {0: '', 1: 'start', 2: 'end', 3: 'vacation', 4: 'deleted'}\n  \n  function findStatus(k){\n    for(let i in usersStatuses){\n      if(i == k){\n        return usersStatuses[i]\n      }\n    }\n  }\n\n  // данные о пользователе\n  useEffect(() => {\n    setIsFetching(true)\n    const fetchUser = async () => {\n      const res = await axios.get('/api/user/'+localUser._id)\n      setUser(res.data)\n      setIsFetching(false)\n    }\n    fetchUser()\n  }, [username])\n\n  // все возможные департаменты\n  useEffect(() => {\n    const getDeps = async () => {\n      const res = await axios.get('/api/departments/')\n      setDeps(res.data)\n    }\n\n    getDeps()\n  }, [])\n\n  // данные о работе от последнего к первому\n  useEffect(() => {\n    setIsFetching(true)\n    const fetchUser = async () => {\n      const res = await axios.get('/api/user/')\n      setPosts(res.data.sort((p1, p2) => {\n        return new Date(p2.workStart) - new Date(p1.workStart)\n      }))\n      setIsFetching(false)\n    }\n    fetchUser()\n  }, [username])\n\n  // изменение данных пользователя\n  const handleClick = async (e) => {\n    e.preventDefault()\n\n    const newInfo= {\n      userId: localUser._id,\n      username: modalName.current.value || user.username,\n      email: modalEmail.current.value || user.email,\n      departmentId: modalDep.current.value || user.departmentId\n    }\n\n    try {\n      await axios.put('/api/user/', newInfo)\n      if(user._id === localUser._id){\n        newInfo.password = localUser.password\n\n        localStorage.setItem('user', JSON.stringify({...user, ...newInfo}))\n\n      }\n      window.location.reload()\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  // изменить пароль\n  const handleClickPassword = async (e) => {\n    e.preventDefault()\n    if(modalNewPass.current.value !== modalNewPassAgain.current.value){\n      setError('Новые пароли не совпадают')\n      return\n    }\n    const passwords = {\n      userId: user._id,\n      userPass: localUser.password,\n      oldPassword: modalOldPass.current.value,\n      newPassword: modalNewPass.current.value\n    }\n\n    try {\n      await axios.put('/api/user/'+user._id, passwords)\n      localStorage.clear()\n      window.location.reload()\n    } catch (error) {\n      setError('Старые пароли не совпадают')\n    }\n  }\n\n  // сбросить пароль\n  const handleResetPass = async (e) => {\n    e.preventDefault()\n\n    const resetPassword = {\n      userId: localUser._id,\n      newPassword: 'qwerty123'\n    }\n\n    try {\n      await axios.put('/api/resetuser/', resetPassword)\n      setModalActiveResetPass(false)\n    } catch (error) {\n      console.log('Ошибка');\n    }\n  }\n\n  // удалить пользователя\n  const handleDelete = async (e) => {\n    e.preventDefault()\n    setIsFetching(true)\n\n    const newPost = {\n      userId: localUser._id,\n      healthEnd: 1,\n      status: 3\n/*      workEnd: new Date(Date.now()),\n      workTime: new Date(Date.now()) - new Date(posts[0].workStart)*/\n    }\n\n    try {\n      await axios.put('/api/deluser/', newPost)\n/*      if(user.status === 1){\n        await axios.put(\"/api/post/\"+posts[0]._id, newPost)\n      }*/\n      /*localStorage.clear()*/\n      window.location.reload()\n      /*window.location.href = '/'*/\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  return (\n    <div className='profileInfo'>\n      {isFetching\n      ? <div className='isFatching'>Загрузка...</div>\n      : <div className={'employeePI ' + (findStatus(user.status))}>\n          <div className='top'>\n            <span className='name'>\n              {localUser.username}\n              { localUser.isAdmin\n                ? <Create style={{fontSize:'medium', cursor:'pointer', marginLeft:'10px'}} onClick={() => setModalActive(true)}/> \n                : ''\n              }\n              {localUser.isAdmin \n                ? <Delete style={{cursor:'pointer', fontSize:'medium'}}  onClick={() => setModalActiveDelete(true)}/>\n                : <></>\n              }\n            </span>\n          </div>\n          <div className='email'>{localUser.email.toLowerCase()}</div>\n          {localUser._id === username && <div className='changePass' onClick={() => setModalActivePass(true)}>Изменить пароль</div>}\n          {(localUser._id !== username && localUser.isAdmin) && <div className='changePass' onClick={() => setModalActiveResetPass(true)}>Сбросить пароль</div>}\n        </div> \n      }\n      <Modal active={modalActive} setActive={setModalActive}>\n        <h1>Изменение информации:</h1>\n        <hr/>\n        <form className=\"modalLoginBox\" onSubmit={handleClick}>\n          <input \n            placeholder=\"Name\"\n            className=\"ModalInput\"  \n            ref={modalName} \n          />\n          <select ref={modalDep}>\n            <option value=''>Отдел</option>\n            {deps.map((dep, id) => <option key={id} value={dep.id}>{dep.department_name}</option>)}\n          </select>\n          <input \n            placeholder=\"Email\" \n            type='email' \n            className=\"ModalInput\" \n            ref={modalEmail} \n            minLength='6'\n          />\n          <button className=\"ModalButton\" type=\"submit\" disabled={isFetching}>\n            Изменить\n          </button>\n        </form>\n      </Modal>\n      <Modal active={modalActivePass} setActive={setModalActivePass}>\n        <h1>Изменение информации:</h1>\n        <hr/>\n        {error && <div className='modalError'>{error}</div>}\n        <form className=\"modalLoginBox\" onSubmit={handleClickPassword}>\n          <input \n            placeholder=\"Old Password\"\n            type='password' \n            className=\"ModalInput\"  \n            ref={modalOldPass} \n          />\n          <input \n            placeholder=\"New Password\" \n            type='password' \n            className=\"ModalInput\" \n            ref={modalNewPass} \n            minLength='6'\n          />\n          <input \n            placeholder=\"New Password Again\" \n            type='password' \n            className=\"ModalInput\" \n            ref={modalNewPassAgain} \n            minLength='6'\n          />\n          <button className=\"ModalButton\" type=\"submit\" disabled={isFetching}>\n            Изменить\n          </button>\n        </form>\n      </Modal>\n      <Modal active={modalActiveResetPass} setActive={setModalActiveResetPass}>\n        <h1>Изменение информации:</h1>\n        <hr/>\n        <form className=\"modalLoginBox\" onSubmit={handleResetPass}>\n          <h2>Новый пароль будет: qwerty123</h2>\n          <button className=\"ModalButton\" type=\"submit\" disabled={isFetching}>\n            Сбросить\n          </button>\n        </form>\n      </Modal>\n      <Modal active={modalActiveDelete} setActive={setModalActiveDelete}>\n        <h1>Изменение информации:</h1>\n        <hr/>\n        <form className=\"modalLoginBox\" onSubmit={handleDelete}>\n          <h2>Пользователь будет удален</h2>\n          <button className=\"ModalButton\" type=\"submit\" disabled={isFetching}>\n            Удалить\n          </button>\n        </form>\n      </Modal>\n    </div>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}