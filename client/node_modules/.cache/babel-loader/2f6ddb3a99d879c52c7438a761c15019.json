{"ast":null,"code":"import _regeneratorRuntime from\"D:/Download/time_app/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Download/time_app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{Link,useParams}from'react-router-dom';import axios from'axios';import{useEffect,useState}from'react';import SidebarDeps from'../SidebarDeps/SidebarDeps';import'./Sidebar.css';import TreeView from'react-treeview';import'react-treeview/react-treeview.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Sidebar(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),deps=_useState2[0],setDeps=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),dep=_useState4[0],setDep=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),users=_useState6[0],setUsers=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isFetching=_useState8[0],setIsFetching=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),filterDeps=_useState10[0],setFilterDeps=_useState10[1];var currentUrl=useParams().username;var localUser=JSON.parse(localStorage.getItem('user'));useEffect(function(){var getDeps=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/department_tree_to_json/');case 2:res=_context.sent;console.log(\"DEPARTMENTS=\",res.data[0]);setDep(res.data);case 5:case\"end\":return _context.stop();}}},_callee);}));return function getDeps(){return _ref.apply(this,arguments);};}();getDeps();},[]);// загрузка всех департаментов\nuseEffect(function(){// сортировка на дочерние и тд\nvar getDeps=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res,_loop,i,newArr,arr1,arr2;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setIsFetching(true);_context2.next=3;return axios.get('/api/departments/');case 3:res=_context2.sent;_loop=function _loop(i){var _loop2=function _loop2(j){if(res.data.find(function(k){return k===res.data[j].id&&k!==res.data[i].id;})){if(res.data[j].margin){res.data[j].margin+=40;}else{res.data[j].margin=40;}}};for(var j=i+1;j<res.data.length;j++){_loop2(j);}};for(i=0;i<res.data.length-1;i++){_loop(i);}newArr=res.data.filter(function(d){return d.id!==7;});newArr.push(res.data[6]);setFilterDeps(newArr.filter(function(a){return a.dep_id===1;}));setDeps(newArr);if(currentUrl&&currentUrl!==localUser._id){arr1=[1,2,3,4,5,6,7,'61efa2f6cf0ce39b27ba2a53','61efa304cf0ce39b27ba2a54','61efa31dcf0ce39b27ba2a55','61efa32bcf0ce39b27ba2a56','61efa33acf0ce39b27ba2a57','61efa344cf0ce39b27ba2a58','61efa34fcf0ce39b27ba2a59'];arr2=[6,8,9,10,11,'61efa344cf0ce39b27ba2a58','61efa35dcf0ce39b27ba2a5a','61efa361cf0ce39b27ba2a5b','61efa36acf0ce39b27ba2a5c','61efa374cf0ce39b27ba2a5d'];if(arr1.find(function(i){return i===currentUrl;})){setFilterDeps(newArr.filter(function(dep){return dep.dep_id===1||dep.dep_id===2||dep.dep_id===3||dep.dep_id===4||dep.dep_id===5||dep.dep_id===6||dep.dep_id===7;}));}if(arr2.find(function(i){return i===currentUrl;})){setFilterDeps(newArr);}else{setFilterDeps(newArr.filter(function(dep){return dep.dep_id===1||dep.dep_id===2||dep.dep_id===3||dep.dep_id===4||dep.dep_id===5||dep.dep_id===6||dep.dep_id===7;}));}}setIsFetching(false);case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function getDeps(){return _ref2.apply(this,arguments);};}();// загрузка пользователей и сортировка по департаментам\nvar fetchUser=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res,id;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setIsFetching(true);_context3.next=3;return axios.get('/api/user/');case 3:res=_context3.sent;id=res.data.sort(function(a,b){return a.user_name.localeCompare(b.user_name);});setUsers(res.data);setIsFetching(false);console.log(\"ID=\",id);case 8:case\"end\":return _context3.stop();}}},_callee3);}));return function fetchUser(){return _ref3.apply(this,arguments);};}();fetchUser();getDeps();},[]);var isShowDeps=function isShowDeps(e){var arr1=[1,2,3,4,5,6,7,'61efa2f6cf0ce39b27ba2a53','61efa304cf0ce39b27ba2a54','61efa31dcf0ce39b27ba2a55','61efa32bcf0ce39b27ba2a56','61efa33acf0ce39b27ba2a57','61efa344cf0ce39b27ba2a58','61efa34fcf0ce39b27ba2a59'];var arr2=[6,8,9,10,11,'61efa344cf0ce39b27ba2a58','61efa35dcf0ce39b27ba2a5a','61efa361cf0ce39b27ba2a5b','61efa36acf0ce39b27ba2a5c','61efa374cf0ce39b27ba2a5d'];if(e.target.value===1){setFilterDeps(deps.filter(function(dep){return dep.dep_id===1||dep.dep_id===2||dep.dep_id===3||dep.dep_id===4||dep.dep_id===5||dep.dep_id===6||dep.dep_id===7;}));}if(arr2.find(function(i){return i===e.target.value;})){setFilterDeps(deps);}else{setFilterDeps(deps.filter(function(dep){return dep.dep_id===1||dep.dep_id===2||dep.dep_id===3||dep.dep_id===4||dep.dep_id===5||dep.dep_id===6||dep.dep_id===7;}));}};return/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sidebarWrapper\",children:/*#__PURE__*/_jsx(\"div\",{className:\"tree\",children:/*#__PURE__*/_jsx(\"div\",{className:\"treeWrapper\",children:dep.map(function(node,i){var label=/*#__PURE__*/_jsx(Link,{to:\"/department/\".concat(node.department_tree_to_json.id),className:\"depsUser\",style:{fontWeight:\"bold\"},children:/*#__PURE__*/_jsx(\"span\",{className:\"node\",children:node.department_tree_to_json.Name})});return/*#__PURE__*/_jsx(TreeView,{nodeLabel:label,defaultCollapsed:false,children:node.department_tree_to_json.Subclasses.map(function(departments){var label2=/*#__PURE__*/_jsx(Link,{to:\"/department/\".concat(departments.id),className:\"depsUser\",children:/*#__PURE__*/_jsx(\"span\",{className:\"node\",children:departments.Name})});return/*#__PURE__*/_jsx(TreeView,{nodeLabel:label2,defaultCollapsed:true,children:!!departments.Subclasses?departments.Subclasses.map(function(departments1){var label3=/*#__PURE__*/_jsx(Link,{to:\"/department/\".concat(departments1.id),className:\"depsUser\",children:/*#__PURE__*/_jsx(\"span\",{className:\"node\",children:departments1.Name})});return/*#__PURE__*/_jsx(TreeView,{nodeLabel:label3,defaultCollapsed:true,children:!!departments1.Subclasses?departments1.Subclasses.map(function(departments2){return/*#__PURE__*/_jsx(Link,{to:\"/department/\".concat(departments2.id),className:\"depsUser\",children:/*#__PURE__*/_jsx(\"div\",{style:{paddingBottom:'8px'},children:departments2.Name})});}):''});}):''},departments.child);})},node.department_tree_to_json.Name+'|'+i);})})})}),/*#__PURE__*/_jsx(\"div\",{})]});}","map":{"version":3,"sources":["D:/Download/time_app/client/src/components/Sidebar/Sidebar.jsx"],"names":["React","Link","useParams","axios","useEffect","useState","SidebarDeps","TreeView","Sidebar","deps","setDeps","dep","setDep","users","setUsers","isFetching","setIsFetching","filterDeps","setFilterDeps","currentUrl","username","localUser","JSON","parse","localStorage","getItem","getDeps","get","res","console","log","data","i","j","find","k","id","margin","length","newArr","filter","d","push","a","dep_id","_id","arr1","arr2","fetchUser","sort","b","user_name","localeCompare","isShowDeps","e","target","value","map","node","label","department_tree_to_json","fontWeight","Name","Subclasses","departments","label2","departments1","label3","departments2","paddingBottom","child"],"mappings":"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","sourcesContent":["import React from 'react'\r\nimport { Link, useParams } from 'react-router-dom'\r\nimport axios from 'axios'\r\nimport { useEffect, useState } from 'react'\r\n\r\nimport SidebarDeps from '../SidebarDeps/SidebarDeps'\r\nimport './Sidebar.css'\r\nimport TreeView from 'react-treeview';\r\nimport 'react-treeview/react-treeview.css'\r\n\r\nexport default function Sidebar() {\r\n  const [deps, setDeps] = useState([])\r\n  const [dep, setDep] = useState([])\r\n  const [users, setUsers] = useState([])\r\n  const [isFetching, setIsFetching] = useState(false)\r\n  const [filterDeps, setFilterDeps] = useState([])\r\n  const currentUrl = useParams().username\r\n  const localUser = JSON.parse(localStorage.getItem('user'))\r\n\r\n    useEffect(() => {\r\n        const getDeps = async () => {\r\n           const res = await axios.get('/api/department_tree_to_json/')\r\n            console.log(\"DEPARTMENTS=\",res.data[0])\r\n            setDep(res.data)\r\n        }\r\n        getDeps()\r\n        }, [])\r\n\r\n\r\n  // загрузка всех департаментов\r\n  useEffect(() => {\r\n    // сортировка на дочерние и тд\r\n    const getDeps = async () => {\r\n        setIsFetching(true)\r\n        const res = await axios.get('/api/departments/')\r\n        for(let i = 0; i < res.data.length-1; i++){\r\n          for(let j = i+1; j < res.data.length; j++){\r\n            if(res.data.find(k => k === res.data[j].id && k !== res.data[i].id)){\r\n              if(res.data[j].margin ){\r\n                res.data[j].margin += 40\r\n              } else {\r\n                res.data[j].margin = 40\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n      let newArr = res.data.filter(d => d.id !== 7)\r\n      newArr.push(res.data[6])\r\n      setFilterDeps(newArr.filter(a => a.dep_id === 1))\r\n      setDeps(newArr)\r\n      if(currentUrl && currentUrl !== localUser._id){\r\n        const arr1 = [1, 2, 3, 4, 5, 6, 7, '61efa2f6cf0ce39b27ba2a53', '61efa304cf0ce39b27ba2a54', '61efa31dcf0ce39b27ba2a55', '61efa32bcf0ce39b27ba2a56', '61efa33acf0ce39b27ba2a57', '61efa344cf0ce39b27ba2a58', '61efa34fcf0ce39b27ba2a59']\r\n        const arr2 = [6, 8, 9, 10, 11, '61efa344cf0ce39b27ba2a58', '61efa35dcf0ce39b27ba2a5a', '61efa361cf0ce39b27ba2a5b', '61efa36acf0ce39b27ba2a5c', '61efa374cf0ce39b27ba2a5d']\r\n\r\n        if(arr1.find(i => i === currentUrl)){\r\n          setFilterDeps(newArr.filter(dep => dep.dep_id === 1 || dep.dep_id === 2 || dep.dep_id === 3 || dep.dep_id === 4 || dep.dep_id === 5 || dep.dep_id === 6 || dep.dep_id === 7))\r\n        }\r\n        if(arr2.find(i => i === currentUrl)){\r\n          setFilterDeps(newArr)\r\n        }else{\r\n          setFilterDeps(newArr.filter(dep => dep.dep_id === 1 || dep.dep_id === 2 || dep.dep_id === 3 || dep.dep_id === 4 || dep.dep_id === 5 || dep.dep_id === 6 || dep.dep_id === 7))\r\n        }\r\n      }\r\n      setIsFetching(false)\r\n    }\r\n\r\n    // загрузка пользователей и сортировка по департаментам\r\n    const fetchUser = async () => {\r\n      setIsFetching(true)\r\n      const res = await axios.get('/api/user/')\r\n      const id=res.data.sort((a, b) => a.user_name.localeCompare(b.user_name))\r\n      setUsers(res.data)\r\n      setIsFetching(false)\r\n      console.log(\"ID=\",id)\r\n    }\r\n\r\n    fetchUser()\r\n    getDeps()\r\n  }, [])\r\n\r\n  const isShowDeps = (e) => {\r\n    const arr1 = [1, 2, 3, 4, 5, 6, 7, '61efa2f6cf0ce39b27ba2a53', '61efa304cf0ce39b27ba2a54', '61efa31dcf0ce39b27ba2a55', '61efa32bcf0ce39b27ba2a56', '61efa33acf0ce39b27ba2a57', '61efa344cf0ce39b27ba2a58', '61efa34fcf0ce39b27ba2a59']\r\n    const arr2 = [6, 8, 9, 10, 11, '61efa344cf0ce39b27ba2a58', '61efa35dcf0ce39b27ba2a5a', '61efa361cf0ce39b27ba2a5b', '61efa36acf0ce39b27ba2a5c', '61efa374cf0ce39b27ba2a5d']\r\n\r\n    if(e.target.value === 1){\r\n      setFilterDeps(deps.filter(dep => dep.dep_id === 1 || dep.dep_id === 2 || dep.dep_id === 3 || dep.dep_id === 4 || dep.dep_id === 5 || dep.dep_id === 6 || dep.dep_id === 7))\r\n    }\r\n    if(arr2.find(i => i === e.target.value)){\r\n      setFilterDeps(deps)\r\n    }else{\r\n      setFilterDeps(deps.filter(dep => dep.dep_id === 1 || dep.dep_id === 2 || dep.dep_id === 3 || dep.dep_id === 4 || dep.dep_id === 5 || dep.dep_id === 6 || dep.dep_id === 7))\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className='sidebar'>\r\n      <div className=\"sidebarWrapper\">\r\n        <div className=\"tree\">\r\n          <div className=\"treeWrapper\">\r\n\r\n              {dep.map((node, i) => {\r\n\r\n                  const label = <Link to={`/department/${node.department_tree_to_json.id}`} className='depsUser' style={{fontWeight: `bold`}}><span className=\"node\">{node.department_tree_to_json.Name}</span></Link>\r\n\r\n                  return (\r\n\r\n                      <TreeView key={node.department_tree_to_json.Name + '|' + i} nodeLabel={label} defaultCollapsed={false}>\r\n\r\n                          {node.department_tree_to_json.Subclasses.map(departments => {\r\n\r\n                              const label2 = <Link to={`/department/${departments.id}`} className='depsUser'><span className=\"node\">{departments.Name}</span></Link>\r\n\r\n                              return (\r\n\r\n                                  <TreeView nodeLabel={label2} key={departments.child} defaultCollapsed={true}>\r\n\r\n                                      {!!departments.Subclasses ? departments.Subclasses.map(departments1  => {\r\n\r\n                                          const label3 = <Link to={`/department/${departments1.id}`} className='depsUser'><span className=\"node\">{departments1.Name}</span></Link>\r\n\r\n                                          return(\r\n\r\n                                              <TreeView nodeLabel={label3} defaultCollapsed={true} >\r\n\r\n                                                  {!!departments1.Subclasses ? departments1.Subclasses.map(departments2  => {\r\n\r\n                                            return(\r\n\r\n                                                <Link to={`/department/${departments2.id}`} className='depsUser'>\r\n\r\n                                                    <div  style={{paddingBottom:'8px'}}>{departments2.Name}</div>\r\n\r\n                                                </Link>\r\n                                            )\r\n\r\n                                      }):''}\r\n                                  </TreeView>\r\n                              );\r\n                          }):''}\r\n                      </TreeView>\r\n                  );\r\n              })}\r\n                      </TreeView>\r\n                  );\r\n              })}\r\n          </div>\r\n        </div>\r\n      </div>\r\n        <div>\r\n\r\n        </div>\r\n    </div>\r\n  )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}